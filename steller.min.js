var LOG_LEVEL=4;org="undefined"===typeof org?{}:org;org.anclab=org.anclab||{};org.anclab.steller=org.anclab.steller||{};
(function(p,s){function o(a){var b=Object.create(o.prototype);b.spec=a=u(Object.create(a));b.getter=void 0;b.setter=void 0;b.valueOf=void 0;b.audioParam=void 0;b.watchers=[];b._value=void 0;a.audioParam?(b.audioParam=a.audioParam,b.getter=a.getter||o.getters.audioParam,b.setter=a.setter||o.setters.audioParam):a.options?(b.getter=a.getter||o.getters.value,b.setter=a.setter||o.setters.option):(b.getter=a.getter||o.getters.value,b.setter=a.setter||o.setters.value);b.valueOf=b.getter;"value"in a&&b.setter(a.value);
return b}function u(a){if(a.options){var b={};a.options.forEach(function(a,d){b["option:"+a]=d+1});a.limit=function(c){if("number"===typeof c){if(0<=c&&c<a.options.length)return a.options[c];throw Error("Invalid enumeration index");}if(b["option:"+c])return c;throw Error("Invalid enumeration value");}}return a}function r(a,b){var c,d,h=a.watchers;c=0;for(d=h.length;c<d;++c)h[c](b,a);return b}function m(){var a=0,b=4,c=[null,null,null,null],d=-1,h=0;this.length=0;this.add=function(f){if(a>=b){var e=
Array(2*b),g,i,k,n;g=d;i=0;k=a;for(n=b;i<k;++i,g=(g+1)%n)e[i]=c[g];c=e;h=a;d=0===a?-1:0;b*=2}c[h]=f;0>d&&(d=h);h=(h+1)%b;return this.length=a+=1};this.remove=function(){if(0>=a)throw Error("Empty queue");var h=c[d];c[d]=null;d=(d+1)%b;this.length=a-=1;return h};this.clear=function(){this.length=a=0;c.splice(0,c.length,null,null,null,null);b=4;d=-1;h=0};return this}function t(a,b){var c=f();if(g()&&!c)throw Error("PeriodicTimer needs requestAnimationFrame support. Use a sufficiently modern browser.");
var d=this,h=!1,e,b=void 0===b?15:Math.min(Math.max(g()?15:1,b),33);c&&12<=b?(d.start=function(){h||(h=!0,c(function(){h&&(c(arguments.callee),a())}))},d.stop=function(){h=!1}):(d.start=function(){h||(h=!0,e=setInterval(a,1))},d.stop=function(){h&&(h=!1,clearInterval(e),e=void 0)});d.__defineGetter__("running",function(){return h});d.__defineSetter__("running",function(a){a?d.start():d.stop();return h});5>=b&&console.warning("periodictimer.js[93]:\tWARNING!\tprecision_ms <= 5");d.computeAheadInterval_secs=
Math.round(3.333*b)/1E3;return d}function j(a){(p.JSNodeTimer_jsnodes||(p.JSNodeTimer_jsnodes=[])).push(a)}function i(a,b,c,d){this.dt=c;this.t1=a;this.t2=a+c;this.t1r=b;this.t2r=b+d.valueOf()*c;this.rate=d;this.data=null;return this}function q(a){return Math.round(1E3*a)/1E3}function g(){return"object"===typeof p&&"object"===typeof document&&p.document===document}function f(){try{return p.requestAnimationFrame||p.webkitRequestAnimationFrame||p.mozRequestAnimationFrame||p.msRequestAnimationFrame||
function(a){setTimeout(a,1E3/60)}}catch(a){}}function e(){try{return p.webkitAudioContext||p.mozAudioContext}catch(a){}}function l(){try{var a=p.performance,b=a&&(a.now||a.webkitNow||a.mozNow);if(b)return function(){return 0.0010*b.call(a)}}catch(c){}}var k=function(){function a(h,c,d){h.inputs=c||[];h.outputs=d||[];h.numberOfInputs=h.inputs.length;h.numberOfOutputs=h.outputs.length;if(!(0<h.numberOfInputs+h.numberOfOutputs)){console.error("graphnode.js[37]:\tASSERT failed (node.numberOfInputs + node.numberOfOutputs > 0) ");
debugger}h.context=h.inputs[0]&&h.inputs[0].context||h.outputs[0]&&h.outputs[0].context;if(!h.context){console.error("graphnode.js[41]:\tASSERT failed (node.context) ");debugger}h.connect=function(a,b,c){var d,a=a||h.context.destination,b=h.outputs[b||0];d=a.inputs?a.inputs[c||0]:a;if("AudioParam"===d.constructor.name||"AudioGain"===d.constructor.name)b.connect(d);else if(d.numberOfInputs===b.numberOfOutputs){a=0;for(c=d.numberOfInputs;a<c;++a)b.connect(d,a,a)}else b.connect(d);return h};h.disconnect=
function(){0<arguments.length?Array.prototype.forEach.call(arguments,function(a){h.outputs[a].disconnect()}):h.outputs.forEach(function(a){a.disconnect()});return h};var e={},f=b(h);h.keep=function(a){var a=a||h,c=b(a);return e[c]=a};h.drop=function(c){c?(c=b(c),delete e[c]):delete a._preservedNodes[f]};a._preservedNodes[f]=e;return h}function b(a){var b=a[d];b||(b=c++,Object.defineProperty(a,d,{value:b,writable:!1,enumerable:!1,configurable:!1}));return b}var c=1,d="#org.anclab.steller.GraphNode.globalid";
a._preservedNodes={};a.chain=function(b){var c,d;c=0;for(d=b.length-1;c<d;++c)b[c].connect(b[c+1]);return a};return a}();o.getters={value:function(){return this._value},audioParam:function(){return this.audioParam.value}};o.setters={value:function(a){return this._value=a},audioParam:function(a){return this.audioParam.value=a},option:function(a){return this._value=this.spec.limit(a)}};o.mappings={};o.mappings.linear={fromNorm:function(a,b){return a.spec.min+b*(a.spec.max-a.spec.min)},toNorm:function(a){return(a.value-
a.spec.min)/(a.spec.max-a.spec.min)}};o.mappings.log={fromNorm:function(a,b){var c=a.spec,d=Math.log(c.min),c=Math.log(c.max);return Math.exp(d+b*(c-d))},toNorm:function(a){var b=a.spec,c=Math.log(b.min),b=Math.log(b.max);return(Math.log(a.value)-c)/(b-c)}};o.names=function(a){return Object.keys(a).filter(function(b){return a[b]instanceof o})};o.expose=function(a,b,c){c||(c=o.names(a));c.forEach(function(c){c in b&&console.warning("param.js[150]:\tWARNING!\tn in obj2");b[c]=a[c]});return o};o.bind=
function(a,b,c){a instanceof o?a.bind(b,c):"value"in a?c?c.update(function(){b.value=a.value}):b.value=a.value:c?c.update(function(){b.value=a}):b.value=a;return o};o.prototype.__defineGetter__("value",function(){return this.getter()});o.prototype.__defineSetter__("value",function(a){return a!==this.getter()?r(this,this.setter(a)):a});o.prototype.watch=function(a){var b,c,d=this.watchers;b=0;for(c=d.length;b<c;++b)if(d[b]===a)return this;d.push(a);return this};o.prototype.unwatch=function(a){var b=
this.watchers;if(1>arguments.length||!a)return b.splice(0,b.length),this;for(var c=b.length-1;0<=c;--c)if(b[c]===a){b.splice(c,1);break}return this};o.prototype.changed=function(){r(this,this.getter());return this};o.prototype.alias=function(a,b){if(!a){console.error("param.js[266]:\tASSERT failed (name) ","Param.alias call needs name as first argument.");debugger}var c=this,d=Object.create(c);d.spec=Object.create(c.spec);d.spec.name=a;b&&(d.spec.label=b);d.getter=function(){return c.getter()};d.setter=
function(a){return c.setter(a)};d.alias=function(a,b){return c.alias(a,b)};return d};o.prototype.bind=function(a,b){var c=this;if(a.addEventListener){var d=c.spec,h=d.mapping?o.mappings[d.mapping]:o.mappings.linear,e,f,g;if("checkbox"===a.type)e=function(){c.value=a.checked?1:0},f=b?function(){b.update(e)}:e,g=function(b){a.checked=b?!0:!1};else if("range"===a.type)e=function(){c.value=h.fromNorm(c,parseFloat(a.value))},f=b?function(){b.update(e)}:e,g=function(){a.value=h.toNorm(c)};else throw Error("org.anclab.steller.Param.bind: Unsupported control type - "+
a.type);g.elem=a;g.unbind=function(){a.removeEventListener(f);c.unwatch(g)};a.addEventListener("change",f);c.watch(g);g(c.value)}else if("string"===typeof a){var d=document.querySelectorAll(a),i,k;i=0;for(k=d.length;i<k;++i)this.bind(d[i])}else{var n=function(b){a.value=b};n.elem=a;n.unbind=function(){c.unwatch(n)};c.watch(n);a.value=c.value}return this};o.prototype.unbind=function(a){if("string"===typeof a){var a=document.querySelectorAll(a),b,c;b=0;for(c=a.length;b<c;++b)this.unbind(a[b])}else{var d=
this.watchers;b=0;for(c=d.length;b<c;++b)if(d[b].elem===a){d[b].unbind();break}}return this};i.prototype.toString=function(){return JSON.stringify([this.t1r,this.t2r-this.t1r,this.t1,this.t2-this.t1].map(q))};i.prototype.copy=function(){var a=new i(this.t1,this.t1r,this.dt,this.rate);this.data&&(a.data=Object.create(this.data));return a};i.prototype.advance=function(a){this.t1+=a;this.t2+=a;return this};i.prototype.advanceTo=function(a){return this.advance(a-this.t1)};i.prototype.tick=function(){this.t1=
this.t2;this.t2+=this.dt;this.t1r=this.t2r;this.t2r+=this.dt*this.rate.valueOf();return this};i.prototype.jumpTo=function(a){var a=a-this.t1,b=a*this.rate.valueOf();this.t1+=a;this.t2+=a;this.t1r+=b;this.t2r+=b;return this};i.prototype.syncWith=function(a){this.t1=a.t1;this.t2=this.t1+this.dt;this.t1r=a.t1r;this.t2r=this.t1r+this.rate.valueOf()*this.dt;return this};i.prototype.nudgeToRel=function(a){a=Math.max(this.t1r,a);this.t2r>this.t1r&&(this.t1+=(a-this.t1r)*(this.t2-this.t1)/(this.t2r-this.t1r));
this.t1r=a;return this};i.prototype.rel2abs=function(a){return this.t1+(a-this.t1r)/this.rate.valueOf()};i.prototype.abs2rel=function(a){return this.t1r+(a-this.t1)*this.rate.valueOf()};var E=function(a){function b(a){var b=Math.pow(10,4-Math.min(3,(""+(a-a%1)).length));return Math.round(a*b)/b}function c(a){return function(b){a.insertAdjacentElement("beforeend",b)}}a.basicUI=function(a,h,e){if(h.ui)return h.ui;var f=a.createElement("div");e&&f.insertAdjacentHTML("beforeend","<p><b>"+e+"</b></p>");
o.names(h).map(function(a){var b=Object.create(h[a].spec);b.name=b.name||a;b.param=h[a];return b}).forEach(function(h){var e=h.name,g=h.param;if("min"in h&&"max"in h){var i=a.createElement("div"),k=a.createElement("span"),m=a.createElement("span");k.innerText=(h.label||e)+": ";k.style.width="100px";k.style.display="inline-block";k.style.textAlign="left";var j=a.createElement("input");j.type="range";j.min=0;j.max=1;j.step=0.0010;var l="string"===typeof h.mapping?o.mappings[h.mapping]:h.mapping||o.mappings.linear,
q=h.units?" "+h.units:"";j.value=l.toNorm(g);m.innerText=" ("+b(g.value)+q+")";j.changeModelParameter=function(){g.value=l.fromNorm(g,parseFloat(this.value))};j.changeSliderValue=function(a){j.value=l.toNorm(g);m.innerText=" ("+b(a)+q+")"};j.addEventListener("change",j.changeModelParameter);g.watch(j.changeSliderValue);[k,j,m].forEach(c(i));f.insertAdjacentElement("beforeend",i)}});return h.ui=f};return a}({});s.SoundModel=k;s.GraphNode=k;s.Param=o;s.Scheduler=function(a,b){function c(a,b){a&&(B.add(a),
B.add(b))}function d(a){a(n,v.copy(),h)}function h(){}function k(a,b,c){c&&c(a,b,h)}function j(a,b){return function(c,d,e){function f(c,d){var A=k+a.valueOf();0<C&&d.t1<v.t1&&d.advance(C);d.t1>G?g&&D.add(g):d.t2r<A?(b&&b(d,d.t1r,d.t2r,k,A),d.tick(),g&&D.add(g)):(b&&A>=d.t1r&&b(d,d.t1r,A,k,A),d.t2r>d.t1r?e(c,d.nudgeToRel(A),h):e(c,d,h))}function g(a){f(a,d,h)}var k=d.t1r;f(c,d)}}function q(a){return function(b,c,d){a(c)(b,c,d)}}function E(a){function b(a,d,e){var f,g,F;if(0<c.length){F=c;c=[];f=0;
for(g=F.length;f<g;++f)F[f](a,d.copy(),h)}e(a,d,h)}if(0<arguments.length)return function(a,b,c){for(;a<b;++a)c.push(E());return c}(0,a,[]);var c=[];b.play=function(a){c.push(a);return this};b.cancel=function(){c.splice(0,c.length);return this};return b}function r(a){function b(a,d,f){e?f(a,d,h):c.push({sched:a,next:f,clock:d})}if(0<arguments.length)return function(a,b,c){for(;a<b;++a)c.push(r());return c}(0,a,[]);var c=[],d=[],e=!0;b.__defineGetter__("isOpen",function(){return e});b.__defineSetter__("isOpen",
function(a){a?b.open():b.close();return a});b.open=function(a,b,d){e=!0;var f=c,g,F,k,i=w();c=[];g=0;for(F=f.length;g<F;++g)k=f[g],k.next(k.sched,b?b.copy():k.clock.advanceTo(i),h);d&&d(a,b,h)};b.close=function(a,b,c){e=!1;c&&c(a,b,h)};b.toggle=function(a,c,d){return e?b.close(a,c,d):b.open(a,c,d)};b.cancel=function(a,b,d){c.splice(0,c.length);d&&d(a,b,h)};b.push=function(a,b,f){d.push({isOpen:e,cache:c});c=[];f&&f(a,b,h)};b.pop=function(a,b,e){var f=d.pop();c.push.apply(c,f.cache);this.isOpen=f.isOpen;
e&&e(a,b,h)};return b}var n=this===p?{}:this,s=f(),x=e();if(g()&&!s)throw Error("Scheduler needs requestAnimationFrame support. Use a sufficiently modern browser version.");var u=0.0010,w=function(){if(a){if(a instanceof x)return u=1/a.sampleRate,a.createGainNode(),function(){return a.currentTime};throw Error("Scheduler: Argument is not an audio context");}return l()||function(){return 0.0010*Date.now()}}(),z,y=!1;n.__defineGetter__("running",function(){return y});n.__defineSetter__("running",function(a){a?
y||(y=!0,v.advanceTo(w()),z.start()):(y=!1,z.stop())});n.frame_rate=o({min:15,max:75,value:60});var D=new m("tick"),B=new m("frames"),J=new m("update");z=new t(function(){var a,b,c,d,h;a=!0;b=w();U(b);for(G=b+H;b-v.t1>R;)C=b-v.t1,v.advance(C);for(;a||v.t1<G;){if(0<J.length){c=J.length;for(a=0;a<c;++a)J.remove()()}c=D.length;for(a=0;a<c;++a)D.remove()(n,v,k);v.t1<G&&v.tick();C=0;a=!1}if(0<B.length){c=B.length;for(a=0;a<c;a+=2)d=B.remove(),h=B.remove(),d(b,h)}if(n.ontick)n.ontick(b)},0,a);var K=1/60,
M=K,H=z.computeAheadInterval_secs||0.05,R=5*H,v=new i(w(),0,H,1),G=v.t1,C=0,U=function(){var a=1/60,b=v.t1,c=15;return function(d){var h=d-b;0.01<h&&0.07>h&&(M=K=a+=0.05*(h-a),H=3.33*K,R=5*H,0>=c--&&(n.frame_rate.value=Math.round(1/K),c=15));b=d}}(),S=function(){return a?function T(b){0===a.currentTime?setTimeout(T,100,b):(v=new i(w(),0,H,1),G=v.t1,n.play=S=d,d(b))}:d}(),N;b&&b.diagnostics?(4<=LOG_LEVEL&&console.log("scheduler.js[630]:\t","fire: diagnostics on"),N=function(a){return function(b,c,
d){var e=w();c.t1<e&&console.warning("scheduler.js[634]:\tWARNING!\tclock.t1 < t");a(c);d(b,c,h)}}):N=function(a){return function(b,c,d){a(c);d(b,c,h)}};n.audioContext=a;n.update=function(a){a&&J.add(a)};n.perform=function(a,b,c){a(n,b,c)};n.cancel=function(){J.clear();D.clear();B.clear()};n.play=S;n.stop=h;n.cont=k;n.delay=j;n.loop=function(a){return function A(b,c){a(b,c,A)}};n.loop_while=function(a,b){return function(c,d,e){function f(){a.valueOf()?b(c,d,f):e(c,d,h)}f()}};n.repeat=function(a,b){return function(c,
d,e){function f(){if(g<a){g++;b(c,d,f)}else e(c,d,h)}var g=0;f()}};n.fork=function(a){a=a&&a.constructor===Function?Array.prototype.slice.call(arguments,0):a.slice(0);return function(b,c,d){function e(b,g){f++;f===a.length&&d(b,c.syncWith(g),h)}var f=0;a.forEach(function(a){a(b,c.copy(),e)})}};n.spawn=function(a){a=a&&a.constructor===Function?Array.prototype.slice.call(arguments,0):a.slice(0);return function(b,c,d){a.forEach(function(a){a(b,c.copy(),h)});d(b,c,h)}};n.dynamic=q;n.track=function(a){function b(c,
d,e,f,g){function k(b,c){if(i<j)a[i++](b,c,k);else e(b,c,h)}var i=0,j=a.length;if(arguments.length>3){if(arguments.length!==5){console.error("scheduler.js[581]:\tASSERT failed (arguments.length === 5) ");debugger}i=f;j=g}k(c,d,e)}a&&a.constructor===Function&&(a=Array.prototype.slice.call(arguments,0));b.minIndex=0;b.maxIndex=a.length;b.models=a;return b};n.slice=function(a,b,c){c=arguments.length>2?c:a.maxIndex;b=arguments.length>1?Math.max(a.minIndex,Math.min(b,c)):a.minIndex;return function(d,h,
e){a(d,h,e,b,c)}};n.fire=N;n.display=function(a){return function(b,d,e){function f(b){b+M>g?a(d,g,b):c(f)}var g=d.t1;c(f);e(b,d,h)}};n.frame=function(a){return function(b,d,e){function f(k){if(k+M>g){d.jumpTo(k);a(d);e(b,d,h)}else c(f)}var g=d.t1;c(f)}};n.frames=function(a,b){return function(d,e,f){function g(b,c){var d,e=i+a.valueOf();if(C>0&&c.t1<v.t1){c.advance(C);if(l){n=n+void 0;l.intervals.length>4&&l.intervals.splice(0,l.intervals.length-4);if(l.intervals.length>0){l.intervals[0]=l.intervals[0]+
void 0;l.intervals[3]=c.rate.valueOf()}}}if(c.t1>G)k&&D.add(k);else{if(l&&c.t1r<=e){l.endTime=e;var m=c.rate.valueOf();for(d=Math.max(0.0010,K*m);j<c.t2r;){l.intervals.push(n);l.intervals.push(j);l.intervals.push(j+d);l.intervals.push(m);j=j+d}}if(c.t2r<e){c.tick();k&&D.add(k)}else{l.end=true;c.t2r>c.t1r?f(b,c.nudgeToRel(e),h):f(b,c,h)}}}function k(a){g(a,e,h)}var i=e.t1r,j=i,n=e.t1,m,l;if(b){m=function(a,d){if(d.intervals.length>0){var e=d.intervals[0],h=d.intervals[1],f=d.intervals[2],g=d.intervals[3];
if(h<=d.endTime){if(e<M+a){b(d.clock,h,f,d.startTime,d.endTime,g);d.intervals.splice(0,4)}c(m,d);return}}d.end||c(m,d)};l={clock:e,intervals:[],startTime:e.t1r,endTime:e.t1r+a.valueOf(),end:false};c(m,l)}g(d,e)}};n.log=function(a){return N(function(){console.log(a)})};n.anim=function(a,b){var c,d,e,h;switch(arguments.length){case 3:h=arguments[2];break;case 4:c=arguments[2];d=arguments[3];h=function(a){return(1-a)*c.valueOf()+a*d.valueOf()};break;case 5:c=arguments[2];d=arguments[3];e=arguments[4];
h=function(a){a=e(a);return(1-a)*c.valueOf()+a*d.valueOf()};break;default:throw Error("Invalid arguments to anim()");}return a.constructor.name==="AudioGain"||a.constructor.name==="AudioParam"?j(b,function(b,c,d,e,f){var f=f-e,g;if(c<=e){g=f>u?(c-e)/f:0;a.setValueAtTime(h(g),b.rel2abs(c))}a.linearRampToValueAtTime(h(f>u?(d-e)/f:1),b.rel2abs(d))}):j(b,function(b,c,d,e,f){b=f-e-(d-c);a.value=b>u?h((c-e)/b):h(1)})};n.rate=function(a){return function(b,c,d){c.rate=a;d(b,c,h)}};n.choice=function(a){return q(function(){return a[Math.floor(Math.random()*
a.length)]})};n.sync=E;n.gate=r;n.stats=function(){return{frame_jitter_ms:0}};n.running=b&&"running"in b&&b.running||!0;org.anclab.steller.Models&&(n.models=org.anclab.steller.Models(n));return n};s.Clock=i;s.PeriodicTimer=t;s.JSNodeTimer=function(a,b,c){if(c){var d=c.createJavaScriptNode(1024);d.onaudioprocess=function(){a()};var e=this,f=!1;j(d);e.start=function(){f||(f=!0,d.connect(c.destination))};e.stop=function(){f&&(d.disconnect(),f=!1)};e.__defineGetter__("running",function(){return f});e.__defineSetter__("running",
function(a){a?e.start():e.stop();return f});e.computeAheadInterval_secs=Math.round(2560)/c.sampleRate;return e}return t.call(this,a,b)};s.UI=E;s.Util={p2f:function(a){return 440*Math.pow(2,(a.valueOf()-69)/12)},f2p:function(a){a=69+12*Math.log(a.valueOf()/440)/Math.LN2;return Math.round(100*a)/100},augment:function(a,b){var c=org.anclab.steller;if(a in c)c[a].augmentors.push(b);else{var d=function(){var a=Array.prototype.slice.call(arguments,0),b={};d.augmentors.forEach(function(c){b=c.apply(b,a)||
b});return b};d.augmentors=[b];c[a]=d}return c[a]}};s.requestAnimationFrame=function(a){return function(b){return a(b)}}(f());s.AudioContext=e()})(function(){return"undefined"===typeof window?void 0:window}(),org.anclab.steller);if(!org.anclab.steller){console.error("models.js[20]:\tASSERT failed (org.anclab.steller) ");debugger}
org.anclab.steller.Util.augment("Models",function(p){var s=org.anclab.steller,o=org.anclab.steller.Util,u=s.SoundModel,r=s.Param,m=p.audioContext,t=this;t.chime=function(){var j=m.createGainNode(),i=u({},[],[j]);i.halfLife=r({min:0.0010,max:10,value:0.5,mapping:"log"});i.attackTime=r({min:0,max:1,value:0.01});i.level=r({min:0.125,max:4,audioParam:j.gain,mapping:"log"});i.play=function(q,g){void 0===g&&(g=1);return p.fire(function(f){var e=o.p2f(q.valueOf()),l=m.createOscillator();l.type=l.SINE;l.frequency.value=
e;var k=m.createGainNode();k.gain.value=0;k.gain.setValueAtTime(0,f.t1);k.gain.linearRampToValueAtTime(g.valueOf()/8,f.t1+i.attackTime.value);var e=440*i.halfLife.value/e,E=10*e;k.gain.setTargetValueAtTime(0,f.t1+i.attackTime.value,e);l.connect(k);k.connect(j);l.noteOn(f.t1);l.stop(f.t1+E)})};return i};t.dc=function(){var j,i,q;q=m.createBuffer(1,1024,m.sampleRate);i=q.getChannelData(0);for(j=0;1024>j;++j)i[j]=1;return function(g){var f=m.createBufferSource();f.buffer=q;f.loop=!0;f.noteOn(0);var e=
m.createGainNode();e.gain.value=g;f.connect(e);g=u({},[],[e]);g.level=r({min:-1,max:1,audioParam:e.gain});g.stop=function(e){f.stop(e)};return g}}();t.noise=function(){var j=m.createBuffer(1,5*m.sampleRate,m.sampleRate),i,q,g=j.getChannelData(0);i=0;for(q=g.length;i<q;++i)g[i]=2*Math.random()-1;return function(){var f=m.createBufferSource();f.buffer=j;f.loop=!0;f.gain.value=1;var e=m.createGainNode();e.gain.value=1;f.connect(e);f.noteOn(0);var g=t.dc(0);g.connect(e);e=u({},[],[e]);e.spread=r({min:0.01,
max:10,audioParam:f.gain});e.mean=g.level;return e}}();t.probe=function(){var j=r({min:-1,max:1,value:0}),i=r({min:-1,max:1,value:1}),q=r({min:0,max:1,value:0}),g=m.createJavaScriptNode(512,1,1),f=0,e=0,l=1-Math.exp(Math.log(0.5)/1024);g.onaudioprocess=function(g){for(var g=g.inputBuffer.getChannelData(0),m=g.length,a=0,b=0,a=0;a<m;++a)b=g[a],f+=l*(b-f),e+=l*(b*b-e);j.value=f;q.value=e;i.value=Math.sqrt(Math.max(0,e-f*f))};g.connect(m.destination);g=u({},[g],[]);g.mean=j;g.sigma=i;g.energy=q;return g};
t.mic=function(){function j(g,f,e){try{navigator.webkitGetUserMedia(g,f,e)}catch(i){e(i)}}function i(g,f){if(!q){if(!f){console.error("models/mic.js[46]:\tASSERT failed (stream) ");debugger}q=m.createMediaStreamSource(f)}q.connect(g.outputs[0]);g.error=null;g.ready.value=1}var q;return function(){var g=m.createGainNode(),f=u({},[],[g]);f.ready=r({min:-1,max:1,value:0});f.gain=r({min:0,max:1,audioParam:g.gain});q?i(f,null):j({audio:!0},function(e){return i(f,e)},function(e){f.error=e;f.gain.value=
0;f.ready.value=-1});return f}}();t.spectrum=function(j,i){function q(){if(l){var e=m.currentTime;g.getFloatFrequencyData(f.bins);for(var i=0,a=f.bins,b=a.length;i<b;++i)a[i]=Math.pow(10,a[i]/20);l=s.requestAnimationFrame(q);f.time.value=e}}var j=j||1024,g=m.createAnalyser();g.fftSize=2*j;g.frequencyBinCount=j;g.smoothingTimeConstant=2>arguments.length?0.1:i;var f=u({},[g],[]);f.bins=new Float32Array(j);f.freqs=new Float32Array(j);f.time=r({min:0,max:1E9,value:0});for(var e=0;e<j;++e)f.freqs[e]=e*
m.sampleRate/g.fftSize;var l;f.start=p.fire(function(){l||(l=s.requestAnimationFrame(q))});f.stop=p.fire(function(){l=void 0});return f};(function(){var j={};t.load_sample=function(i,q,g){var f="sound:"+i,e=j[f];if(e)return q&&q(e),e;if(q){var l=new XMLHttpRequest;l.open("GET",i,!0);l.responseType="arraybuffer";l.onerror=function(e){console.error("models/sample.js[22]:\t",e);g&&g(e,i)};l.onload=function(){m.decodeAudioData(l.response,function(e){q(j[f]=e);0<=LOG_LEVEL&&console.log("models/sample.js[31]:\t",
"Sound ["+i+"] loaded!")},function(e){console.error("models/sample.js[34]:\t","Sound ["+i+"] failed to decode.");g&&g(e,i)})};l.send()}};t.load_sample.clearCache=function(){j={}};t.sample=function(i,j){function g(g,i,a,b,c){if(!l){console.error("models/sample.js[109]:\tASSERT failed (soundBuff) ");debugger}var d=m.createBufferSource();d.buffer=l;d.connect(f);d.playbackRate.value=i;d.gain.setValueAtTime(0,g.t1);d.gain.setTargetValueAtTime(a,g.t1,e.attackTime.value/3);3<arguments.length?d.noteGrainOn(g.t1,
b,4<arguments.length?c:d.duration):d.noteOn(g.t1);return d}var f=m.createGainNode();f.gain.value=0.25;var e=u({},[],[f]);e.level=r({min:0.0010,max:10,audioParam:f.gain,mapping:"log"});e.attackTime=r({min:0.0010,max:10,value:0.02,mapping:"log"});e.releaseTime=r({min:0.0010,max:10,value:0.1,mapping:"log"});var l;e.load=function(f,g,a){if(l)f.perform(a,g,f.stop);else{var b=g.t1-m.currentTime;t.load_sample(i,function(c){l=c;e.duration=l.duration;f.perform(a,g.jumpTo(m.currentTime+b),f.stop)},j)}};e.trigger=
function(e,f){f=f||0;return p.fire(function(a){var b=Math.pow(2,f.valueOf()/12);g(a,b,e.valueOf())})};e.play=p.track([e.load,p.dynamic(function(f){var i=g(f,f.rate.valueOf(),1);return p.delay(e.duration,function(a){i.playbackRate.value=a.rate.valueOf()})})]);e.note=function(f,i,a,b){4>arguments.length&&(b=a);return p.dynamic(function(c){var d=g(c,f.valueOf(),1,i,a);d.gain.value=0;d.gain.setTargetValueAtTime(1,c.t1,e.attackTime.value/3);d.playbackRate.setTargetValueAtTime(f.valueOf(),c.t1,c.dt/3);
return p.track([p.spawn(p.track([p.delay(b),p.fire(function(a){d.gain.setTargetValueAtTime(0,a.t1,e.releaseTime.value/3);d.stop(a.t1+12*e.releaseTime.value)})])),p.delay(a,function(a){d.playbackRate.exponentialRampToValueAtTime(f.valueOf(),a.t1)})])})};return e};t.sample.clearCache=t.load_sample.clearCache})();t.jsnode=function(j){var i=j.numberOfInputs||0,o=i+(j.audioParams?j.audioParams.length:0),g=j.numberOfOutputs||1;if(!(0<g)){console.error("models/jsnode.js[54]:\tASSERT failed (numOutputs > 0) ");
debugger}var f=0<o?m.createChannelMerger(o):void 0,e=0<g?m.createChannelSplitter(g):void 0,l=[],k,p,a;k=0;for(p=o;k<p;++k)a=m.createGainNode(),l.push(a),a.connect(f,0,k);var b=[];k=0;for(p=g;k<p;++k)a=m.createGainNode(),b.push(a),e&&e.connect(a,k);var c;if(j.audioParams){c=Object.keys(j.audioParams);if("inputs"in j.audioParams){console.error("models/jsnode.js[76]:\tASSERT failed (!('inputs' in spec.audioParams)) ");debugger}if("outputs"in j.audioParams){console.error("models/jsnode.js[77]:\tASSERT failed (!('outputs' in spec.audioParams)) ");
debugger}if("playbackTime"in j.audioParams){console.error("models/jsnode.js[78]:\tASSERT failed (!('playbackTime' in spec.audioParams)) ");debugger}}else c=[];var d={},h=[],r=[];d.inputs=h;d.outputs=r;k=0;for(p=c.length;k<p;++k)d[c[k]]=null;d.playbackTime=m.currentTime;var s=0===i,Q=!1,I=!1,O=0,n=Infinity,P,x=u({},l,b),L=0<c.length?t.dc(1):void 0;c.forEach(function(a,b){var e=l[i+b];x[a]=e.gain;e.gain.value=j.audioParams[a];L.connect(e);if(c[b]in d){console.error("models/jsnode.js[159]:\tASSERT failed (!(paramNames[i] in obj)) ",
"Duplicate param name - ",c[b]);debugger}});var w=x.keep(m.createJavaScriptNode(1024,o,Math.min(1,g)));f&&f.connect(w);w.onaudioprocess=function(a){var b,e,f,k,l;s?(f=Math.floor(m.currentTime*m.sampleRate),b=Math.max(f,O),k=Math.min(f+1024,n)):(b=f,k=f+1024);l=b-f;f=k-f;if(k>b){b=0;for(e=i;b<e;++b)h[b]=a.inputBuffer.getChannelData(b).subarray(l,f);b=0;for(e=g;b<e;++b)r[b]=a.outputBuffer.getChannelData(b).subarray(l,f);b=0;for(e=c.length;b<e;++b)d[c[b]]=a.inputBuffer.getChannelData(i+b).subarray(l,
f);d.playbackTime=a.playbackTime||m.currentTime;j.onaudioprocess.call(x,d)}s&&!I&&k>=n&&(1<=LOG_LEVEL&&console.log("models/jsnode.js[136]:\t","Finished",k,n),I=!0,setTimeout(P,Math.round(1024E3/m.sampleRate)))};var z=e||m.destination;if(0===i){var y;P=function(){I=!0;w.disconnect();e&&e.disconnect();L&&(L.stop(),L.disconnect());f&&f.disconnect();x.drop(w)};s=!0;x.prepareAheadTime=0.1;x.start=function(a){if(!Q&&!I)if(a){var b=Math.max(a,m.currentTime)-m.currentTime;y&&(cancelTimeout(y),y=null);var c=
function(a){O=Math.floor(a*m.sampleRate);Q=true;y=null;w.connect(z)};b<=x.prepareAheadTime?c(a):y=setTimeout(c,Math.round(1E3*(b-x.prepareAheadTime)),a)}else w.connect(z)};x.stop=function(a){I||(n=Math.max(O,Math.ceil(a*m.sampleRate)),0>=a-m.currentTime&&(4<=LOG_LEVEL&&console.log("models/jsnode.js[232]:\t","Stopping immediately."),setTimeout(P,0)))}}else w.connect(z);return x};return t});
