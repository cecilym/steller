var LOG_LEVEL=1;org="undefined"===typeof org?{}:org;org.anclab=org.anclab||{};org.anclab.steller=org.anclab.steller||{};
(function(o,t){function u(a){var b={};a.on=function(a,c){var f,r,a=y(a);if(2<arguments.length){f=1;for(r=arguments.length;f<r;++f)this.on(a,arguments[f]);return this}f=b[a]||(b[a]={});if((r=c&&c.__steller_eventable_id__||0)&&r in f)return this;r||Object.defineProperty(c,"__steller_eventable_id__",{value:r=K++,enumerable:!1,configurable:!1,writable:!1});f[r]=c;return this};a.off=function(a,c){var f,r,a=y(a);if(2<arguments.length){f=1;for(r=arguments.length;f<r;++f)this.off(a,arguments[f]);return this}f=
b[a];if(!f)return this;(r=c&&c.__steller_eventable_id__||0)?delete f[r]:c||delete b[a];return this};a.emit=function(a){var a=y(a),c=b[a];if(!c)return this;for(var f in c)try{c[f].apply(this,arguments)}catch(r){1<=LOG_LEVEL&&console.log("eventable.js[116]:\t","Exception in event watcher - ",r)}return this};return a}function i(a){var b=Object.create(i.prototype);b.spec=a=s(Object.create(a));b.getter=void 0;b.setter=void 0;b.valueOf=void 0;b.audioParam=void 0;b.watchers=[];b._value=void 0;a.audioParam?
(b.audioParam=a.audioParam,b.getter=a.getter||i.getters.audioParam,b.setter=a.setter||i.setters.audioParam):a.options?(b.getter=a.getter||i.getters.value,b.setter=a.setter||i.setters.option):(b.getter=a.getter||i.getters.value,b.setter=a.setter||i.setters.value);b.valueOf=b.getter;"value"in a&&b.setter(a.value);return b}function s(a){if(a.options){var b={};a.options.forEach(function(a,c){b["option:"+a]=c+1});a.limit=function(e){if("number"===typeof e){if(0<=e&&e<a.options.length)return a.options[e];
throw Error("Invalid enumeration index");}if(b["option:"+e])return e;throw Error("Invalid enumeration value");}}return a}function j(a,b){var e,c,f=a.watchers;e=0;for(c=f.length;e<c;++e)f[e](b,a);return b}function v(){var a=0,b=4,e=[null,null,null,null],c=-1,f=0;this.length=0;this.add=function(r){if(a>=b){var d=Array(2*b),g,h,n,k;g=c;h=0;n=a;for(k=b;h<n;++h,g=(g+1)%k)d[h]=e[g];e=d;f=a;c=0===a?-1:0;b*=2}e[f]=r;0>c&&(c=f);f=(f+1)%b;return this.length=a+=1};this.remove=function(){if(0>=a)throw Error("Empty queue");
var f=e[c];e[c]=null;c=(c+1)%b;this.length=a-=1;return f};this.clear=function(){this.length=a=0;e.splice(0,e.length,null,null,null,null);b=4;c=-1;f=0};return this}function m(a,b){var e=d();if(g()&&!e)throw Error("PeriodicTimer needs requestAnimationFrame support. Use a sufficiently modern browser.");var c=this,f=!1,r,b=void 0===b?15:Math.min(Math.max(g()?15:1,b),33);e&&12<=b?(c.start=function(){f||(f=!0,e(function(){f&&(e(arguments.callee),a())}))},c.stop=function(){f=!1}):(c.start=function(){f||
(f=!0,r=setInterval(a,1))},c.stop=function(){f&&(f=!1,clearInterval(r),r=void 0)});c.__defineGetter__("running",function(){return f});c.__defineSetter__("running",function(a){a?c.start():c.stop();return f});c.computeAheadInterval_secs=Math.round(3.333*b)/1E3;return c}function p(a){(o.JSNodeTimer_jsnodes||(o.JSNodeTimer_jsnodes=[])).push(a)}function l(a,b,e,c){this.dt=e;this.t1=a;this.t2=a+e;this.t1r=b;this.t2r=b+c.valueOf()*e;this.rate=c;this.data=null;return this}function h(a){return Math.round(1E3*
a)/1E3}function g(){return"object"===typeof o&&"object"===typeof document&&o.document===document}function d(){try{return o.requestAnimationFrame||o.webkitRequestAnimationFrame||o.mozRequestAnimationFrame||o.msRequestAnimationFrame||function(a){setTimeout(a,1E3/60)}}catch(a){}}function q(){try{return o.webkitAudioContext||o.mozAudioContext}catch(a){}}function n(){try{var a=o.performance,b=a&&(a.now||a.webkitNow||a.mozNow);if(b)return function(){return 0.0010*b.call(a)}}catch(e){}}var y=function(){var a=
{};return function(b){if(a[b])throw Error("Invalid event name - "+b);return b}}(),K=1;u.observe=function(a,b,e){var e=y(e||b),c=a[b];a[b]=function(){var a=c.apply(this,arguments),b=Array.prototype.slice.call(arguments);b.unshift(e);this.emit.apply(this,b);return a};return a};var M=function(){function a(f,e,c){f.inputs=e||[];f.outputs=c||[];f.numberOfInputs=f.inputs.length;f.numberOfOutputs=f.outputs.length;f.context=f.inputs[0]&&f.inputs[0].context||f.outputs[0]&&f.outputs[0].context;f.connect=function(a,
b,e){var c,a=a||f.context.destination,b=f.outputs[b||0];c=a.inputs?a.inputs[e||0]:a;if("AudioParam"===c.constructor.name||"AudioGain"===c.constructor.name)b.connect(c);else if(c.numberOfInputs===b.numberOfOutputs){a=0;for(e=c.numberOfInputs;a<e;++a)b.connect(c,a,a)}else b.connect(c);return f};f.disconnect=function(){0<arguments.length?Array.prototype.forEach.call(arguments,function(a){f.outputs[a].disconnect()}):f.outputs.forEach(function(a){a.disconnect()});return f};var g={},d=b(f);f.keep=function(a){var a=
a||f,c=b(a);return g[c]=a};f.drop=function(f){f?(f=b(f),delete g[f]):delete a._preservedNodes[d]};a._preservedNodes[d]=g;return f}function b(a){var b=a[c];b||(b=e++,Object.defineProperty(a,c,{value:b,writable:!1,enumerable:!1,configurable:!1}));return b}var e=1,c="#org.anclab.steller.GraphNode.globalid";a._preservedNodes={};a.chain=function(b){var c,e;c=0;for(e=b.length-1;c<e;++c)b[c].connect(b[c+1]);return a};return a}();i.getters={value:function(){return this._value},audioParam:function(){return this.audioParam.value}};
i.setters={value:function(a){return this._value=a},audioParam:function(a){return this.audioParam.value=a},option:function(a){return this._value=this.spec.limit(a)}};i.mappings={};i.mappings.linear={fromNorm:function(a,b){return a.spec.min+b*(a.spec.max-a.spec.min)},toNorm:function(a){return(a.value-a.spec.min)/(a.spec.max-a.spec.min)}};i.mappings.log={fromNorm:function(a,b){var e=a.spec,c=Math.log(e.min),e=Math.log(e.max);return Math.exp(c+b*(e-c))},toNorm:function(a){var b=a.spec,e=Math.log(b.min),
b=Math.log(b.max);return(Math.log(a.value)-e)/(b-e)}};i.names=function(a){return Object.keys(a).filter(function(b){return a[b]instanceof i})};i.expose=function(a,b,e){e||(e=i.names(a));e.forEach(function(c){b[c]=a[c]});return i};i.bind=function(a,b,e){a instanceof i?a.bind(b,e):"value"in a?e?e.update(function(){b.value=a.value}):b.value=a.value:e?e.update(function(){b.value=a}):b.value=a;return i};i.prototype.__defineGetter__("value",function(){return this.getter()});i.prototype.__defineSetter__("value",
function(a){return a!==this.getter()?j(this,this.setter(a)):a});i.prototype.watch=function(a){var b,e,c=this.watchers;b=0;for(e=c.length;b<e;++b)if(c[b]===a)return this;c.push(a);return this};i.prototype.unwatch=function(a){var b=this.watchers;if(1>arguments.length||!a)return b.splice(0,b.length),this;for(var e=b.length-1;0<=e;--e)if(b[e]===a){b.splice(e,1);break}return this};i.prototype.changed=function(){j(this,this.getter());return this};i.prototype.alias=function(a,b){var e=this,c=Object.create(e);
c.spec=Object.create(e.spec);c.spec.name=a;b&&(c.spec.label=b);c.getter=function(){return e.getter()};c.setter=function(a){return e.setter(a)};c.alias=function(a,b){return e.alias(a,b)};return c};i.prototype.bind=function(a,b){var e=this;if(a.addEventListener){var c=e.spec,f=c.mapping?i.mappings[c.mapping]:i.mappings.linear,g,d,h;if("checkbox"===a.type)g=function(){e.value=a.checked?1:0},d=b?function(){b.update(g)}:g,h=function(b){a.checked=b?!0:!1};else if("range"===a.type)g=function(){e.value=f.fromNorm(e,
parseFloat(a.value))},d=b?function(){b.update(g)}:g,h=function(){a.value=f.toNorm(e)};else throw Error("org.anclab.steller.Param.bind: Unsupported control type - "+a.type);h.elem=a;h.unbind=function(){a.removeEventListener(d);e.unwatch(h)};a.addEventListener("change",d);e.watch(h);h(e.value)}else if("string"===typeof a){var c=document.querySelectorAll(a),n,l;n=0;for(l=c.length;n<l;++n)this.bind(c[n])}else{var k=function(b){a.value=b};k.elem=a;k.unbind=function(){e.unwatch(k)};e.watch(k);a.value=e.value}return this};
i.prototype.unbind=function(a){if("string"===typeof a){var a=document.querySelectorAll(a),b,e;b=0;for(e=a.length;b<e;++b)this.unbind(a[b])}else{var c=this.watchers;b=0;for(e=c.length;b<e;++b)if(c[b].elem===a){c[b].unbind();break}}return this};l.prototype.toString=function(){return JSON.stringify([this.t1r,this.t2r-this.t1r,this.t1,this.t2-this.t1].map(h))};l.prototype.copy=function(){var a=new l(this.t1,this.t1r,this.dt,this.rate);this.data&&(a.data=Object.create(this.data));return a};l.prototype.advance=
function(a){this.t1+=a;this.t2+=a;return this};l.prototype.advanceTo=function(a){return this.advance(a-this.t1)};l.prototype.tick=function(){this.t1=this.t2;this.t2+=this.dt;this.t1r=this.t2r;this.t2r+=this.dt*this.rate.valueOf();return this};l.prototype.jumpTo=function(a){var a=a-this.t1,b=a*this.rate.valueOf();this.t1+=a;this.t2+=a;this.t1r+=b;this.t2r+=b;return this};l.prototype.syncWith=function(a){this.t1=a.t1;this.t2=this.t1+this.dt;this.t1r=a.t1r;this.t2r=this.t1r+this.rate.valueOf()*this.dt;
return this};l.prototype.nudgeToRel=function(a){a=Math.max(this.t1r,a);this.t2r>this.t1r&&(this.t1+=(a-this.t1r)*(this.t2-this.t1)/(this.t2r-this.t1r));this.t1r=a;return this};l.prototype.rel2abs=function(a){return this.t1+(a-this.t1r)/this.rate.valueOf()};l.prototype.abs2rel=function(a){return this.t1r+(a-this.t1)*this.rate.valueOf()};var E=function(a){function b(a){var b=Math.pow(10,4-Math.min(3,(""+(a-a%1)).length));return Math.round(a*b)/b}function e(a){return function(b){a.insertAdjacentElement("beforeend",
b)}}a.basicUI=function(a,f,g){if(f.ui)return f.ui;var d=a.createElement("div");g&&d.insertAdjacentHTML("beforeend","<p><b>"+g+"</b></p>");i.names(f).map(function(a){var b=Object.create(f[a].spec);b.name=b.name||a;b.param=f[a];return b}).forEach(function(f){var g=f.name,h=f.param;if("min"in f&&"max"in f){var n=a.createElement("div"),l=a.createElement("span"),r=a.createElement("span");l.innerText=(f.label||g)+": ";l.style.width="100px";l.style.display="inline-block";l.style.textAlign="left";var j=a.createElement("input");
j.type="range";j.min=0;j.max=1;j.step=0.0010;var m="string"===typeof f.mapping?i.mappings[f.mapping]:f.mapping||i.mappings.linear,q=f.units?" "+f.units:"";j.value=m.toNorm(h);r.innerText=" ("+b(h.value)+q+")";j.changeModelParameter=function(){h.value=m.fromNorm(h,parseFloat(this.value))};j.changeSliderValue=function(a){j.value=m.toNorm(h);r.innerText=" ("+b(a)+q+")"};j.addEventListener("change",j.changeModelParameter);h.watch(j.changeSliderValue);[l,j,r].forEach(e(n));d.insertAdjacentElement("beforeend",
n)}});return f.ui=d};return a}({});t.Eventable=u;t.AsyncEventable=function(a){var a=u(a),b=a.on;a.on=function c(f,g){if(2<arguments.length){for(var d=1,h=arguments.length;d<h;++d)c(f,arguments[d]);return this}if(!g)return this;(d=g.__steller_async_eventable__)||Object.defineProperty(g,"__steller_async_eventable__",{value:d=function(){var b=arguments;setTimeout(function(){g.apply(a,b)},0)},enumerable:!1,configurable:!1,writable:!1});b(f,d)};return a};t.GraphNode=M;t.SoundModel=function(a,b,e){a=u(M(a,
b,e));u.observe(a,"connect");u.observe(a,"disconnect");return a};t.Param=i;t.Scheduler=function(a,b){function e(a,b){a&&(A.add(a),A.add(b))}function c(a){a(k,w.copy(),f)}function f(){}function h(a,b,e){e&&e(a,b,f)}function j(a,b){return function(e,c,g){function d(e,c){var z=n+a.valueOf();0<B&&c.t1<w.t1&&c.advance(B);c.t1>G?h&&C.add(h):c.t2r<z?(b&&b(c,c.t1r,c.t2r,n,z),c.tick(),h&&C.add(h)):(b&&z>=c.t1r&&b(c,c.t1r,z,n,z),c.t2r>c.t1r?g(e,c.nudgeToRel(z),f):g(e,c,f))}function h(a){d(a,c,f)}var n=c.t1r;
d(e,c)}}function p(a){return function(b,f,c){a(f)(b,f,c)}}function y(a){function b(a,e,g){var d,h,F;if(0<c.length){F=c;c=[];d=0;for(h=F.length;d<h;++d)F[d](a,e.copy(),f)}g(a,e,f)}if(0<arguments.length)return function(a,b,f){for(;a<b;++a)f.push(y());return f}(0,a,[]);var c=[];b.play=function(a){c.push(a);return this};b.cancel=function(){c.splice(0,c.length);return this};return b}function K(a){function b(a,e,d){g?d(a,e,f):c.push({sched:a,next:d,clock:e})}if(0<arguments.length)return function(a,b,c){for(;a<
b;++a)c.push(K());return c}(0,a,[]);var c=[],e=[],g=!0;b.__defineGetter__("isOpen",function(){return g});b.__defineSetter__("isOpen",function(a){a?b.open():b.close();return a});b.open=function(a,b,e){g=!0;var d=c,h,F,n,j=D();c=[];h=0;for(F=d.length;h<F;++h)n=d[h],n.next(n.sched,b?b.copy():n.clock.advanceTo(j),f);e&&e(a,b,f)};b.close=function(a,b,c){g=!1;c&&c(a,b,f)};b.toggle=function(a,c,f){return g?b.close(a,c,f):b.open(a,c,f)};b.cancel=function(a,b,e){c.splice(0,c.length);e&&e(a,b,f)};b.push=function(a,
b,d){e.push({isOpen:g,cache:c});c=[];d&&d(a,b,f)};b.pop=function(a,b,d){var g=e.pop();c.push.apply(c,g.cache);this.isOpen=g.isOpen;d&&d(a,b,f)};return b}var k=this===o?{}:this,M=d(),t=q();if(g()&&!M)throw Error("Scheduler needs requestAnimationFrame support. Use a sufficiently modern browser version.");var N=0.0010,D=function(){if(a){if(a instanceof t)return N=1/a.sampleRate,a.createGainNode(),function(){return a.currentTime};throw Error("Scheduler: Argument is not an audio context");}return n()||
function(){return 0.0010*Date.now()}}(),E,s=!1;k.__defineGetter__("running",function(){return s});k.__defineSetter__("running",function(a){a?s||(s=!0,w.advanceTo(D()),E.start()):(s=!1,E.stop())});k.frame_rate=i({min:15,max:75,value:60});var C=new v("tick"),A=new v("frames"),u=new v("update");E=new m(function(){var a,b,c,f,e;a=!0;b=D();W(b);for(G=b+H;b-w.t1>T;)B=b-w.t1,w.advance(B);for(;a||w.t1<G;){if(0<u.length){c=u.length;for(a=0;a<c;++a)u.remove()()}c=C.length;for(a=0;a<c;++a)C.remove()(k,w,h);
w.t1<G&&w.tick();B=0;a=!1}if(0<A.length){c=A.length;for(a=0;a<c;a+=2)f=A.remove(),e=A.remove(),f(b,e)}if(k.ontick)k.ontick(b)},0,a);var J=1/60,O=J,H=E.computeAheadInterval_secs||0.05,T=5*H,w=new l(D(),0,H,1),G=w.t1,B=0,W=function(){var a=1/60,b=w.t1,c=15;return function(f){var e=f-b;0.01<e&&0.07>e&&(O=J=a+=0.05*(e-a),H=3.33*J,T=5*H,0>=c--&&(k.frame_rate.value=Math.round(1/J),c=15));b=f}}(),U=function(){return a?function V(b){0===a.currentTime?setTimeout(V,100,b):(w=new l(D(),0,H,1),G=w.t1,k.play=
U=c,c(b))}:c}(),P;b&&b.diagnostics?(4<=LOG_LEVEL&&console.log("scheduler.js[630]:\t","fire: diagnostics on"),P=function(a){return function(b,c,e){D();a(c);e(b,c,f)}}):P=function(a){return function(b,c,e){a(c);e(b,c,f)}};k.audioContext=a;k.update=function(a){a&&u.add(a)};k.perform=function(a,b,c){a(k,b,c)};k.cancel=function(){u.clear();C.clear();A.clear()};k.play=U;k.stop=f;k.cont=h;k.delay=j;k.loop=function(a){return function z(b,c){a(b,c,z)}};k.loop_while=function(a,b){return function(c,e,d){function g(){a.valueOf()?
b(c,e,g):d(c,e,f)}g()}};k.repeat=function(a,b){return function(c,e,d){function g(){if(h<a){h++;b(c,e,g)}else d(c,e,f)}var h=0;g()}};k.fork=function(a){a=a&&a.constructor===Function?Array.prototype.slice.call(arguments,0):a.slice(0);return function(b,c,e){function g(b,h){d++;d===a.length&&e(b,c.syncWith(h),f)}var d=0;a.forEach(function(a){a(b,c.copy(),g)})}};k.spawn=function(a){a=a&&a.constructor===Function?Array.prototype.slice.call(arguments,0):a.slice(0);return function(b,c,e){a.forEach(function(a){a(b,
c.copy(),f)});e(b,c,f)}};k.dynamic=p;k.track=function(a){function b(c,e,d,g,h){function n(b,c){if(j<k)a[j++](b,c,n);else d(b,c,f)}var j=0,k=a.length;if(arguments.length>3){j=g;k=h}n(c,e,d)}a&&a.constructor===Function&&(a=Array.prototype.slice.call(arguments,0));b.minIndex=0;b.maxIndex=a.length;b.models=a;return b};k.slice=function(a,b,c){c=arguments.length>2?c:a.maxIndex;b=arguments.length>1?Math.max(a.minIndex,Math.min(b,c)):a.minIndex;return function(e,f,d){a(e,f,d,b,c)}};k.fire=P;k.display=function(a){return function(b,
c,d){function g(b){b+O>h?a(c,h,b):e(g)}var h=c.t1;e(g);d(b,c,f)}};k.frame=function(a){return function(b,c,d){function g(n){if(n+O>h){c.jumpTo(n);a(c);d(b,c,f)}else e(g)}var h=c.t1;e(g)}};k.frames=function(a,b){return function(c,d,g){function h(b,c){var e,d=j+a.valueOf();if(B>0&&c.t1<w.t1){c.advance(B);if(i){l=l+void 0;i.intervals.length>4&&i.intervals.splice(0,i.intervals.length-4);if(i.intervals.length>0){i.intervals[0]=i.intervals[0]+void 0;i.intervals[3]=c.rate.valueOf()}}}if(c.t1>G)n&&C.add(n);
else{if(i&&c.t1r<=d){i.endTime=d;var m=c.rate.valueOf();for(e=Math.max(0.0010,J*m);k<c.t2r;){i.intervals.push(l);i.intervals.push(k);i.intervals.push(k+e);i.intervals.push(m);k=k+e}}if(c.t2r<d){c.tick();n&&C.add(n)}else{i.end=true;c.t2r>c.t1r?g(b,c.nudgeToRel(d),f):g(b,c,f)}}}function n(a){h(a,d,f)}var j=d.t1r,k=j,l=d.t1,m,i;if(b){m=function(a,c){if(c.intervals.length>0){var f=c.intervals[0],d=c.intervals[1],g=c.intervals[2],h=c.intervals[3];if(d<=c.endTime){if(f<O+a){b(c.clock,d,g,c.startTime,c.endTime,
h);c.intervals.splice(0,4)}e(m,c);return}}c.end||e(m,c)};i={clock:d,intervals:[],startTime:d.t1r,endTime:d.t1r+a.valueOf(),end:false};e(m,i)}h(c,d)}};k.log=function(a){return P(function(){console.log(a)})};k.anim=function(a,b){var c,e,f,d;switch(arguments.length){case 3:d=arguments[2];break;case 4:c=arguments[2];e=arguments[3];d=function(a){return(1-a)*c.valueOf()+a*e.valueOf()};break;case 5:c=arguments[2];e=arguments[3];f=arguments[4];d=function(a){a=f(a);return(1-a)*c.valueOf()+a*e.valueOf()};break;
default:throw Error("Invalid arguments to anim()");}return a.constructor.name==="AudioGain"||a.constructor.name==="AudioParam"?j(b,function(b,c,e,f,g){var g=g-f,h;if(c<=f){h=g>N?(c-f)/g:0;a.setValueAtTime(d(h),b.rel2abs(c))}a.linearRampToValueAtTime(d(g>N?(e-f)/g:1),b.rel2abs(e))}):j(b,function(b,c,e,f,g){b=g-f-(e-c);a.value=b>N?d((c-f)/b):d(1)})};k.rate=function(a){return function(b,c,e){c.rate=a;e(b,c,f)}};k.choice=function(a){return p(function(){return a[Math.floor(Math.random()*a.length)]})};
k.sync=y;k.gate=K;k.stats=function(){return{frame_jitter_ms:0}};k.running=b&&"running"in b&&b.running||!0;org.anclab.steller.Models&&(k.models=org.anclab.steller.Models(k));return k};t.Clock=l;t.PeriodicTimer=m;t.JSNodeTimer=function(a,b,e){if(e){var c=e.createJavaScriptNode(1024);c.onaudioprocess=function(){a()};var f=this,d=!1;p(c);f.start=function(){d||(d=!0,c.connect(e.destination))};f.stop=function(){d&&(c.disconnect(),d=!1)};f.__defineGetter__("running",function(){return d});f.__defineSetter__("running",
function(a){a?f.start():f.stop();return d});f.computeAheadInterval_secs=Math.round(2560)/e.sampleRate;return f}return m.call(this,a,b)};t.UI=E;t.Util={p2f:function(a){return 440*Math.pow(2,(a.valueOf()-69)/12)},f2p:function(a){a=69+12*Math.log(a.valueOf()/440)/Math.LN2;return Math.round(100*a)/100},augment:function(a,b){var e=org.anclab.steller;if(a in e)e[a].augmentors.push(b);else{var c=function(){var a=Array.prototype.slice.call(arguments,0),b={};c.augmentors.forEach(function(c){b=c.apply(b,a)||
b});return b};c.augmentors=[b];e[a]=c}return e[a]}};t.requestAnimationFrame=function(a){return function(b){return a(b)}}(d());t.AudioContext=q()})(function(){return"undefined"===typeof window?void 0:window}(),org.anclab.steller);
org.anclab.steller.Util.augment("Models",function(o){var t=org.anclab.steller,u=org.anclab.steller.Util,i=t.SoundModel,s=t.Param,j=o.audioContext,v=this;v.chime=function(){var m=j.createGainNode(),p=i({},[],[m]);p.halfLife=s({min:0.0010,max:10,value:0.5,mapping:"log"});p.attackTime=s({min:0,max:1,value:0.01});p.level=s({min:0.125,max:4,audioParam:m.gain,mapping:"log"});p.play=function(i,h){void 0===h&&(h=1);return o.fire(function(g){var d=u.p2f(i.valueOf()),q=j.createOscillator();q.type=q.SINE;q.frequency.value=
d;var n=j.createGainNode();n.gain.value=0;n.gain.setValueAtTime(0,g.t1);n.gain.linearRampToValueAtTime(h.valueOf()/8,g.t1+p.attackTime.value);var d=440*p.halfLife.value/d,y=10*d;n.gain.setTargetValueAtTime(0,g.t1+p.attackTime.value,d);q.connect(n);n.connect(m);q.noteOn(g.t1);q.stop(g.t1+y)})};return p};v.dc=function(){var m,p,l;l=j.createBuffer(1,1024,j.sampleRate);p=l.getChannelData(0);for(m=0;1024>m;++m)p[m]=1;return function(h){var g=j.createBufferSource();g.buffer=l;g.loop=!0;g.noteOn(0);var d=
j.createGainNode();d.gain.value=h;g.connect(d);h=i({},[],[d]);h.level=s({min:-1,max:1,audioParam:d.gain});h.stop=function(d){g.stop(d)};return h}}();v.noise=function(){var m=j.createBuffer(1,5*j.sampleRate,j.sampleRate),p,l,h=m.getChannelData(0);p=0;for(l=h.length;p<l;++p)h[p]=2*Math.random()-1;return function(){var g=j.createBufferSource();g.buffer=m;g.loop=!0;g.gain.value=1;var d=j.createGainNode();d.gain.value=1;g.connect(d);g.noteOn(0);var h=v.dc(0);h.connect(d);d=i({},[],[d]);d.spread=s({min:0.01,
max:10,audioParam:g.gain});d.mean=h.level;return d}}();v.probe=function(){var m=s({min:-1,max:1,value:0}),p=s({min:-1,max:1,value:1}),l=s({min:0,max:1,value:0}),h=j.createJavaScriptNode(512,1,1),g=0,d=0,q=1-Math.exp(Math.log(0.5)/1024);h.onaudioprocess=function(h){for(var h=h.inputBuffer.getChannelData(0),j=h.length,i=0,o=0,i=0;i<j;++i)o=h[i],g+=q*(o-g),d+=q*(o*o-d);m.value=g;l.value=d;p.value=Math.sqrt(Math.max(0,d-g*g))};h.connect(j.destination);h=i({},[h],[]);h.mean=m;h.sigma=p;h.energy=l;return h};
v.mic=function(){function m(h,g,d){try{navigator.webkitGetUserMedia(h,g,d)}catch(j){d(j)}}function p(h,g){l||(l=j.createMediaStreamSource(g));l.connect(h.outputs[0]);h.error=null;h.ready.value=1}var l;return function(){var h=j.createGainNode(),g=i({},[],[h]);g.ready=s({min:-1,max:1,value:0});g.gain=s({min:0,max:1,audioParam:h.gain});l?p(g,null):m({audio:!0},function(d){return p(g,d)},function(d){g.error=d;g.gain.value=0;g.ready.value=-1});return g}}();v.spectrum=function(m,p){function l(){if(q){var d=
j.currentTime;h.getFloatFrequencyData(g.bins);for(var i=0,m=g.bins,p=m.length;i<p;++i)m[i]=Math.pow(10,m[i]/20);q=t.requestAnimationFrame(l);g.time.value=d}}var m=m||1024,h=j.createAnalyser();h.fftSize=2*m;h.frequencyBinCount=m;h.smoothingTimeConstant=2>arguments.length?0.1:p;var g=i({},[h],[]);g.bins=new Float32Array(m);g.freqs=new Float32Array(m);g.time=s({min:0,max:1E9,value:0});for(var d=0;d<m;++d)g.freqs[d]=d*j.sampleRate/h.fftSize;var q;g.start=o.fire(function(){q||(q=t.requestAnimationFrame(l))});
g.stop=o.fire(function(){q=void 0});return g};(function(){var m={};v.load_sample=function(i,l,h){var g="sound:"+i,d=m[g];if(d)return l&&l(d),d;if(l){var q=new XMLHttpRequest;q.open("GET",i,!0);q.responseType="arraybuffer";q.onerror=function(d){h&&h(d,i)};q.onload=function(){j.decodeAudioData(q.response,function(d){l(m[g]=d);0<=LOG_LEVEL&&console.log("models/sample.js[31]:\t","Sound ["+i+"] loaded!")},function(d){h&&h(d,i)})};q.send()}};v.load_sample.clearCache=function(){m={}};v.sample=function(m,
l){function h(h,i,m,l,p){var a=j.createBufferSource();a.buffer=q;a.connect(g);a.playbackRate.value=i;a.gain.setValueAtTime(0,h.t1);a.gain.setTargetValueAtTime(m,h.t1,d.attackTime.value/3);3<arguments.length?a.noteGrainOn(h.t1,l,4<arguments.length?p:a.duration):a.noteOn(h.t1);return a}var g=j.createGainNode();g.gain.value=0.25;var d=i({},[],[g]);d.level=s({min:0.0010,max:10,audioParam:g.gain,mapping:"log"});d.attackTime=s({min:0.0010,max:10,value:0.02,mapping:"log"});d.releaseTime=s({min:0.0010,max:10,
value:0.1,mapping:"log"});var q;d.load=function(g,h,i){if(q)g.perform(i,h,g.stop);else{var o=h.t1-j.currentTime;v.load_sample(m,function(m){q=m;d.duration=q.duration;g.perform(i,h.jumpTo(j.currentTime+o),g.stop)},l)}};d.trigger=function(d,g){g=g||0;return o.fire(function(i){var j=Math.pow(2,g.valueOf()/12);h(i,j,d.valueOf())})};d.play=o.track([d.load,o.dynamic(function(g){var i=h(g,g.rate.valueOf(),1);return o.delay(d.duration,function(d){i.playbackRate.value=d.rate.valueOf()})})]);d.note=function(g,
i,j,m){4>arguments.length&&(m=j);return o.dynamic(function(l){var a=h(l,g.valueOf(),1,i,j);a.gain.value=0;a.gain.setTargetValueAtTime(1,l.t1,d.attackTime.value/3);a.playbackRate.setTargetValueAtTime(g.valueOf(),l.t1,l.dt/3);return o.track([o.spawn(o.track([o.delay(m),o.fire(function(b){a.gain.setTargetValueAtTime(0,b.t1,d.releaseTime.value/3);a.stop(b.t1+12*d.releaseTime.value)})])),o.delay(j,function(b){a.playbackRate.exponentialRampToValueAtTime(g.valueOf(),b.t1)})])})};return d};v.sample.clearCache=
v.load_sample.clearCache})();v.jsnode=function(m){var p=m.numberOfInputs||0,l=p+(m.audioParams?m.audioParams.length:0),h=m.numberOfOutputs||1,g=0<l?j.createChannelMerger(l):void 0,d=0<h?j.createChannelSplitter(h):void 0,q=[],n,o,s;n=0;for(o=l;n<o;++n)s=j.createGainNode(),q.push(s),s.connect(g,0,n);var t=[];n=0;for(o=h;n<o;++n)s=j.createGainNode(),t.push(s),d&&d.connect(s,n);var u;u=m.audioParams?Object.keys(m.audioParams):[];var a={},b=[],e=[];a.inputs=b;a.outputs=e;n=0;for(o=u.length;n<o;++n)a[u[n]]=
null;a.playbackTime=j.currentTime;var c=!1,f=!1,r=0,Q=Infinity,R,x=i({},q,t),L=0<u.length?v.dc(1):void 0;u.forEach(function(a,b){var c=q[p+b];x[a]=c.gain;c.gain.value=m.audioParams[a];L.connect(c)});var k=x.keep(j.createScriptProcessor(m.bufferLength||512,l,Math.min(1,h)));g&&g.connect(k);k.onaudioprocess=function(c){var d,g,i,k,l;d=0;if(!f){var n=c.outputBuffer.length;i=Math.floor(j.currentTime*j.sampleRate);k=Math.max(i,r);l=i+n;var o=k-i;i=l-i;if(l>k){d=0;for(g=p;d<g;++d)b[d]=c.inputBuffer.getChannelData(d).subarray(o,
i);d=0;for(g=h;d<g;++d)e[d]=c.outputBuffer.getChannelData(d).subarray(o,i);d=0;for(g=u.length;d<g;++d)a[u[d]]=c.inputBuffer.getChannelData(p+d).subarray(o,i);a.playbackTime=(c.playbackTime||j.currentTime)+o/j.sampleRate;a.samplesToStop=Q-k;d=m.onaudioprocess.call(x,a);void 0===d&&(d=l-k)}k+d<l&&(1<=LOG_LEVEL&&console.log("models/jsnode.js[168]:\t","Finished",l,Q),f=!0,setTimeout(R,Math.round(1E3*n/j.sampleRate)))}};var S=d||j.destination;R=function(){f=!0;k.disconnect();d&&d.disconnect();L&&(L.stop(0),
L.disconnect());g&&g.disconnect();x.drop(k);x.emit&&x.emit("finished")};var I;x.prepareAheadTime=0.1;x.start=function(a){if(!c&&!f)if(a){var b=Math.max(a,j.currentTime)-j.currentTime;I&&(cancelTimeout(I),I=null);var d=function(a){r=Math.floor(a*j.sampleRate);c=true;I=null;k.connect(S)};b<=x.prepareAheadTime?d(a):I=setTimeout(d,Math.round(1E3*(b-x.prepareAheadTime)),a)}else c=!0,k.connect(S)};x.stop=function(a){f||(Q=Math.max(r,Math.ceil(a*j.sampleRate)))};0<p&&x.start(0);return x};return v});
