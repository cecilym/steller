var LOG_LEVEL=1;org="undefined"===typeof org?{}:org;org.anclab=org.anclab||{};org.anclab.steller=org.anclab.steller||{};
(function(q,s){function u(a){var b={};a.on=function(a,f){var a=z(a),i=b[a]||(b[a]={}),g=f.__steller_eventable_id__||0;if(g in i)return this;g||Object.defineProperty(f,"__steller_eventable_id__",{value:g=L++,enumerable:!1,configurable:!1,writable:!1});i[g]=f;return this};a.off=function(a,f){var a=z(a),i=b[a];if(!i)return this;var g=f&&f.__steller_eventable_id__||0;g?delete i[g]:f||delete b[a];return this};a.emit=function(a){var a=z(a),f=b[a];if(!f)return this;for(var i in f)try{f[i].apply(this,arguments)}catch(g){1<=
LOG_LEVEL&&console.log("eventable.js[107]:\t","Exception in event watcher - ",g)}return this};return a}function j(a){var b=Object.create(j.prototype);b.spec=a=t(Object.create(a));b.getter=void 0;b.setter=void 0;b.valueOf=void 0;b.audioParam=void 0;b.watchers=[];b._value=void 0;a.audioParam?(b.audioParam=a.audioParam,b.getter=a.getter||j.getters.audioParam,b.setter=a.setter||j.setters.audioParam):a.options?(b.getter=a.getter||j.getters.value,b.setter=a.setter||j.setters.option):(b.getter=a.getter||
j.getters.value,b.setter=a.setter||j.setters.value);b.valueOf=b.getter;"value"in a&&b.setter(a.value);return b}function t(a){if(a.options){var b={};a.options.forEach(function(a,f){b["option:"+a]=f+1});a.limit=function(c){if("number"===typeof c){if(0<=c&&c<a.options.length)return a.options[c];throw Error("Invalid enumeration index");}if(b["option:"+c])return c;throw Error("Invalid enumeration value");}}return a}function l(a,b){var c,f,i=a.watchers;c=0;for(f=i.length;c<f;++c)i[c](b,a);return b}function v(){var a=
0,b=4,c=[null,null,null,null],f=-1,i=0;this.length=0;this.add=function(g){if(a>=b){var e=Array(2*b),d,h,o,k;d=f;h=0;o=a;for(k=b;h<o;++h,d=(d+1)%k)e[h]=c[d];c=e;i=a;f=0===a?-1:0;b*=2}c[i]=g;0>f&&(f=i);i=(i+1)%b;return this.length=a+=1};this.remove=function(){if(0>=a)throw Error("Empty queue");var i=c[f];c[f]=null;f=(f+1)%b;this.length=a-=1;return i};this.clear=function(){this.length=a=0;c.splice(0,c.length,null,null,null,null);b=4;f=-1;i=0};return this}function m(a,b){var c=e();if(d()&&!c)throw Error("PeriodicTimer needs requestAnimationFrame support. Use a sufficiently modern browser.");
var f=this,i=!1,g,b=void 0===b?15:Math.min(Math.max(d()?15:1,b),33);c&&12<=b?(f.start=function(){i||(i=!0,c(function(){i&&(c(arguments.callee),a())}))},f.stop=function(){i=!1}):(f.start=function(){i||(i=!0,g=setInterval(a,1))},f.stop=function(){i&&(i=!1,clearInterval(g),g=void 0)});f.__defineGetter__("running",function(){return i});f.__defineSetter__("running",function(a){a?f.start():f.stop();return i});f.computeAheadInterval_secs=Math.round(3.333*b)/1E3;return f}function r(a){(q.JSNodeTimer_jsnodes||
(q.JSNodeTimer_jsnodes=[])).push(a)}function k(a,b,c,f){this.dt=c;this.t1=a;this.t2=a+c;this.t1r=b;this.t2r=b+f.valueOf()*c;this.rate=f;this.data=null;return this}function h(a){return Math.round(1E3*a)/1E3}function d(){return"object"===typeof q&&"object"===typeof document&&q.document===document}function e(){try{return q.requestAnimationFrame||q.webkitRequestAnimationFrame||q.mozRequestAnimationFrame||q.msRequestAnimationFrame||function(a){setTimeout(a,1E3/60)}}catch(a){}}function n(){(function(){function a(a,
i,c){a[c]=a[c]||a[i];b(a,i,c)}function b(a,b,c){var d=a[b];a[b]=function(){console.warn("Web Audio API: Deprecated name %s used. Use %s instead.",b,c);a[b]=d||a[c];return d.apply(this,arguments)}}var c=this;c.AudioContext=function(c){if(c)return function(){var i,g,d;if(0===arguments.length)i=new c;else if(3===arguments.length)i=new c(arguments[0],arguments[1],arguments[2]);else throw Error("Invalid instantiation of AudioContext");a(i,"createGainNode","createGain");a(i,"createDelayNode","createDelay");
a(i,"createJavaScriptNode","createScriptProcessor");a(i,"createWaveTable","createPeriodicWave");g=Object.getPrototypeOf(i.createGain().gain);d=Object.getPrototypeOf(g);d.setValueAtTime&&(console.warn("Implementation uses extra dummy interface for AudioGainParam. This will be removed."),g=d);a(g,"setTargetValueAtTime","setTargetAtTime");g=Object.getPrototypeOf(i.createBufferSource());a(g,"noteOff","stop");g.start?(b(g,"noteOn","start"),b(g,"noteGrainOn","start")):(console.warn("Web Audio API: Only BufferSource.note[Grain]On available. Providing BufferSource.start."),
g.start=function(a,b,c){switch(arguments.length){case 1:return this.noteOn(a);case 3:return this.noteGrainOn(a,b,c);default:throw Error("Invalid arguments to BufferSource.start");}},b(g,"noteOn","start"),b(g,"noteOff","stop"));g=Object.getPrototypeOf(i.createOscillator());a(g,"noteOn","start");a(g,"noteOff","stop");a(g,"setWaveTable","setPeriodicWave");return i};console.warn("Web Audio API not supported on this client.")}(c.AudioContext||c.webkitAudioContext);c.webkitAudioContext=function(){console.warn('Use "new AudioContext" instead of "new webkitAudioContext".');
switch(arguments.length){case 0:return new c.AudioContext;case 3:return new c.AudioContext(arguments[0],arguments[1],arguments[2]);default:throw Error("Invalid AudioContext creation");}}})();return AudioContext}function o(){try{var a=q.performance,b=a&&(a.now||a.webkitNow||a.mozNow);if(b)return function(){return 0.0010*b.call(a)}}catch(c){}return function(){return 0.0010*Date.now()}}var z=function(){var a={};return function(b){if(a[b])throw Error("Invalid event name - "+b);return b}}(),L=1;u.observe=
function(a,b,c){var c=z(c||b),f=a[b];a[b]=function(){var a=f.apply(this,arguments),b=Array.prototype.slice.call(arguments);b.unshift(c);this.emit.apply(this,b);return a};return a};var N=function(){function a(c,f,d){c.inputs=f||[];c.outputs=d||[];c.numberOfInputs=c.inputs.length;c.numberOfOutputs=c.outputs.length;c.context=c.inputs[0]&&c.inputs[0].context||c.outputs[0]&&c.outputs[0].context;c.connect=function(a,b,f){var g,a=a||c.context.destination,b=c.outputs[b||0];g=a.inputs?a.inputs[f||0]:a;if("AudioParam"===
g.constructor.name||"AudioGain"===g.constructor.name)b.connect(g);else if(g.numberOfInputs===b.numberOfOutputs){a=0;for(f=g.numberOfInputs;a<f;++a)b.connect(g,a,a)}else b.connect(g);return c};c.disconnect=function(){0<arguments.length?Array.prototype.forEach.call(arguments,function(a){c.outputs[a].disconnect()}):c.outputs.forEach(function(a){a.disconnect()});return c};var e={},h=b(c);c.keep=function(a){var a=a||c,f=b(a);return e[f]=a};c.drop=function(c){c?(c=b(c),delete e[c]):delete a._preservedNodes[h]};
a._preservedNodes[h]=e;return c}function b(a){var b=a[f];b||(b=c++,Object.defineProperty(a,f,{value:b,writable:!1,enumerable:!1,configurable:!1}));return b}var c=1,f="#org.anclab.steller.GraphNode.globalid";a._preservedNodes={};a.chain=function(b){var c,f;c=0;for(f=b.length-1;c<f;++c)b[c].connect(b[c+1]);return a};return a}();j.getters={value:function(){return this._value},audioParam:function(){return this.audioParam.value}};j.setters={value:function(a){return this._value=a},audioParam:function(a){return this.audioParam.value=
a},option:function(a){return this._value=this.spec.limit(a)}};j.mappings={};j.mappings.linear={fromNorm:function(a,b){return a.spec.min+b*(a.spec.max-a.spec.min)},toNorm:function(a){return(a.value-a.spec.min)/(a.spec.max-a.spec.min)}};j.mappings.log={fromNorm:function(a,b){var c=a.spec,f=Math.log(c.min),c=Math.log(c.max);return Math.exp(f+b*(c-f))},toNorm:function(a){var b=a.spec,c=Math.log(b.min),b=Math.log(b.max);return(Math.log(a.value)-c)/(b-c)}};j.names=function(a){return Object.keys(a).filter(function(b){return a[b]instanceof
j})};j.expose=function(a,b,c){c||(c=j.names(a));c.forEach(function(c){b[c]=a[c]});return j};j.bind=function(a,b,c){a instanceof j?a.bind(b,c):"value"in a?c?c.update(function(){b.value=a.value}):b.value=a.value:c?c.update(function(){b.value=a}):b.value=a;return j};j.prototype.__defineGetter__("value",function(){return this.getter()});j.prototype.__defineSetter__("value",function(a){return a!==this.getter()?l(this,this.setter(a)):a});j.prototype.watch=function(a){var b,c,f=this.watchers;b=0;for(c=f.length;b<
c;++b)if(f[b]===a)return this;f.push(a);return this};j.prototype.unwatch=function(a){var b=this.watchers;if(1>arguments.length||!a)return b.splice(0,b.length),this;for(var c=b.length-1;0<=c;--c)if(b[c]===a){b.splice(c,1);break}return this};j.prototype.changed=function(){l(this,this.getter());return this};j.prototype.alias=function(a,b){var c=this,f=Object.create(c);f.spec=Object.create(c.spec);f.spec.name=a;b&&(f.spec.label=b);f.getter=function(){return c.getter()};f.setter=function(a){return c.setter(a)};
f.alias=function(a,b){return c.alias(a,b)};return f};j.prototype.bind=function(a,b){var c=this;if(a.addEventListener){var f=c.spec,i=f.mapping?j.mappings[f.mapping]:j.mappings.linear,g,d,e;if("checkbox"===a.type)g=function(){c.value=a.checked?1:0},d=b?function(){b.update(g)}:g,e=function(b){a.checked=b?!0:!1};else if("range"===a.type)g=function(){c.value=i.fromNorm(c,parseFloat(a.value))},d=b?function(){b.update(g)}:g,e=function(){a.value=i.toNorm(c)};else throw Error("org.anclab.steller.Param.bind: Unsupported control type - "+
a.type);e.elem=a;e.unbind=function(){a.removeEventListener(d);c.unwatch(e)};a.addEventListener("change",d);c.watch(e);e(c.value)}else if("string"===typeof a){var f=document.querySelectorAll(a),h,o;h=0;for(o=f.length;h<o;++h)this.bind(f[h])}else{var k=function(b){a.value=b};k.elem=a;k.unbind=function(){c.unwatch(k)};c.watch(k);a.value=c.value}return this};j.prototype.unbind=function(a){if("string"===typeof a){var a=document.querySelectorAll(a),b,c;b=0;for(c=a.length;b<c;++b)this.unbind(a[b])}else{var f=
this.watchers;b=0;for(c=f.length;b<c;++b)if(f[b].elem===a){f[b].unbind();break}}return this};k.prototype.toString=function(){return JSON.stringify([this.t1r,this.t2r-this.t1r,this.t1,this.t2-this.t1].map(h))};k.prototype.copy=function(){var a=new k(this.t1,this.t1r,this.dt,this.rate);this.data&&(a.data=Object.create(this.data));return a};k.prototype.advance=function(a){this.t1+=a;this.t2+=a;return this};k.prototype.advanceTo=function(a){return this.advance(a-this.t1)};k.prototype.tick=function(){this.t1=
this.t2;this.t2+=this.dt;this.t1r=this.t2r;this.t2r+=this.dt*this.rate.valueOf();return this};k.prototype.jumpTo=function(a){var a=a-this.t1,b=a*this.rate.valueOf();this.t1+=a;this.t2+=a;this.t1r+=b;this.t2r+=b;return this};k.prototype.syncWith=function(a){this.t1=a.t1;this.t2=this.t1+this.dt;this.t1r=a.t1r;this.t2r=this.t1r+this.rate.valueOf()*this.dt;return this};k.prototype.nudgeToRel=function(a){a=Math.max(this.t1r,a);this.t2r>this.t1r&&(this.t1+=(a-this.t1r)*(this.t2-this.t1)/(this.t2r-this.t1r));
this.t1r=a;return this};k.prototype.rel2abs=function(a){return this.t1+(a-this.t1r)/this.rate.valueOf()};k.prototype.abs2rel=function(a){return this.t1r+(a-this.t1)*this.rate.valueOf()};var E=function(a){function b(a){var b=Math.pow(10,4-Math.min(3,(""+(a-a%1)).length));return Math.round(a*b)/b}function c(a){return function(b){a.insertAdjacentElement("beforeend",b)}}a.basicUI=function(a,d,g){if(d.ui)return d.ui;var e=a.createElement("div");g&&e.insertAdjacentHTML("beforeend","<p><b>"+g+"</b></p>");
j.names(d).map(function(a){var b=Object.create(d[a].spec);b.name=b.name||a;b.param=d[a];return b}).forEach(function(g){var d=g.name,i=g.param;if("min"in g&&"max"in g){var h=a.createElement("div"),o=a.createElement("span"),k=a.createElement("span");o.innerText=(g.label||d)+": ";o.style.width="100px";o.style.display="inline-block";o.style.textAlign="left";var l=a.createElement("input");l.type="range";l.min=0;l.max=1;l.step=0.0010;var m="string"===typeof g.mapping?j.mappings[g.mapping]:g.mapping||j.mappings.linear,
n=g.units?" "+g.units:"";l.value=m.toNorm(i);k.innerText=" ("+b(i.value)+n+")";l.changeModelParameter=function(){i.value=m.fromNorm(i,parseFloat(this.value))};l.changeSliderValue=function(a){l.value=m.toNorm(i);k.innerText=" ("+b(a)+n+")"};l.addEventListener("change",l.changeModelParameter);i.watch(l.changeSliderValue);[o,l,k].forEach(c(h));e.insertAdjacentElement("beforeend",h)}});return d.ui=e};return a}({});s.Eventable=u;s.AsyncEventable=function(a){var a=u(a),b=a.on;a.on=function(c,f){if(!f)return this;
var d=f.__steller_async_eventable__;d||Object.defineProperty(f,"__steller_async_eventable__",{value:d=function(){var b=arguments;setTimeout(function(){f.apply(a,b)},0)},enumerable:!1,configurable:!1,writable:!1});b(c,d)};return a};s.GraphNode=N;s.SoundModel=function(a,b,c){a=u(N(a,b,c));u.observe(a,"connect");u.observe(a,"disconnect");return a};s.Param=j;s.Scheduler=function(a,b){function c(a){a&&t.add(a)}function f(a,b){a&&(A.add(a),A.add(b))}function i(a){a(p,w.copy(),g)}function g(){}function h(a,
b,c){c&&c(a,b,g)}function l(a,b){return function(f,d,e){function i(f,d){var y=o+a.valueOf();0<B&&d.t1<w.t1&&d.advance(B);d.t1>G?c(h):d.t2r<y?(b&&b(d,d.t1r,d.t2r,o,y),d.tick(),c(h)):(b&&y>=d.t1r&&b(d,d.t1r,y,o,y),d.t2r>d.t1r?e(f,d.nudgeToRel(y),g):e(f,d,g))}function h(a){i(a,d,g)}var o=d.t1r;i(f,d)}}function r(a){return function(b,c,d){a(c)(b,c,d)}}function z(a){function b(a,d,f){var e,i,F;if(0<c.length){F=c;c=[];e=0;for(i=F.length;e<i;++e)F[e](a,d.copy(),g)}f(a,d,g)}if(0<arguments.length)return function(a,
b,c){for(;a<b;++a)c.push(z());return c}(0,a,[]);var c=[];b.play=function(a){c.push(a);return this};b.cancel=function(){c.splice(0,c.length);return this};return b}function L(a){function b(a,d,e){f?e(a,d,g):c.push({sched:a,next:e,clock:d})}if(0<arguments.length)return function(a,b,c){for(;a<b;++a)c.push(L());return c}(0,a,[]);var c=[],d=[],f=!0;b.__defineGetter__("isOpen",function(){return f});b.__defineSetter__("isOpen",function(a){a?b.open():b.close();return a});b.open=function(a,b,d){f=!0;var e=
c,i,F,h,o=D();c=[];i=0;for(F=e.length;i<F;++i)h=e[i],h.next(h.sched,b?b.copy():h.clock.advanceTo(o),g);d&&d(a,b,g)};b.close=function(a,b,c){f=!1;c&&c(a,b,g)};b.toggle=function(a,c,d){return f?b.close(a,c,d):b.open(a,c,d)};b.cancel=function(a,b,d){c.splice(0,c.length);d&&d(a,b,g)};b.push=function(a,b,e){d.push({isOpen:f,cache:c});c=[];e&&e(a,b,g)};b.pop=function(a,b,f){var e=d.pop();c.push.apply(c,e.cache);this.isOpen=e.isOpen;f&&f(a,b,g)};return b}var p=this===q?{}:this,N=e();n();if(d()&&!N)throw Error("Scheduler needs requestAnimationFrame support. Use a sufficiently modern browser version.");
var O=0.0010,D=function(){if(a){if(a.createGain||a.createGainNode)return O=1/a.sampleRate,a.createGain=a.createGainNode=a.createGain||a.createGainNode,a.createGainNode(),function(){return a.currentTime};throw Error("Scheduler: Argument is not an audio context");}return o()||function(){return 0.0010*Date.now()}}(),s,E=!1;p.__defineGetter__("running",function(){return E});p.__defineSetter__("running",function(a){a?E||(E=!0,w.advanceTo(D()),i.activeFunc&&(i=i.activeFunc,H=H.activeFunc),s.start()):(E=
!1,s.stop(),i=function(a){function b(a){c(a)}b.activeFunc=a;return b}(i),H=function(a){function b(d){c(function(){a(d)})}b.activeFunc=a;return b}(H))});p.frame_rate=j({min:15,max:75,value:60});var t=new v("tick"),A=new v("frames"),u=new v("update");s=new m(function(){var a,b,c,d,f;a=!0;b=D();V(b);for(G=b+I;b-w.t1>T;)B=b-w.t1,w.advance(B);for(;a||w.t1<G;){if(0<u.length){c=u.length;for(a=0;a<c;++a)u.remove()()}c=t.length;for(a=0;a<c;++a)t.remove()(p,w,h);w.t1<G&&w.tick();B=0;a=!1}if(0<A.length){c=A.length;
for(a=0;a<c;a+=2)d=A.remove(),f=A.remove(),d(b,f)}if(p.ontick)p.ontick(b)},0,a);var K=1/60,P=K,I=s.computeAheadInterval_secs||0.05,T=5*I,w=new k(D(),0,I,1),G=w.t1,B=0,V=function(){var a=1/60,b=w.t1,c=15;return function(d){var f=d-b;0.01<f&&0.07>f&&(P=K=a+=0.05*(f-a),I=3.33*K,T=5*I,0>=c--&&(p.frame_rate.value=Math.round(1/K),c=15));b=d}}(),H=function(){return a?function U(b){0===a.currentTime?setTimeout(U,100,b):(w=new k(D(),0,I,1),G=w.t1,p.play=H=i,i(b))}:i}(),Q;b&&b.diagnostics?(4<=LOG_LEVEL&&console.log("scheduler.js[649]:\t",
"fire: diagnostics on"),Q=function(a){return function(b,c,d){D();a(c);d(b,c,g)}}):Q=function(a){return function(b,c,d){a(c);d(b,c,g)}};p.audioContext=a;p.update=function(a){a&&u.add(a)};p.perform=function(a,b,c){a(p,b,c)};p.cancel=function(){u.clear();t.clear();A.clear()};p.play=H;p.stop=g;p.cont=h;p.delay=l;p.loop=function(a){return function y(b,c){a(b,c,y)}};p.loop_while=function(a,b){return function(c,d,f){function e(){a.valueOf()?b(c,d,e):f(c,d,g)}e()}};p.repeat=function(a,b){return function(c,
d,f){function e(){if(i<a){i++;b(c,d,e)}else f(c,d,g)}var i=0;e()}};p.fork=function(a){a=a&&a.constructor===Function?Array.prototype.slice.call(arguments,0):a.slice(0);return function(b,c,d){function f(b,i){e++;e===a.length&&d(b,c.syncWith(i),g)}var e=0;a.forEach(function(a){a(b,c.copy(),f)})}};p.spawn=function(a){a=a&&a.constructor===Function?Array.prototype.slice.call(arguments,0):a.slice(0);return function(b,c,d){a.forEach(function(a){a(b,c.copy(),g)});d(b,c,g)}};p.dynamic=r;p.track=function(a){function b(c,
d,f,e,i){function h(b,c){if(o<l)a[o++](b,c,h);else f(b,c,g)}var o=0,l=a.length;if(arguments.length>3){o=e;l=i}h(c,d,f)}a&&a.constructor===Function&&(a=Array.prototype.slice.call(arguments,0));b.minIndex=0;b.maxIndex=a.length;b.models=a;return b};p.slice=function(a,b,c){c=arguments.length>2?c:a.maxIndex;b=arguments.length>1?Math.max(a.minIndex,Math.min(b,c)):a.minIndex;return function(d,f,e){a(d,f,e,b,c)}};p.fire=Q;p.display=function(a){return function(b,c,d){function e(b){b+P>i?a(c,i,b):f(e)}var i=
c.t1;f(e);d(b,c,g)}};p.frame=function(a){return function(b,c,d){function e(h){if(h+P>i){c.jumpTo(h);a(c);d(b,c,g)}else f(e)}var i=c.t1;f(e)}};p.frames=function(a,b){return function(d,e,i){function h(b,d){var f,e=l+a.valueOf();if(B>0&&d.t1<w.t1){d.advance(B);if(n){m=m+void 0;n.intervals.length>4&&n.intervals.splice(0,n.intervals.length-4);if(n.intervals.length>0){n.intervals[0]=n.intervals[0]+void 0;n.intervals[3]=d.rate.valueOf()}}}if(d.t1>G)c(o);else{if(n&&d.t1r<=e){n.endTime=e;var j=d.rate.valueOf();
for(f=Math.max(0.0010,K*j);k<d.t2r;){n.intervals.push(m);n.intervals.push(k);n.intervals.push(k+f);n.intervals.push(j);k=k+f}}if(d.t2r<e){d.tick();c(o)}else{if(n)n.end=true;d.t2r>d.t1r?i(b,d.nudgeToRel(e),g):i(b,d,g)}}}function o(a){h(a,e,g)}var l=e.t1r,k=l,m=e.t1,j,n;if(b){j=function(a,c){if(c.intervals.length>0){var d=c.intervals[0],e=c.intervals[1],g=c.intervals[2],i=c.intervals[3];if(e<=c.endTime){if(d<P+a){b(c.clock,e,g,c.startTime,c.endTime,i);c.intervals.splice(0,4)}f(j,c);return}}c.end||f(j,
c)};n={clock:e,intervals:[],startTime:e.t1r,endTime:e.t1r+a.valueOf(),end:false};f(j,n)}h(d,e)}};p.log=function(a){return Q(function(){console.log(a)})};p.anim=function(a,b){var c,d,f,e;switch(arguments.length){case 3:e=arguments[2];break;case 4:c=arguments[2];d=arguments[3];e=function(a){return(1-a)*c.valueOf()+a*d.valueOf()};break;case 5:c=arguments[2];d=arguments[3];f=arguments[4];e=function(a){a=f(a);return(1-a)*c.valueOf()+a*d.valueOf()};break;default:throw Error("Invalid arguments to anim()");
}return a.constructor.name==="AudioGain"||a.constructor.name==="AudioParam"?l(b,function(b,c,d,f,g){var g=g-f,i;if(c<=f){i=g>O?(c-f)/g:0;a.setValueAtTime(e(i),b.rel2abs(c))}a.linearRampToValueAtTime(e(g>O?(d-f)/g:1),b.rel2abs(d))}):l(b,function(b,c,d,f,g){b=g-f-(d-c);a.value=b>O?e((c-f)/b):e(1)})};p.rate=function(a){return function(b,c,d){c.rate=a;d(b,c,g)}};p.choice=function(a){return r(function(){return a[Math.floor(Math.random()*a.length)]})};p.sync=z;p.gate=L;p.stats=function(){return{frame_jitter_ms:0}};
p.running=b&&"running"in b&&b.running||!0;org.anclab.steller.Models&&(p.models=org.anclab.steller.Models(p));return p};s.Clock=k;s.PeriodicTimer=m;s.JSNodeTimer=function(a,b,c){if(c){var d=c.createJavaScriptNode(1024);d.onaudioprocess=function(){a()};var e=this,g=!1;r(d);e.start=function(){g||(g=!0,d.connect(c.destination))};e.stop=function(){g&&(d.disconnect(),g=!1)};e.__defineGetter__("running",function(){return g});e.__defineSetter__("running",function(a){a?e.start():e.stop();return g});e.computeAheadInterval_secs=
Math.round(2560)/c.sampleRate;return e}return m.call(this,a,b)};s.UI=E;s.Util={p2f:function(a){return 440*Math.pow(2,(a.valueOf()-69)/12)},f2p:function(a){a=69+12*Math.log(a.valueOf()/440)/Math.LN2;return Math.round(100*a)/100},augment:function(a,b){var c=org.anclab.steller;if(a in c)c[a].augmentors.push(b);else{var d=function(){var a=Array.prototype.slice.call(arguments,0),b={};d.augmentors.forEach(function(c){b=c.apply(b,a)||b});return b};d.augmentors=[b];c[a]=d}return c[a]}};s.requestAnimationFrame=
function(a){return function(b){return a(b)}}(e());s.AudioContext=n()})(function(){return"undefined"===typeof window?void 0:window}(),org.anclab.steller);
org.anclab.steller.Util.augment("Models",function(q){var s=org.anclab.steller,u=org.anclab.steller.Util,j=s.SoundModel,t=s.Param,l=q.audioContext,v=this;v.chime=function(){var m=l.createGainNode(),r=j({},[],[m]);r.halfLife=t({min:0.0010,max:10,value:0.5,mapping:"log"});r.attackTime=t({min:0.0010,max:1,value:0.01,mapping:"log"});r.level=t({min:0.125,max:4,audioParam:m.gain,mapping:"log"});r.play=function(k,h){void 0===h&&(h=1);return q.fire(function(d){var e=u.p2f(k.valueOf()),n=l.createOscillator();
n.type=n.SINE;n.frequency.value=e;var o=l.createGainNode();o.gain.value=0;o.gain.setValueAtTime(0,d.t1);o.gain.linearRampToValueAtTime(h.valueOf()/8,d.t1+r.attackTime.value);var e=440*r.halfLife.value/e,j=10*e;o.gain.setTargetAtTime(0,d.t1+r.attackTime.value,e);n.connect(o);o.connect(m);n.start(d.t1);n.stop(d.t1+j)})};return r};v.dc=function(){var m,r,k;k=l.createBuffer(1,1024,l.sampleRate);r=k.getChannelData(0);for(m=0;1024>m;++m)r[m]=1;return function(h){var d=l.createBufferSource();d.buffer=k;
d.loop=!0;d.start(0);var e=l.createGainNode();e.gain.value=h;d.connect(e);h=j({},[],[e]);h.level=t({min:-1,max:1,audioParam:e.gain});h.stop=function(e){d.stop(e)};return h}}();v.noise=function(){var m=l.createBuffer(1,5*l.sampleRate,l.sampleRate),r,k,h=m.getChannelData(0);r=0;for(k=h.length;r<k;++r)h[r]=2*Math.random()-1;return function(){var d=l.createBufferSource();d.buffer=m;d.loop=!0;d.gain.value=1;var e=l.createGainNode();e.gain.value=1;d.connect(e);d.start(0);var h=v.dc(0);h.connect(e);e=j({},
[],[e]);e.spread=t({min:0.01,max:10,audioParam:d.gain,mapping:"log"});e.mean=h.level;return e}}();v.probe=function(){var m=t({min:-1,max:1,value:0}),r=t({min:-1,max:1,value:1}),k=t({min:0,max:1,value:0}),h=l.createScriptProcessor(512,1,1),d=0,e=0,n=1-Math.exp(Math.log(0.5)/1024);h.onaudioprocess=function(h){for(var h=h.inputBuffer.getChannelData(0),l=h.length,j=0,q=0,j=0;j<l;++j)q=h[j],d+=n*(q-d),e+=n*(q*q-e);m.value=d;k.value=e;r.value=Math.sqrt(Math.max(0,e-d*d))};h.connect(l.destination);h=j({},
[h],[]);h.mean=m;h.sigma=r;h.energy=k;return h};v.mic=function(){function m(h,d,e){try{navigator.webkitGetUserMedia(h,d,e)}catch(l){e(l)}}function r(h,d){k||(k=l.createMediaStreamSource(d));k.connect(h.outputs[0]);h.error=null;h.ready.value=1}var k;return function(){var h=l.createGainNode(),d=j({},[],[h]);d.ready=t({min:-1,max:1,value:0});d.gain=t({min:0,max:1,audioParam:h.gain});k?r(d,null):m({audio:!0},function(e){return r(d,e)},function(e){d.error=e;d.gain.value=0;d.ready.value=-1});return d}}();
v.spectrum=function(m,r){function k(){if(n){var e=l.currentTime;h.getFloatFrequencyData(d.bins);for(var j=0,m=d.bins,r=m.length;j<r;++j)m[j]=Math.pow(10,m[j]/20);n=s.requestAnimationFrame(k);d.time.value=e}}var m=m||1024,h=l.createAnalyser();h.fftSize=2*m;h.frequencyBinCount=m;h.smoothingTimeConstant=2>arguments.length?0.1:r;var d=j({},[h],[]);d.bins=new Float32Array(m);d.freqs=new Float32Array(m);d.time=t({min:0,max:1E9,value:0});for(var e=0;e<m;++e)d.freqs[e]=e*l.sampleRate/h.fftSize;var n;d.start=
q.fire(function(){n||(n=s.requestAnimationFrame(k))});d.stop=q.fire(function(){n=void 0});return d};(function(){var m={};v.load_sample=function(j,k,h){var d="sound:"+j,e=m[d];if(e)return k&&k(e),e;if(k){var n=new XMLHttpRequest;n.open("GET",j,!0);n.responseType="arraybuffer";n.onerror=function(d){h&&h(d,j)};n.onload=function(){l.decodeAudioData(n.response,function(e){k(m[d]=e);0<=LOG_LEVEL&&console.log("models/sample.js[31]:\t","Sound ["+j+"] loaded!")},function(d){h&&h(d,j)})};n.send()}};v.load_sample.clearCache=
function(){m={}};v.sample=function(m,k){function h(h,j,k,m,r){var a=l.createBufferSource();a.buffer=n;a.connect(d);a.playbackRate.value=j;a.gain.setValueAtTime(0,h.t1);a.gain.setTargetAtTime(k,h.t1,e.attackTime.value/3);3<arguments.length?a.noteGrainOn(h.t1,m,4<arguments.length?r:a.duration):a.noteOn(h.t1);return a}var d=l.createGainNode();d.gain.value=0.25;var e=j({},[],[d]);e.level=t({min:0.0010,max:10,audioParam:d.gain,mapping:"log"});e.attackTime=t({min:0.0010,max:10,value:0.02,mapping:"log"});
e.releaseTime=t({min:0.0010,max:10,value:0.1,mapping:"log"});var n;e.load=function(d,h,j){if(n)d.perform(j,h,d.stop);else{var q=h.t1-l.currentTime;v.load_sample(m,function(k){n=k;e.duration=n.duration;d.perform(j,h.jumpTo(l.currentTime+q),d.stop)},k)}};e.trigger=function(d,e){e=e||0;return q.fire(function(j){var l=Math.pow(2,e.valueOf()/12);h(j,l,d.valueOf())})};e.play=q.track([e.load,q.dynamic(function(d){var j=h(d,d.rate.valueOf(),1);return q.delay(e.duration,function(d){j.playbackRate.value=d.rate.valueOf()})})]);
e.note=function(d,j,l,k){4>arguments.length&&(k=l);return q.dynamic(function(m){var a=h(m,d.valueOf(),1,j,l);a.gain.value=0;a.gain.setTargetAtTime(1,m.t1,e.attackTime.value/3);a.playbackRate.setTargetAtTime(d.valueOf(),m.t1,m.dt/3);return q.track([q.spawn(q.track([q.delay(k),q.fire(function(b){a.gain.setTargetAtTime(0,b.t1,e.releaseTime.value/3);a.stop(b.t1+12*e.releaseTime.value)})])),q.delay(l,function(b){a.playbackRate.exponentialRampToValueAtTime(d.valueOf(),b.t1)})])})};return e};v.sample.clearCache=
v.load_sample.clearCache})();v.jsnode=function(m){var r=m.numberOfInputs||0,k=r+(m.audioParams?m.audioParams.length:0),h=m.numberOfOutputs||1,d=0<k?l.createChannelMerger(k):void 0,e=0<h?l.createChannelSplitter(h):void 0,n=[],o,q,s;o=0;for(q=k;o<q;++o)s=l.createGainNode(),n.push(s),s.connect(d,0,o);var t=[];o=0;for(q=h;o<q;++o)s=l.createGainNode(),t.push(s),e&&e.connect(s,o);var u;u=m.audioParams?Object.keys(m.audioParams):[];var a={},b=[],c=[];a.inputs=b;a.outputs=c;o=0;for(q=u.length;o<q;++o)a[u[o]]=
null;a.playbackTime=l.currentTime;var f=!1,i=!1,g=0,R=Infinity,S,x=j({},n,t),M=0<u.length?v.dc(1):void 0;u.forEach(function(a,b){var c=n[r+b];x[a]=c.gain;c.gain.value=m.audioParams[a];M.connect(c)});var C=x.keep(l.createScriptProcessor(m.bufferLength||512,k,Math.min(1,h)));d&&d.connect(C);C.onaudioprocess=function(d){var e,f,j,k,n;e=0;if(!i){var o=d.outputBuffer.length;j=Math.floor(l.currentTime*l.sampleRate);k=Math.max(j,g);n=j+o;var p=k-j;j=n-j;if(n>k){e=0;for(f=r;e<f;++e)b[e]=d.inputBuffer.getChannelData(e).subarray(p,
j);e=0;for(f=h;e<f;++e)c[e]=d.outputBuffer.getChannelData(e).subarray(p,j);e=0;for(f=u.length;e<f;++e)a[u[e]]=d.inputBuffer.getChannelData(r+e).subarray(p,j);a.playbackTime=(d.playbackTime||l.currentTime)+p/l.sampleRate;a.samplesToStop=R-k;e=m.onaudioprocess.call(x,a);void 0===e&&(e=n-k)}k+e<n&&(1<=LOG_LEVEL&&console.log("models/jsnode.js[172]:\t","Finished",n,R),i=!0,setTimeout(S,Math.round(1E3*o/l.sampleRate)))}};var p=e||l.destination;S=function(){i=!0;C.disconnect();e&&e.disconnect();M&&(M.stop(0),
M.disconnect());d&&d.disconnect();x.drop(C);x.emit&&x.emit("ended")};var J;x.prepareAheadTime=0.1;x.start=function(a){if(!f&&!i)if(a){var b=Math.max(a,l.currentTime)-l.currentTime;J&&(cancelTimeout(J),J=null);var c=function(a){g=Math.floor(a*l.sampleRate);f=true;J=null;C.connect(p)};b<=x.prepareAheadTime?c(a):J=setTimeout(c,Math.round(1E3*(b-x.prepareAheadTime)),a)}else f=!0,C.connect(p)};x.stop=function(a){i||(R=Math.max(g,Math.ceil(a*l.sampleRate)))};0<r&&x.start(0);return x};return v});
