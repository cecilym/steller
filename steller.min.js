var LOG_LEVEL=1;org="undefined"===typeof org?{}:org;org.anclab=org.anclab||{};org.anclab.steller=org.anclab.steller||{};
(function(p,r){function u(a){var b={};a.on=function(a,d){var a=z(a),g=b[a]||(b[a]={}),e=d.__steller_eventable_id__||0;if(e in g)return this;e||Object.defineProperty(d,"__steller_eventable_id__",{value:e=I++,enumerable:!1,configurable:!1,writable:!1});g[e]=d;return this};a.off=function(a,d){var a=z(a),g=b[a];if(!g)return this;var e=d&&d.__steller_eventable_id__||0;e?delete g[e]:d||delete b[a];return this};a.emit=function(a){var a=z(a),d=b[a];if(!d)return this;for(var g in d)try{d[g].apply(this,arguments)}catch(e){1<=
LOG_LEVEL&&console.log("eventable.js[107]:\t","Exception in event watcher - ",e)}return this};return a}function j(a){var b=Object.create(j.prototype);b.spec=a=q(Object.create(a));b.getter=void 0;b.setter=void 0;b.valueOf=void 0;b.audioParam=void 0;b.watchers=[];b._value=void 0;a.audioParam?(b.audioParam=a.audioParam,b.getter=a.getter||j.getters.audioParam,b.setter=a.setter||j.setters.audioParam):a.options?(b.getter=a.getter||j.getters.value,b.setter=a.setter||j.setters.option):(b.getter=a.getter||
j.getters.value,b.setter=a.setter||j.setters.value);b.valueOf=b.getter;"value"in a&&b.setter(a.value);return b}function q(a){if(a.options){var b={};a.options.forEach(function(a,d){b["option:"+a]=d+1});a.limit=function(c){if("number"===typeof c){if(0<=c&&c<a.options.length)return a.options[c];throw Error("Invalid enumeration index");}if(b["option:"+c])return c;throw Error("Invalid enumeration value");}}return a}function n(a,b){var c,d,g=a.watchers;c=0;for(d=g.length;c<d;++c)g[c](b,a);return b}function t(){var a=
0,b=4,c=[null,null,null,null],d=-1,g=0;this.length=0;this.add=function(e){if(a>=b){var h=Array(2*b),f,o,i,l;f=d;o=0;i=a;for(l=b;o<i;++o,f=(f+1)%l)h[o]=c[f];c=h;g=a;d=0===a?-1:0;b*=2}c[g]=e;0>d&&(d=g);g=(g+1)%b;return this.length=a+=1};this.remove=function(){if(0>=a)throw Error("Empty queue");var g=c[d];c[d]=null;d=(d+1)%b;this.length=a-=1;return g};this.clear=function(){this.length=a=0;c.splice(0,c.length,null,null,null,null);b=4;d=-1;g=0};return this}function m(a,b){var c=e();if(h()&&!c)throw Error("PeriodicTimer needs requestAnimationFrame support. Use a sufficiently modern browser.");
var d=this,g=!1,f,b=void 0===b?15:Math.min(Math.max(h()?15:1,b),33);c&&12<=b?(d.start=function(){g||(g=!0,c(function(){g&&(c(arguments.callee),a())}))},d.stop=function(){g=!1}):(d.start=function(){g||(g=!0,f=setInterval(a,1))},d.stop=function(){g&&(g=!1,clearInterval(f),f=void 0)});d.__defineGetter__("running",function(){return g});d.__defineSetter__("running",function(a){a?d.start():d.stop();return g});d.computeAheadInterval_secs=Math.round(3.333*b)/1E3;return d}function k(a){(p.JSNodeTimer_jsnodes||
(p.JSNodeTimer_jsnodes=[])).push(a)}function i(a,b,c,d){this.dt=c;this.t1=a;this.t2=a+c;this.t1r=b;this.t2r=b+d.valueOf()*c;this.rate=d;this.data=null;return this}function f(a){return Math.round(1E3*a)/1E3}function h(){return"object"===typeof p&&"object"===typeof document&&p.document===document}function e(){try{return p.requestAnimationFrame||p.webkitRequestAnimationFrame||p.mozRequestAnimationFrame||p.msRequestAnimationFrame||function(a){setTimeout(a,1E3/60)}}catch(a){}}function s(){try{var a=p.AudioContext||
p.webkitAudioContext||p.mozAudioContext;return function(){var b=new a;b.createGain=b.createGainNode=b.createGain||b.createGainNode;b.createDelay=b.createDelayNode=b.createDelay||b.createDelayNode;b.createScriptProcessor=b.createJavaScriptNode=b.createScriptProcessor||b.createJavaScriptNode;var d=Object.getPrototypeOf(Object.getPrototypeOf(b.createGain().gain));d.setTargetAtTime=d.setTargetValueAtTime=d.setTargetAtTime||d.setTargetValueAtTime;d=Object.getPrototypeOf(b.createBufferSource());d.start=
d.noteOn=d.start||d.noteOn;d.stop=d.noteOff=d.stop||d.noteOff;d=Object.getPrototypeOf(b.createOscillator());d.start=d.noteOn=d.start||d.noteOn;d.stop=d.noteOff=d.stop||d.noteOff;return b}}catch(b){}}function o(){try{var a=p.performance,b=a&&(a.now||a.webkitNow||a.mozNow);return b?function(){return 0.0010*b.call(a)}:function(){return 0.0010*Date.now()}}catch(c){}}var z=function(){var a={};return function(b){if(a[b])throw Error("Invalid event name - "+b);return b}}(),I=1;u.observe=function(a,b,c){var c=
z(c||b),d=a[b];a[b]=function(){var a=d.apply(this,arguments),b=Array.prototype.slice.call(arguments);b.unshift(c);this.emit.apply(this,b);return a};return a};var K=function(){function a(g,d,c){g.inputs=d||[];g.outputs=c||[];g.numberOfInputs=g.inputs.length;g.numberOfOutputs=g.outputs.length;g.context=g.inputs[0]&&g.inputs[0].context||g.outputs[0]&&g.outputs[0].context;g.connect=function(a,b,d){var c,a=a||g.context.destination,b=g.outputs[b||0];c=a.inputs?a.inputs[d||0]:a;if("AudioParam"===c.constructor.name||
"AudioGain"===c.constructor.name)b.connect(c);else if(c.numberOfInputs===b.numberOfOutputs){a=0;for(d=c.numberOfInputs;a<d;++a)b.connect(c,a,a)}else b.connect(c);return g};g.disconnect=function(){0<arguments.length?Array.prototype.forEach.call(arguments,function(a){g.outputs[a].disconnect()}):g.outputs.forEach(function(a){a.disconnect()});return g};var e={},h=b(g);g.keep=function(a){var a=a||g,d=b(a);return e[d]=a};g.drop=function(d){d?(d=b(d),delete e[d]):delete a._preservedNodes[h]};a._preservedNodes[h]=
e;return g}function b(a){var b=a[d];b||(b=c++,Object.defineProperty(a,d,{value:b,writable:!1,enumerable:!1,configurable:!1}));return b}var c=1,d="#org.anclab.steller.GraphNode.globalid";a._preservedNodes={};a.chain=function(b){var d,c;d=0;for(c=b.length-1;d<c;++d)b[d].connect(b[d+1]);return a};return a}();j.getters={value:function(){return this._value},audioParam:function(){return this.audioParam.value}};j.setters={value:function(a){return this._value=a},audioParam:function(a){return this.audioParam.value=
a},option:function(a){return this._value=this.spec.limit(a)}};j.mappings={};j.mappings.linear={fromNorm:function(a,b){return a.spec.min+b*(a.spec.max-a.spec.min)},toNorm:function(a){return(a.value-a.spec.min)/(a.spec.max-a.spec.min)}};j.mappings.log={fromNorm:function(a,b){var c=a.spec,d=Math.log(c.min),c=Math.log(c.max);return Math.exp(d+b*(c-d))},toNorm:function(a){var b=a.spec,c=Math.log(b.min),b=Math.log(b.max);return(Math.log(a.value)-c)/(b-c)}};j.names=function(a){return Object.keys(a).filter(function(b){return a[b]instanceof
j})};j.expose=function(a,b,c){c||(c=j.names(a));c.forEach(function(d){b[d]=a[d]});return j};j.bind=function(a,b,c){a instanceof j?a.bind(b,c):"value"in a?c?c.update(function(){b.value=a.value}):b.value=a.value:c?c.update(function(){b.value=a}):b.value=a;return j};j.prototype.__defineGetter__("value",function(){return this.getter()});j.prototype.__defineSetter__("value",function(a){return a!==this.getter()?n(this,this.setter(a)):a});j.prototype.watch=function(a){var b,c,d=this.watchers;b=0;for(c=d.length;b<
c;++b)if(d[b]===a)return this;d.push(a);return this};j.prototype.unwatch=function(a){var b=this.watchers;if(1>arguments.length||!a)return b.splice(0,b.length),this;for(var c=b.length-1;0<=c;--c)if(b[c]===a){b.splice(c,1);break}return this};j.prototype.changed=function(){n(this,this.getter());return this};j.prototype.alias=function(a,b){var c=this,d=Object.create(c);d.spec=Object.create(c.spec);d.spec.name=a;b&&(d.spec.label=b);d.getter=function(){return c.getter()};d.setter=function(a){return c.setter(a)};
d.alias=function(a,b){return c.alias(a,b)};return d};j.prototype.bind=function(a,b){var c=this;if(a.addEventListener){var d=c.spec,g=d.mapping?j.mappings[d.mapping]:j.mappings.linear,e,h,f;if("checkbox"===a.type)e=function(){c.value=a.checked?1:0},h=b?function(){b.update(e)}:e,f=function(b){a.checked=b?!0:!1};else if("range"===a.type)e=function(){c.value=g.fromNorm(c,parseFloat(a.value))},h=b?function(){b.update(e)}:e,f=function(){a.value=g.toNorm(c)};else throw Error("org.anclab.steller.Param.bind: Unsupported control type - "+
a.type);f.elem=a;f.unbind=function(){a.removeEventListener(h);c.unwatch(f)};a.addEventListener("change",h);c.watch(f);f(c.value)}else if("string"===typeof a){var d=document.querySelectorAll(a),o,i;o=0;for(i=d.length;o<i;++o)this.bind(d[o])}else{var l=function(b){a.value=b};l.elem=a;l.unbind=function(){c.unwatch(l)};c.watch(l);a.value=c.value}return this};j.prototype.unbind=function(a){if("string"===typeof a){var a=document.querySelectorAll(a),b,c;b=0;for(c=a.length;b<c;++b)this.unbind(a[b])}else{var d=
this.watchers;b=0;for(c=d.length;b<c;++b)if(d[b].elem===a){d[b].unbind();break}}return this};i.prototype.toString=function(){return JSON.stringify([this.t1r,this.t2r-this.t1r,this.t1,this.t2-this.t1].map(f))};i.prototype.copy=function(){var a=new i(this.t1,this.t1r,this.dt,this.rate);this.data&&(a.data=Object.create(this.data));return a};i.prototype.advance=function(a){this.t1+=a;this.t2+=a;return this};i.prototype.advanceTo=function(a){return this.advance(a-this.t1)};i.prototype.tick=function(){this.t1=
this.t2;this.t2+=this.dt;this.t1r=this.t2r;this.t2r+=this.dt*this.rate.valueOf();return this};i.prototype.jumpTo=function(a){var a=a-this.t1,b=a*this.rate.valueOf();this.t1+=a;this.t2+=a;this.t1r+=b;this.t2r+=b;return this};i.prototype.syncWith=function(a){this.t1=a.t1;this.t2=this.t1+this.dt;this.t1r=a.t1r;this.t2r=this.t1r+this.rate.valueOf()*this.dt;return this};i.prototype.nudgeToRel=function(a){a=Math.max(this.t1r,a);this.t2r>this.t1r&&(this.t1+=(a-this.t1r)*(this.t2-this.t1)/(this.t2r-this.t1r));
this.t1r=a;return this};i.prototype.rel2abs=function(a){return this.t1+(a-this.t1r)/this.rate.valueOf()};i.prototype.abs2rel=function(a){return this.t1r+(a-this.t1)*this.rate.valueOf()};var w=function(a){function b(a){var b=Math.pow(10,4-Math.min(3,(""+(a-a%1)).length));return Math.round(a*b)/b}function c(a){return function(b){a.insertAdjacentElement("beforeend",b)}}a.basicUI=function(a,g,e){if(g.ui)return g.ui;var h=a.createElement("div");e&&h.insertAdjacentHTML("beforeend","<p><b>"+e+"</b></p>");
j.names(g).map(function(a){var b=Object.create(g[a].spec);b.name=b.name||a;b.param=g[a];return b}).forEach(function(g){var e=g.name,f=g.param;if("min"in g&&"max"in g){var o=a.createElement("div"),i=a.createElement("span"),n=a.createElement("span");i.innerText=(g.label||e)+": ";i.style.width="100px";i.style.display="inline-block";i.style.textAlign="left";var m=a.createElement("input");m.type="range";m.min=0;m.max=1;m.step=0.0010;var s="string"===typeof g.mapping?j.mappings[g.mapping]:g.mapping||j.mappings.linear,
k=g.units?" "+g.units:"";m.value=s.toNorm(f);n.innerText=" ("+b(f.value)+k+")";m.changeModelParameter=function(){f.value=s.fromNorm(f,parseFloat(this.value))};m.changeSliderValue=function(a){m.value=s.toNorm(f);n.innerText=" ("+b(a)+k+")"};m.addEventListener("change",m.changeModelParameter);f.watch(m.changeSliderValue);[i,m,n].forEach(c(o));h.insertAdjacentElement("beforeend",o)}});return g.ui=h};return a}({});r.Eventable=u;r.AsyncEventable=function(a){var a=u(a),b=a.on;a.on=function(c,d){if(!d)return this;
var g=d.__steller_async_eventable__;g||Object.defineProperty(d,"__steller_async_eventable__",{value:g=function(){var b=arguments;setTimeout(function(){d.apply(a,b)},0)},enumerable:!1,configurable:!1,writable:!1});b(c,g)};return a};r.GraphNode=K;r.SoundModel=function(a,b,c){a=u(K(a,b,c));u.observe(a,"connect");u.observe(a,"disconnect");return a};r.Param=j;r.Scheduler=function(a,b){function c(a,b){a&&(q.add(a),q.add(b))}function d(a){a(l,v.copy(),g)}function g(){}function f(a,b,d){d&&d(a,b,g)}function n(a,
b){return function(d,c,e){function h(d,c){var y=o+a.valueOf();0<B&&c.t1<v.t1&&c.advance(B);c.t1>E?f&&A.add(f):c.t2r<y?(b&&b(c,c.t1r,c.t2r,o,y),c.tick(),f&&A.add(f)):(b&&y>=c.t1r&&b(c,c.t1r,y,o,y),c.t2r>c.t1r?e(d,c.nudgeToRel(y),g):e(d,c,g))}function f(a){h(a,c,g)}var o=c.t1r;h(d,c)}}function k(a){return function(b,c,d){a(c)(b,c,d)}}function z(a){function b(a,d,e){var f,h,D;if(0<c.length){D=c;c=[];f=0;for(h=D.length;f<h;++f)D[f](a,d.copy(),g)}e(a,d,g)}if(0<arguments.length)return function(a,b,c){for(;a<
b;++a)c.push(z());return c}(0,a,[]);var c=[];b.play=function(a){c.push(a);return this};b.cancel=function(){c.splice(0,c.length);return this};return b}function I(a){function b(a,d,f){e?f(a,d,g):c.push({sched:a,next:f,clock:d})}if(0<arguments.length)return function(a,b,c){for(;a<b;++a)c.push(I());return c}(0,a,[]);var c=[],d=[],e=!0;b.__defineGetter__("isOpen",function(){return e});b.__defineSetter__("isOpen",function(a){a?b.open():b.close();return a});b.open=function(a,b,d){e=!0;var f=c,h,D,o,i=C();
c=[];h=0;for(D=f.length;h<D;++h)o=f[h],o.next(o.sched,b?b.copy():o.clock.advanceTo(i),g);d&&d(a,b,g)};b.close=function(a,b,c){e=!1;c&&c(a,b,g)};b.toggle=function(a,c,d){return e?b.close(a,c,d):b.open(a,c,d)};b.cancel=function(a,b,d){c.splice(0,c.length);d&&d(a,b,g)};b.push=function(a,b,f){d.push({isOpen:e,cache:c});c=[];f&&f(a,b,g)};b.pop=function(a,b,e){var f=d.pop();c.push.apply(c,f.cache);this.isOpen=f.isOpen;e&&e(a,b,g)};return b}var l=this===p?{}:this,K=e();s();if(h()&&!K)throw Error("Scheduler needs requestAnimationFrame support. Use a sufficiently modern browser version.");
var r=0.0010,C=function(){if(a){if(a.createGain||a.createGainNode)return r=1/a.sampleRate,a.createGain=a.createGainNode=a.createGain||a.createGainNode,a.createGainNode(),function(){return a.currentTime};throw Error("Scheduler: Argument is not an audio context");}return o()||function(){return 0.0010*Date.now()}}(),L,w=!1;l.__defineGetter__("running",function(){return w});l.__defineSetter__("running",function(a){a?w||(w=!0,v.advanceTo(C()),L.start()):(w=!1,L.stop())});l.frame_rate=j({min:15,max:75,
value:60});var A=new t("tick"),q=new t("frames"),H=new t("update");L=new m(function(){var a,b,c,d,g;a=!0;b=C();V(b);for(E=b+F;b-v.t1>S;)B=b-v.t1,v.advance(B);for(;a||v.t1<E;){if(0<H.length){c=H.length;for(a=0;a<c;++a)H.remove()()}c=A.length;for(a=0;a<c;++a)A.remove()(l,v,f);v.t1<E&&v.tick();B=0;a=!1}if(0<q.length){c=q.length;for(a=0;a<c;a+=2)d=q.remove(),g=q.remove(),d(b,g)}if(l.ontick)l.ontick(b)},0,a);var u=1/60,M=u,F=L.computeAheadInterval_secs||0.05,S=5*F,v=new i(C(),0,F,1),E=v.t1,B=0,V=function(){var a=
1/60,b=v.t1,c=15;return function(d){var g=d-b;0.01<g&&0.07>g&&(M=u=a+=0.05*(g-a),F=3.33*u,S=5*F,0>=c--&&(l.frame_rate.value=Math.round(1/u),c=15));b=d}}(),T=function(){return a?function U(b){0===a.currentTime?setTimeout(U,100,b):(v=new i(C(),0,F,1),E=v.t1,l.play=T=d,d(b))}:d}(),N;b&&b.diagnostics?(4<=LOG_LEVEL&&console.log("scheduler.js[631]:\t","fire: diagnostics on"),N=function(a){return function(b,c,d){C();a(c);d(b,c,g)}}):N=function(a){return function(b,c,d){a(c);d(b,c,g)}};l.audioContext=a;l.update=
function(a){a&&H.add(a)};l.perform=function(a,b,c){a(l,b,c)};l.cancel=function(){H.clear();A.clear();q.clear()};l.play=T;l.stop=g;l.cont=f;l.delay=n;l.loop=function(a){return function y(b,c){a(b,c,y)}};l.loop_while=function(a,b){return function(c,d,e){function f(){a.valueOf()?b(c,d,f):e(c,d,g)}f()}};l.repeat=function(a,b){return function(c,d,e){function f(){if(h<a){h++;b(c,d,f)}else e(c,d,g)}var h=0;f()}};l.fork=function(a){a=a&&a.constructor===Function?Array.prototype.slice.call(arguments,0):a.slice(0);
return function(b,c,d){function e(b,h){f++;f===a.length&&d(b,c.syncWith(h),g)}var f=0;a.forEach(function(a){a(b,c.copy(),e)})}};l.spawn=function(a){a=a&&a.constructor===Function?Array.prototype.slice.call(arguments,0):a.slice(0);return function(b,c,d){a.forEach(function(a){a(b,c.copy(),g)});d(b,c,g)}};l.dynamic=k;l.track=function(a){function b(c,d,e,f,h){function o(b,c){if(i<l)a[i++](b,c,o);else e(b,c,g)}var i=0,l=a.length;if(arguments.length>3){i=f;l=h}o(c,d,e)}a&&a.constructor===Function&&(a=Array.prototype.slice.call(arguments,
0));b.minIndex=0;b.maxIndex=a.length;b.models=a;return b};l.slice=function(a,b,c){c=arguments.length>2?c:a.maxIndex;b=arguments.length>1?Math.max(a.minIndex,Math.min(b,c)):a.minIndex;return function(d,g,e){a(d,g,e,b,c)}};l.fire=N;l.display=function(a){return function(b,d,e){function f(b){b+M>h?a(d,h,b):c(f)}var h=d.t1;c(f);e(b,d,g)}};l.frame=function(a){return function(b,d,e){function f(o){if(o+M>h){d.jumpTo(o);a(d);e(b,d,g)}else c(f)}var h=d.t1;c(f)}};l.frames=function(a,b){return function(d,e,f){function h(b,
c){var d,e=i+a.valueOf();if(B>0&&c.t1<v.t1){c.advance(B);if(k){m=m+void 0;k.intervals.length>4&&k.intervals.splice(0,k.intervals.length-4);if(k.intervals.length>0){k.intervals[0]=k.intervals[0]+void 0;k.intervals[3]=c.rate.valueOf()}}}if(c.t1>E)o&&A.add(o);else{if(k&&c.t1r<=e){k.endTime=e;var n=c.rate.valueOf();for(d=Math.max(0.0010,u*n);l<c.t2r;){k.intervals.push(m);k.intervals.push(l);k.intervals.push(l+d);k.intervals.push(n);l=l+d}}if(c.t2r<e){c.tick();o&&A.add(o)}else{k.end=true;c.t2r>c.t1r?f(b,
c.nudgeToRel(e),g):f(b,c,g)}}}function o(a){h(a,e,g)}var i=e.t1r,l=i,m=e.t1,n,k;if(b){n=function(a,d){if(d.intervals.length>0){var e=d.intervals[0],g=d.intervals[1],f=d.intervals[2],h=d.intervals[3];if(g<=d.endTime){if(e<M+a){b(d.clock,g,f,d.startTime,d.endTime,h);d.intervals.splice(0,4)}c(n,d);return}}d.end||c(n,d)};k={clock:e,intervals:[],startTime:e.t1r,endTime:e.t1r+a.valueOf(),end:false};c(n,k)}h(d,e)}};l.log=function(a){return N(function(){console.log(a)})};l.anim=function(a,b){var c,d,e,g;
switch(arguments.length){case 3:g=arguments[2];break;case 4:c=arguments[2];d=arguments[3];g=function(a){return(1-a)*c.valueOf()+a*d.valueOf()};break;case 5:c=arguments[2];d=arguments[3];e=arguments[4];g=function(a){a=e(a);return(1-a)*c.valueOf()+a*d.valueOf()};break;default:throw Error("Invalid arguments to anim()");}return a.constructor.name==="AudioGain"||a.constructor.name==="AudioParam"?n(b,function(b,c,d,e,f){var f=f-e,h;if(c<=e){h=f>r?(c-e)/f:0;a.setValueAtTime(g(h),b.rel2abs(c))}a.linearRampToValueAtTime(g(f>
r?(d-e)/f:1),b.rel2abs(d))}):n(b,function(b,c,d,e,f){b=f-e-(d-c);a.value=b>r?g((c-e)/b):g(1)})};l.rate=function(a){return function(b,c,d){c.rate=a;d(b,c,g)}};l.choice=function(a){return k(function(){return a[Math.floor(Math.random()*a.length)]})};l.sync=z;l.gate=I;l.stats=function(){return{frame_jitter_ms:0}};l.running=b&&"running"in b&&b.running||!0;org.anclab.steller.Models&&(l.models=org.anclab.steller.Models(l));return l};r.Clock=i;r.PeriodicTimer=m;r.JSNodeTimer=function(a,b,c){if(c){var d=c.createJavaScriptNode(1024);
d.onaudioprocess=function(){a()};var e=this,f=!1;k(d);e.start=function(){f||(f=!0,d.connect(c.destination))};e.stop=function(){f&&(d.disconnect(),f=!1)};e.__defineGetter__("running",function(){return f});e.__defineSetter__("running",function(a){a?e.start():e.stop();return f});e.computeAheadInterval_secs=Math.round(2560)/c.sampleRate;return e}return m.call(this,a,b)};r.UI=w;r.Util={p2f:function(a){return 440*Math.pow(2,(a.valueOf()-69)/12)},f2p:function(a){a=69+12*Math.log(a.valueOf()/440)/Math.LN2;
return Math.round(100*a)/100},augment:function(a,b){var c=org.anclab.steller;if(a in c)c[a].augmentors.push(b);else{var d=function(){var a=Array.prototype.slice.call(arguments,0),b={};d.augmentors.forEach(function(c){b=c.apply(b,a)||b});return b};d.augmentors=[b];c[a]=d}return c[a]}};r.requestAnimationFrame=function(a){return function(b){return a(b)}}(e());r.AudioContext=s()})(function(){return"undefined"===typeof window?void 0:window}(),org.anclab.steller);
org.anclab.steller.Util.augment("Models",function(p){var r=org.anclab.steller,u=org.anclab.steller.Util,j=r.SoundModel,q=r.Param,n=p.audioContext,t=this;t.chime=function(){var m=n.createGainNode(),k=j({},[],[m]);k.halfLife=q({min:0.0010,max:10,value:0.5,mapping:"log"});k.attackTime=q({min:0,max:1,value:0.01});k.level=q({min:0.125,max:4,audioParam:m.gain,mapping:"log"});k.play=function(i,f){void 0===f&&(f=1);return p.fire(function(h){var e=u.p2f(i.valueOf()),s=n.createOscillator();s.type=s.SINE;s.frequency.value=
e;var o=n.createGainNode();o.gain.value=0;o.gain.setValueAtTime(0,h.t1);o.gain.linearRampToValueAtTime(f.valueOf()/8,h.t1+k.attackTime.value);var e=440*k.halfLife.value/e,j=10*e;o.gain.setTargetValueAtTime(0,h.t1+k.attackTime.value,e);s.connect(o);o.connect(m);s.noteOn(h.t1);s.stop(h.t1+j)})};return k};t.dc=function(){var m,k,i;i=n.createBuffer(1,1024,n.sampleRate);k=i.getChannelData(0);for(m=0;1024>m;++m)k[m]=1;return function(f){var h=n.createBufferSource();h.buffer=i;h.loop=!0;h.noteOn(0);var e=
n.createGainNode();e.gain.value=f;h.connect(e);f=j({},[],[e]);f.level=q({min:-1,max:1,audioParam:e.gain});f.stop=function(e){h.stop(e)};return f}}();t.noise=function(){var m=n.createBuffer(1,5*n.sampleRate,n.sampleRate),k,i,f=m.getChannelData(0);k=0;for(i=f.length;k<i;++k)f[k]=2*Math.random()-1;return function(){var f=n.createBufferSource();f.buffer=m;f.loop=!0;f.gain.value=1;var e=n.createGainNode();e.gain.value=1;f.connect(e);f.noteOn(0);var i=t.dc(0);i.connect(e);e=j({},[],[e]);e.spread=q({min:0.01,
max:10,audioParam:f.gain});e.mean=i.level;return e}}();t.probe=function(){var m=q({min:-1,max:1,value:0}),k=q({min:-1,max:1,value:1}),i=q({min:0,max:1,value:0}),f=n.createJavaScriptNode(512,1,1),h=0,e=0,s=1-Math.exp(Math.log(0.5)/1024);f.onaudioprocess=function(f){for(var f=f.inputBuffer.getChannelData(0),n=f.length,j=0,p=0,j=0;j<n;++j)p=f[j],h+=s*(p-h),e+=s*(p*p-e);m.value=h;i.value=e;k.value=Math.sqrt(Math.max(0,e-h*h))};f.connect(n.destination);f=j({},[f],[]);f.mean=m;f.sigma=k;f.energy=i;return f};
t.mic=function(){function m(f,h,e){try{navigator.webkitGetUserMedia(f,h,e)}catch(i){e(i)}}function k(f,h){i||(i=n.createMediaStreamSource(h));i.connect(f.outputs[0]);f.error=null;f.ready.value=1}var i;return function(){var f=n.createGainNode(),h=j({},[],[f]);h.ready=q({min:-1,max:1,value:0});h.gain=q({min:0,max:1,audioParam:f.gain});i?k(h,null):m({audio:!0},function(e){return k(h,e)},function(e){h.error=e;h.gain.value=0;h.ready.value=-1});return h}}();t.spectrum=function(m,k){function i(){if(s){var e=
n.currentTime;f.getFloatFrequencyData(h.bins);for(var k=0,m=h.bins,j=m.length;k<j;++k)m[k]=Math.pow(10,m[k]/20);s=r.requestAnimationFrame(i);h.time.value=e}}var m=m||1024,f=n.createAnalyser();f.fftSize=2*m;f.frequencyBinCount=m;f.smoothingTimeConstant=2>arguments.length?0.1:k;var h=j({},[f],[]);h.bins=new Float32Array(m);h.freqs=new Float32Array(m);h.time=q({min:0,max:1E9,value:0});for(var e=0;e<m;++e)h.freqs[e]=e*n.sampleRate/f.fftSize;var s;h.start=p.fire(function(){s||(s=r.requestAnimationFrame(i))});
h.stop=p.fire(function(){s=void 0});return h};(function(){var m={};t.load_sample=function(k,i,f){var h="sound:"+k,e=m[h];if(e)return i&&i(e),e;if(i){var j=new XMLHttpRequest;j.open("GET",k,!0);j.responseType="arraybuffer";j.onerror=function(e){f&&f(e,k)};j.onload=function(){n.decodeAudioData(j.response,function(e){i(m[h]=e);0<=LOG_LEVEL&&console.log("models/sample.js[31]:\t","Sound ["+k+"] loaded!")},function(e){f&&f(e,k)})};j.send()}};t.load_sample.clearCache=function(){m={}};t.sample=function(k,
i){function f(f,i,k,j,p){var a=n.createBufferSource();a.buffer=m;a.connect(h);a.playbackRate.value=i;a.gain.setValueAtTime(0,f.t1);a.gain.setTargetValueAtTime(k,f.t1,e.attackTime.value/3);3<arguments.length?a.noteGrainOn(f.t1,j,4<arguments.length?p:a.duration):a.noteOn(f.t1);return a}var h=n.createGainNode();h.gain.value=0.25;var e=j({},[],[h]);e.level=q({min:0.0010,max:10,audioParam:h.gain,mapping:"log"});e.attackTime=q({min:0.0010,max:10,value:0.02,mapping:"log"});e.releaseTime=q({min:0.0010,max:10,
value:0.1,mapping:"log"});var m;e.load=function(f,h,j){if(m)f.perform(j,h,f.stop);else{var p=h.t1-n.currentTime;t.load_sample(k,function(i){m=i;e.duration=m.duration;f.perform(j,h.jumpTo(n.currentTime+p),f.stop)},i)}};e.trigger=function(e,h){h=h||0;return p.fire(function(i){var k=Math.pow(2,h.valueOf()/12);f(i,k,e.valueOf())})};e.play=p.track([e.load,p.dynamic(function(h){var i=f(h,h.rate.valueOf(),1);return p.delay(e.duration,function(e){i.playbackRate.value=e.rate.valueOf()})})]);e.note=function(h,
i,k,m){4>arguments.length&&(m=k);return p.dynamic(function(j){var a=f(j,h.valueOf(),1,i,k);a.gain.value=0;a.gain.setTargetValueAtTime(1,j.t1,e.attackTime.value/3);a.playbackRate.setTargetValueAtTime(h.valueOf(),j.t1,j.dt/3);return p.track([p.spawn(p.track([p.delay(m),p.fire(function(b){a.gain.setTargetValueAtTime(0,b.t1,e.releaseTime.value/3);a.stop(b.t1+12*e.releaseTime.value)})])),p.delay(k,function(b){a.playbackRate.exponentialRampToValueAtTime(h.valueOf(),b.t1)})])})};return e};t.sample.clearCache=
t.load_sample.clearCache})();t.jsnode=function(m){var k=m.numberOfInputs||0,i=k+(m.audioParams?m.audioParams.length:0),f=m.numberOfOutputs||1,h=0<i?n.createChannelMerger(i):void 0,e=0<f?n.createChannelSplitter(f):void 0,p=[],o,q,r;o=0;for(q=i;o<q;++o)r=n.createGainNode(),p.push(r),r.connect(h,0,o);var u=[];o=0;for(q=f;o<q;++o)r=n.createGainNode(),u.push(r),e&&e.connect(r,o);var w;w=m.audioParams?Object.keys(m.audioParams):[];var a={},b=[],c=[];a.inputs=b;a.outputs=c;o=0;for(q=w.length;o<q;++o)a[w[o]]=
null;a.playbackTime=n.currentTime;var d=!1,g=!1,O=0,P=Infinity,Q,x=j({},p,u),J=0<w.length?t.dc(1):void 0;w.forEach(function(a,b){var c=p[k+b];x[a]=c.gain;c.gain.value=m.audioParams[a];J.connect(c)});var l=x.keep(n.createScriptProcessor(m.bufferLength||512,i,Math.min(1,f)));h&&h.connect(l);l.onaudioprocess=function(d){var e,h,i,j,l;e=0;if(!g){var o=d.outputBuffer.length;i=Math.floor(n.currentTime*n.sampleRate);j=Math.max(i,O);l=i+o;var p=j-i;i=l-i;if(l>j){e=0;for(h=k;e<h;++e)b[e]=d.inputBuffer.getChannelData(e).subarray(p,
i);e=0;for(h=f;e<h;++e)c[e]=d.outputBuffer.getChannelData(e).subarray(p,i);e=0;for(h=w.length;e<h;++e)a[w[e]]=d.inputBuffer.getChannelData(k+e).subarray(p,i);a.playbackTime=(d.playbackTime||n.currentTime)+p/n.sampleRate;a.samplesToStop=P-j;e=m.onaudioprocess.call(x,a);void 0===e&&(e=l-j)}j+e<l&&(1<=LOG_LEVEL&&console.log("models/jsnode.js[168]:\t","Finished",l,P),g=!0,setTimeout(Q,Math.round(1E3*o/n.sampleRate)))}};var R=e||n.destination;Q=function(){g=!0;l.disconnect();e&&e.disconnect();J&&(J.stop(0),
J.disconnect());h&&h.disconnect();x.drop(l);x.emit&&x.emit("finished")};var G;x.prepareAheadTime=0.1;x.start=function(a){if(!d&&!g)if(a){var b=Math.max(a,n.currentTime)-n.currentTime;G&&(cancelTimeout(G),G=null);var c=function(a){O=Math.floor(a*n.sampleRate);d=true;G=null;l.connect(R)};b<=x.prepareAheadTime?c(a):G=setTimeout(c,Math.round(1E3*(b-x.prepareAheadTime)),a)}else d=!0,l.connect(R)};x.stop=function(a){g||(P=Math.max(O,Math.ceil(a*n.sampleRate)))};0<k&&x.start(0);return x};return t});
