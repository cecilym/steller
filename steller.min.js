var LOG_LEVEL=1;org="undefined"===typeof org?{}:org;org.anclab=org.anclab||{};org.anclab.steller=org.anclab.steller||{};
(function(p,r){function v(a){var b={};a.on=function(a,e){var a=A(a),h=b[a]||(b[a]={}),u=e.__steller_eventable_id__||0;if(u in h)return this;u||Object.defineProperty(e,"__steller_eventable_id__",{value:u=J++,enumerable:!1,configurable:!1,writable:!1});h[u]=e;return this};a.off=function(a,e){var a=A(a),h=b[a];if(!h)return this;var u=e&&e.__steller_eventable_id__||0;u?delete h[u]:e||delete b[a];return this};a.emit=function(a){var a=A(a),e=b[a];if(!e)return this;for(var h in e)try{e[h].apply(this,arguments)}catch(u){1<=
LOG_LEVEL&&console.log("eventable.js[107]:\t","Exception in event watcher - ",u)}return this};return a}function j(a){var b=Object.create(j.prototype);b.spec=a=q(Object.create(a));b.getter=void 0;b.setter=void 0;b.valueOf=void 0;b.audioParam=void 0;b.watchers=[];b._value=void 0;a.audioParam?(b.audioParam=a.audioParam,b.getter=a.getter||j.getters.audioParam,b.setter=a.setter||j.setters.audioParam):a.options?(b.getter=a.getter||j.getters.value,b.setter=a.setter||j.setters.option):(b.getter=a.getter||
j.getters.value,b.setter=a.setter||j.setters.value);b.valueOf=b.getter;"value"in a&&b.setter(a.value);return b}function q(a){if(a.options){var b={};a.options.forEach(function(a,e){b["option:"+a]=e+1});a.limit=function(c){if("number"===typeof c){if(0<=c&&c<a.options.length)return a.options[c];throw Error("Invalid enumeration index");}if(b["option:"+c])return c;throw Error("Invalid enumeration value");}}return a}function n(a,b){var c,e,h=a.watchers;c=0;for(e=h.length;c<e;++c)h[c](b,a);return b}function t(){var a=
0,b=4,c=[null,null,null,null],e=-1,h=0;this.length=0;this.add=function(u){if(a>=b){var d=Array(2*b),f,g,o,l;f=e;g=0;o=a;for(l=b;g<o;++g,f=(f+1)%l)d[g]=c[f];c=d;h=a;e=0===a?-1:0;b*=2}c[h]=u;0>e&&(e=h);h=(h+1)%b;return this.length=a+=1};this.remove=function(){if(0>=a)throw Error("Empty queue");var h=c[e];c[e]=null;e=(e+1)%b;this.length=a-=1;return h};this.clear=function(){this.length=a=0;c.splice(0,c.length,null,null,null,null);b=4;e=-1;h=0};return this}function i(a,b){var c=d();if(f()&&!c)throw Error("PeriodicTimer needs requestAnimationFrame support. Use a sufficiently modern browser.");
var e=this,h=!1,u,b=void 0===b?15:Math.min(Math.max(f()?15:1,b),33);c&&12<=b?(e.start=function(){h||(h=!0,c(function(){h&&(c(arguments.callee),a())}))},e.stop=function(){h=!1}):(e.start=function(){h||(h=!0,u=setInterval(a,1))},e.stop=function(){h&&(h=!1,clearInterval(u),u=void 0)});e.__defineGetter__("running",function(){return h});e.__defineSetter__("running",function(a){a?e.start():e.stop();return h});e.computeAheadInterval_secs=Math.round(3.333*b)/1E3;return e}function k(a){(p.JSNodeTimer_jsnodes||
(p.JSNodeTimer_jsnodes=[])).push(a)}function m(a,b,c,e){this.dt=c;this.t1=a;this.t2=a+c;this.t1r=b;this.t2r=b+e.valueOf()*c;this.rate=e;this.data=null;return this}function g(a){return Math.round(1E3*a)/1E3}function f(){return"object"===typeof p&&"object"===typeof document&&p.document===document}function d(){try{return p.requestAnimationFrame||p.webkitRequestAnimationFrame||p.mozRequestAnimationFrame||p.msRequestAnimationFrame||function(a){setTimeout(a,1E3/60)}}catch(a){}}function s(){var a=function(){return this.AudioContext||
this.webkitAudioContext}();return!a?void 0:function(){var b,c,e;if(0===arguments.length)b=new a;else if(3===arguments.length)b=new a(arguments[0],arguments[1],arguments[2]);else throw Error("Invalid instantiation of AudioContext");b.createGain=b.createGainNode=b.createGain||b.createGainNode;b.createDelay=b.createDelayNode=b.createDelay||b.createDelayNode;b.createScriptProcessor=b.createJavaScriptNode=b.createScriptProcessor||b.createJavaScriptNode;c=Object.getPrototypeOf(b.createGain().gain);e=Object.getPrototypeOf(c);
e.setValueAtTime&&(c=e);c.setTargetAtTime=c.setTargetValueAtTime=c.setTargetAtTime||c.setTargetValueAtTime;c=Object.getPrototypeOf(b.createBufferSource());if(c.start){if(c.noteOn||(c.noteOn=function(a){return this.start(a)}),c.noteOff=c.stop,!c.noteGrainOn)c.noteGrainOn=function(a,b,c){return this.start(a,b,c)}}else c.start=function(a,b,c){switch(arguments.length){case 1:return this.noteOn(a);case 3:return this.noteGrainOn(a,b,c);default:throw Error("Invalid arguments to BufferSource.start");}},c.stop=
c.noteOff;c=Object.getPrototypeOf(b.createOscillator());c.start=c.noteOn=c.start||c.noteOn;c.stop=c.noteOff=c.stop||c.noteOff;return b}}function o(){try{var a=p.performance,b=a&&(a.now||a.webkitNow||a.mozNow);if(b)return function(){return 0.0010*b.call(a)}}catch(c){}return function(){return 0.0010*Date.now()}}var A=function(){var a={};return function(b){if(a[b])throw Error("Invalid event name - "+b);return b}}(),J=1;v.observe=function(a,b,c){var c=A(c||b),e=a[b];a[b]=function(){var a=e.apply(this,
arguments),b=Array.prototype.slice.call(arguments);b.unshift(c);this.emit.apply(this,b);return a};return a};var L=function(){function a(c,e,f){c.inputs=e||[];c.outputs=f||[];c.numberOfInputs=c.inputs.length;c.numberOfOutputs=c.outputs.length;c.context=c.inputs[0]&&c.inputs[0].context||c.outputs[0]&&c.outputs[0].context;c.connect=function(a,b,e){var d,a=a||c.context.destination,b=c.outputs[b||0];d=a.inputs?a.inputs[e||0]:a;if("AudioParam"===d.constructor.name||"AudioGain"===d.constructor.name)b.connect(d);
else if(d.numberOfInputs===b.numberOfOutputs){a=0;for(e=d.numberOfInputs;a<e;++a)b.connect(d,a,a)}else b.connect(d);return c};c.disconnect=function(){0<arguments.length?Array.prototype.forEach.call(arguments,function(a){c.outputs[a].disconnect()}):c.outputs.forEach(function(a){a.disconnect()});return c};var d={},g=b(c);c.keep=function(a){var a=a||c,e=b(a);return d[e]=a};c.drop=function(c){c?(c=b(c),delete d[c]):delete a._preservedNodes[g]};a._preservedNodes[g]=d;return c}function b(a){var b=a[e];
b||(b=c++,Object.defineProperty(a,e,{value:b,writable:!1,enumerable:!1,configurable:!1}));return b}var c=1,e="#org.anclab.steller.GraphNode.globalid";a._preservedNodes={};a.chain=function(b){var c,e;c=0;for(e=b.length-1;c<e;++c)b[c].connect(b[c+1]);return a};return a}();j.getters={value:function(){return this._value},audioParam:function(){return this.audioParam.value}};j.setters={value:function(a){return this._value=a},audioParam:function(a){return this.audioParam.value=a},option:function(a){return this._value=
this.spec.limit(a)}};j.mappings={};j.mappings.linear={fromNorm:function(a,b){return a.spec.min+b*(a.spec.max-a.spec.min)},toNorm:function(a){return(a.value-a.spec.min)/(a.spec.max-a.spec.min)}};j.mappings.log={fromNorm:function(a,b){var c=a.spec,e=Math.log(c.min),c=Math.log(c.max);return Math.exp(e+b*(c-e))},toNorm:function(a){var b=a.spec,c=Math.log(b.min),b=Math.log(b.max);return(Math.log(a.value)-c)/(b-c)}};j.names=function(a){return Object.keys(a).filter(function(b){return a[b]instanceof j})};
j.expose=function(a,b,c){c||(c=j.names(a));c.forEach(function(c){b[c]=a[c]});return j};j.bind=function(a,b,c){a instanceof j?a.bind(b,c):"value"in a?c?c.update(function(){b.value=a.value}):b.value=a.value:c?c.update(function(){b.value=a}):b.value=a;return j};j.prototype.__defineGetter__("value",function(){return this.getter()});j.prototype.__defineSetter__("value",function(a){return a!==this.getter()?n(this,this.setter(a)):a});j.prototype.watch=function(a){var b,c,e=this.watchers;b=0;for(c=e.length;b<
c;++b)if(e[b]===a)return this;e.push(a);return this};j.prototype.unwatch=function(a){var b=this.watchers;if(1>arguments.length||!a)return b.splice(0,b.length),this;for(var c=b.length-1;0<=c;--c)if(b[c]===a){b.splice(c,1);break}return this};j.prototype.changed=function(){n(this,this.getter());return this};j.prototype.alias=function(a,b){var c=this,e=Object.create(c);e.spec=Object.create(c.spec);e.spec.name=a;b&&(e.spec.label=b);e.getter=function(){return c.getter()};e.setter=function(a){return c.setter(a)};
e.alias=function(a,b){return c.alias(a,b)};return e};j.prototype.bind=function(a,b){var c=this;if(a.addEventListener){var e=c.spec,h=e.mapping?j.mappings[e.mapping]:j.mappings.linear,d,f,g;if("checkbox"===a.type)d=function(){c.value=a.checked?1:0},f=b?function(){b.update(d)}:d,g=function(b){a.checked=b?!0:!1};else if("range"===a.type)d=function(){c.value=h.fromNorm(c,parseFloat(a.value))},f=b?function(){b.update(d)}:d,g=function(){a.value=h.toNorm(c)};else throw Error("org.anclab.steller.Param.bind: Unsupported control type - "+
a.type);g.elem=a;g.unbind=function(){a.removeEventListener(f);c.unwatch(g)};a.addEventListener("change",f);c.watch(g);g(c.value)}else if("string"===typeof a){var e=document.querySelectorAll(a),o,m;o=0;for(m=e.length;o<m;++o)this.bind(e[o])}else{var l=function(b){a.value=b};l.elem=a;l.unbind=function(){c.unwatch(l)};c.watch(l);a.value=c.value}return this};j.prototype.unbind=function(a){if("string"===typeof a){var a=document.querySelectorAll(a),b,c;b=0;for(c=a.length;b<c;++b)this.unbind(a[b])}else{var e=
this.watchers;b=0;for(c=e.length;b<c;++b)if(e[b].elem===a){e[b].unbind();break}}return this};m.prototype.toString=function(){return JSON.stringify([this.t1r,this.t2r-this.t1r,this.t1,this.t2-this.t1].map(g))};m.prototype.copy=function(){var a=new m(this.t1,this.t1r,this.dt,this.rate);this.data&&(a.data=Object.create(this.data));return a};m.prototype.advance=function(a){this.t1+=a;this.t2+=a;return this};m.prototype.advanceTo=function(a){return this.advance(a-this.t1)};m.prototype.tick=function(){this.t1=
this.t2;this.t2+=this.dt;this.t1r=this.t2r;this.t2r+=this.dt*this.rate.valueOf();return this};m.prototype.jumpTo=function(a){var a=a-this.t1,b=a*this.rate.valueOf();this.t1+=a;this.t2+=a;this.t1r+=b;this.t2r+=b;return this};m.prototype.syncWith=function(a){this.t1=a.t1;this.t2=this.t1+this.dt;this.t1r=a.t1r;this.t2r=this.t1r+this.rate.valueOf()*this.dt;return this};m.prototype.nudgeToRel=function(a){a=Math.max(this.t1r,a);this.t2r>this.t1r&&(this.t1+=(a-this.t1r)*(this.t2-this.t1)/(this.t2r-this.t1r));
this.t1r=a;return this};m.prototype.rel2abs=function(a){return this.t1+(a-this.t1r)/this.rate.valueOf()};m.prototype.abs2rel=function(a){return this.t1r+(a-this.t1)*this.rate.valueOf()};var x=function(a){function b(a){var b=Math.pow(10,4-Math.min(3,(""+(a-a%1)).length));return Math.round(a*b)/b}function c(a){return function(b){a.insertAdjacentElement("beforeend",b)}}a.basicUI=function(a,h,d){if(h.ui)return h.ui;var f=a.createElement("div");d&&f.insertAdjacentHTML("beforeend","<p><b>"+d+"</b></p>");
j.names(h).map(function(a){var b=Object.create(h[a].spec);b.name=b.name||a;b.param=h[a];return b}).forEach(function(d){var h=d.name,g=d.param;if("min"in d&&"max"in d){var o=a.createElement("div"),m=a.createElement("span"),n=a.createElement("span");m.innerText=(d.label||h)+": ";m.style.width="100px";m.style.display="inline-block";m.style.textAlign="left";var i=a.createElement("input");i.type="range";i.min=0;i.max=1;i.step=0.0010;var s="string"===typeof d.mapping?j.mappings[d.mapping]:d.mapping||j.mappings.linear,
k=d.units?" "+d.units:"";i.value=s.toNorm(g);n.innerText=" ("+b(g.value)+k+")";i.changeModelParameter=function(){g.value=s.fromNorm(g,parseFloat(this.value))};i.changeSliderValue=function(a){i.value=s.toNorm(g);n.innerText=" ("+b(a)+k+")"};i.addEventListener("change",i.changeModelParameter);g.watch(i.changeSliderValue);[m,i,n].forEach(c(o));f.insertAdjacentElement("beforeend",o)}});return h.ui=f};return a}({});r.Eventable=v;r.AsyncEventable=function(a){var a=v(a),b=a.on;a.on=function(c,e){if(!e)return this;
var d=e.__steller_async_eventable__;d||Object.defineProperty(e,"__steller_async_eventable__",{value:d=function(){var b=arguments;setTimeout(function(){e.apply(a,b)},0)},enumerable:!1,configurable:!1,writable:!1});b(c,d)};return a};r.GraphNode=L;r.SoundModel=function(a,b,c){a=v(L(a,b,c));v.observe(a,"connect");v.observe(a,"disconnect");return a};r.Param=j;r.Scheduler=function(a,b){function c(a,b){a&&(q.add(a),q.add(b))}function e(a){a(l,w.copy(),h)}function h(){}function g(a,b,c){c&&c(a,b,h)}function n(a,
b){return function(c,d,e){function f(c,d){var z=o+a.valueOf();0<C&&d.t1<w.t1&&d.advance(C);d.t1>F?g&&B.add(g):d.t2r<z?(b&&b(d,d.t1r,d.t2r,o,z),d.tick(),g&&B.add(g)):(b&&z>=d.t1r&&b(d,d.t1r,z,o,z),d.t2r>d.t1r?e(c,d.nudgeToRel(z),h):e(c,d,h))}function g(a){f(a,d,h)}var o=d.t1r;f(c,d)}}function k(a){return function(b,c,d){a(c)(b,c,d)}}function A(a){function b(a,d,e){var f,g,E;if(0<c.length){E=c;c=[];f=0;for(g=E.length;f<g;++f)E[f](a,d.copy(),h)}e(a,d,h)}if(0<arguments.length)return function(a,b,c){for(;a<
b;++a)c.push(A());return c}(0,a,[]);var c=[];b.play=function(a){c.push(a);return this};b.cancel=function(){c.splice(0,c.length);return this};return b}function J(a){function b(a,d,f){e?f(a,d,h):c.push({sched:a,next:f,clock:d})}if(0<arguments.length)return function(a,b,c){for(;a<b;++a)c.push(J());return c}(0,a,[]);var c=[],d=[],e=!0;b.__defineGetter__("isOpen",function(){return e});b.__defineSetter__("isOpen",function(a){a?b.open():b.close();return a});b.open=function(a,b,d){e=!0;var f=c,g,E,o,l=D();
c=[];g=0;for(E=f.length;g<E;++g)o=f[g],o.next(o.sched,b?b.copy():o.clock.advanceTo(l),h);d&&d(a,b,h)};b.close=function(a,b,c){e=!1;c&&c(a,b,h)};b.toggle=function(a,c,d){return e?b.close(a,c,d):b.open(a,c,d)};b.cancel=function(a,b,d){c.splice(0,c.length);d&&d(a,b,h)};b.push=function(a,b,f){d.push({isOpen:e,cache:c});c=[];f&&f(a,b,h)};b.pop=function(a,b,e){var f=d.pop();c.push.apply(c,f.cache);this.isOpen=f.isOpen;e&&e(a,b,h)};return b}var l=this===p?{}:this,L=d();s();if(f()&&!L)throw Error("Scheduler needs requestAnimationFrame support. Use a sufficiently modern browser version.");
var r=0.0010,D=function(){if(a){if(a.createGain||a.createGainNode)return r=1/a.sampleRate,a.createGain=a.createGainNode=a.createGain||a.createGainNode,a.createGainNode(),function(){return a.currentTime};throw Error("Scheduler: Argument is not an audio context");}return o()||function(){return 0.0010*Date.now()}}(),M,x=!1;l.__defineGetter__("running",function(){return x});l.__defineSetter__("running",function(a){a?x||(x=!0,w.advanceTo(D()),M.start()):(x=!1,M.stop())});l.frame_rate=j({min:15,max:75,
value:60});var B=new t("tick"),q=new t("frames"),I=new t("update");M=new i(function(){var a,b,c,d,e;a=!0;b=D();V(b);for(F=b+G;b-w.t1>S;)C=b-w.t1,w.advance(C);for(;a||w.t1<F;){if(0<I.length){c=I.length;for(a=0;a<c;++a)I.remove()()}c=B.length;for(a=0;a<c;++a)B.remove()(l,w,g);w.t1<F&&w.tick();C=0;a=!1}if(0<q.length){c=q.length;for(a=0;a<c;a+=2)d=q.remove(),e=q.remove(),d(b,e)}if(l.ontick)l.ontick(b)},0,a);var v=1/60,N=v,G=M.computeAheadInterval_secs||0.05,S=5*G,w=new m(D(),0,G,1),F=w.t1,C=0,V=function(){var a=
1/60,b=w.t1,c=15;return function(d){var e=d-b;0.01<e&&0.07>e&&(N=v=a+=0.05*(e-a),G=3.33*v,S=5*G,0>=c--&&(l.frame_rate.value=Math.round(1/v),c=15));b=d}}(),T=function(){return a?function U(b){0===a.currentTime?setTimeout(U,100,b):(w=new m(D(),0,G,1),F=w.t1,l.play=T=e,e(b))}:e}(),O;b&&b.diagnostics?(4<=LOG_LEVEL&&console.log("scheduler.js[631]:\t","fire: diagnostics on"),O=function(a){return function(b,c,d){D();a(c);d(b,c,h)}}):O=function(a){return function(b,c,d){a(c);d(b,c,h)}};l.audioContext=a;l.update=
function(a){a&&I.add(a)};l.perform=function(a,b,c){a(l,b,c)};l.cancel=function(){I.clear();B.clear();q.clear()};l.play=T;l.stop=h;l.cont=g;l.delay=n;l.loop=function(a){return function z(b,c){a(b,c,z)}};l.loop_while=function(a,b){return function(c,d,e){function f(){a.valueOf()?b(c,d,f):e(c,d,h)}f()}};l.repeat=function(a,b){return function(c,d,e){function f(){if(g<a){g++;b(c,d,f)}else e(c,d,h)}var g=0;f()}};l.fork=function(a){a=a&&a.constructor===Function?Array.prototype.slice.call(arguments,0):a.slice(0);
return function(b,c,d){function e(b,g){f++;f===a.length&&d(b,c.syncWith(g),h)}var f=0;a.forEach(function(a){a(b,c.copy(),e)})}};l.spawn=function(a){a=a&&a.constructor===Function?Array.prototype.slice.call(arguments,0):a.slice(0);return function(b,c,d){a.forEach(function(a){a(b,c.copy(),h)});d(b,c,h)}};l.dynamic=k;l.track=function(a){function b(c,d,e,f,g){function o(b,c){if(l<i)a[l++](b,c,o);else e(b,c,h)}var l=0,i=a.length;if(arguments.length>3){l=f;i=g}o(c,d,e)}a&&a.constructor===Function&&(a=Array.prototype.slice.call(arguments,
0));b.minIndex=0;b.maxIndex=a.length;b.models=a;return b};l.slice=function(a,b,c){c=arguments.length>2?c:a.maxIndex;b=arguments.length>1?Math.max(a.minIndex,Math.min(b,c)):a.minIndex;return function(d,e,f){a(d,e,f,b,c)}};l.fire=O;l.display=function(a){return function(b,d,e){function f(b){b+N>g?a(d,g,b):c(f)}var g=d.t1;c(f);e(b,d,h)}};l.frame=function(a){return function(b,d,e){function f(o){if(o+N>g){d.jumpTo(o);a(d);e(b,d,h)}else c(f)}var g=d.t1;c(f)}};l.frames=function(a,b){return function(d,e,f){function g(b,
c){var d,e=l+a.valueOf();if(C>0&&c.t1<w.t1){c.advance(C);if(k){m=m+void 0;k.intervals.length>4&&k.intervals.splice(0,k.intervals.length-4);if(k.intervals.length>0){k.intervals[0]=k.intervals[0]+void 0;k.intervals[3]=c.rate.valueOf()}}}if(c.t1>F)o&&B.add(o);else{if(k&&c.t1r<=e){k.endTime=e;var n=c.rate.valueOf();for(d=Math.max(0.0010,v*n);i<c.t2r;){k.intervals.push(m);k.intervals.push(i);k.intervals.push(i+d);k.intervals.push(n);i=i+d}}if(c.t2r<e){c.tick();o&&B.add(o)}else{k.end=true;c.t2r>c.t1r?f(b,
c.nudgeToRel(e),h):f(b,c,h)}}}function o(a){g(a,e,h)}var l=e.t1r,i=l,m=e.t1,n,k;if(b){n=function(a,d){if(d.intervals.length>0){var e=d.intervals[0],f=d.intervals[1],g=d.intervals[2],h=d.intervals[3];if(f<=d.endTime){if(e<N+a){b(d.clock,f,g,d.startTime,d.endTime,h);d.intervals.splice(0,4)}c(n,d);return}}d.end||c(n,d)};k={clock:e,intervals:[],startTime:e.t1r,endTime:e.t1r+a.valueOf(),end:false};c(n,k)}g(d,e)}};l.log=function(a){return O(function(){console.log(a)})};l.anim=function(a,b){var c,d,e,f;
switch(arguments.length){case 3:f=arguments[2];break;case 4:c=arguments[2];d=arguments[3];f=function(a){return(1-a)*c.valueOf()+a*d.valueOf()};break;case 5:c=arguments[2];d=arguments[3];e=arguments[4];f=function(a){a=e(a);return(1-a)*c.valueOf()+a*d.valueOf()};break;default:throw Error("Invalid arguments to anim()");}return a.constructor.name==="AudioGain"||a.constructor.name==="AudioParam"?n(b,function(b,c,d,e,g){var g=g-e,h;if(c<=e){h=g>r?(c-e)/g:0;a.setValueAtTime(f(h),b.rel2abs(c))}a.linearRampToValueAtTime(f(g>
r?(d-e)/g:1),b.rel2abs(d))}):n(b,function(b,c,d,e,g){b=g-e-(d-c);a.value=b>r?f((c-e)/b):f(1)})};l.rate=function(a){return function(b,c,d){c.rate=a;d(b,c,h)}};l.choice=function(a){return k(function(){return a[Math.floor(Math.random()*a.length)]})};l.sync=A;l.gate=J;l.stats=function(){return{frame_jitter_ms:0}};l.running=b&&"running"in b&&b.running||!0;org.anclab.steller.Models&&(l.models=org.anclab.steller.Models(l));return l};r.Clock=m;r.PeriodicTimer=i;r.JSNodeTimer=function(a,b,c){if(c){var d=c.createJavaScriptNode(1024);
d.onaudioprocess=function(){a()};var f=this,g=!1;k(d);f.start=function(){g||(g=!0,d.connect(c.destination))};f.stop=function(){g&&(d.disconnect(),g=!1)};f.__defineGetter__("running",function(){return g});f.__defineSetter__("running",function(a){a?f.start():f.stop();return g});f.computeAheadInterval_secs=Math.round(2560)/c.sampleRate;return f}return i.call(this,a,b)};r.UI=x;r.Util={p2f:function(a){return 440*Math.pow(2,(a.valueOf()-69)/12)},f2p:function(a){a=69+12*Math.log(a.valueOf()/440)/Math.LN2;
return Math.round(100*a)/100},augment:function(a,b){var c=org.anclab.steller;if(a in c)c[a].augmentors.push(b);else{var d=function(){var a=Array.prototype.slice.call(arguments,0),b={};d.augmentors.forEach(function(c){b=c.apply(b,a)||b});return b};d.augmentors=[b];c[a]=d}return c[a]}};r.requestAnimationFrame=function(a){return function(b){return a(b)}}(d());r.AudioContext=s()})(function(){return"undefined"===typeof window?void 0:window}(),org.anclab.steller);
org.anclab.steller.Util.augment("Models",function(p){var r=org.anclab.steller,v=org.anclab.steller.Util,j=r.SoundModel,q=r.Param,n=p.audioContext,t=this;t.chime=function(){var i=n.createGainNode(),k=j({},[],[i]);k.halfLife=q({min:0.0010,max:10,value:0.5,mapping:"log"});k.attackTime=q({min:0,max:1,value:0.01});k.level=q({min:0.125,max:4,audioParam:i.gain,mapping:"log"});k.play=function(m,g){void 0===g&&(g=1);return p.fire(function(f){var d=v.p2f(m.valueOf()),s=n.createOscillator();s.type=s.SINE;s.frequency.value=
d;var o=n.createGainNode();o.gain.value=0;o.gain.setValueAtTime(0,f.t1);o.gain.linearRampToValueAtTime(g.valueOf()/8,f.t1+k.attackTime.value);var d=440*k.halfLife.value/d,j=10*d;o.gain.setTargetValueAtTime(0,f.t1+k.attackTime.value,d);s.connect(o);o.connect(i);s.start(f.t1);s.stop(f.t1+j)})};return k};t.dc=function(){var i,k,m;m=n.createBuffer(1,1024,n.sampleRate);k=m.getChannelData(0);for(i=0;1024>i;++i)k[i]=1;return function(g){var f=n.createBufferSource();f.buffer=m;f.loop=!0;f.noteOn(0);var d=
n.createGainNode();d.gain.value=g;f.connect(d);g=j({},[],[d]);g.level=q({min:-1,max:1,audioParam:d.gain});g.stop=function(d){f.stop(d)};return g}}();t.noise=function(){var i=n.createBuffer(1,5*n.sampleRate,n.sampleRate),k,m,g=i.getChannelData(0);k=0;for(m=g.length;k<m;++k)g[k]=2*Math.random()-1;return function(){var f=n.createBufferSource();f.buffer=i;f.loop=!0;f.gain.value=1;var d=n.createGainNode();d.gain.value=1;f.connect(d);f.noteOn(0);var g=t.dc(0);g.connect(d);d=j({},[],[d]);d.spread=q({min:0.01,
max:10,audioParam:f.gain});d.mean=g.level;return d}}();t.probe=function(){var i=q({min:-1,max:1,value:0}),k=q({min:-1,max:1,value:1}),m=q({min:0,max:1,value:0}),g=n.createJavaScriptNode(512,1,1),f=0,d=0,s=1-Math.exp(Math.log(0.5)/1024);g.onaudioprocess=function(g){for(var g=g.inputBuffer.getChannelData(0),n=g.length,j=0,p=0,j=0;j<n;++j)p=g[j],f+=s*(p-f),d+=s*(p*p-d);i.value=f;m.value=d;k.value=Math.sqrt(Math.max(0,d-f*f))};g.connect(n.destination);g=j({},[g],[]);g.mean=i;g.sigma=k;g.energy=m;return g};
t.mic=function(){function i(g,f,d){try{navigator.webkitGetUserMedia(g,f,d)}catch(i){d(i)}}function k(g,f){m||(m=n.createMediaStreamSource(f));m.connect(g.outputs[0]);g.error=null;g.ready.value=1}var m;return function(){var g=n.createGainNode(),f=j({},[],[g]);f.ready=q({min:-1,max:1,value:0});f.gain=q({min:0,max:1,audioParam:g.gain});m?k(f,null):i({audio:!0},function(d){return k(f,d)},function(d){f.error=d;f.gain.value=0;f.ready.value=-1});return f}}();t.spectrum=function(i,k){function m(){if(s){var d=
n.currentTime;g.getFloatFrequencyData(f.bins);for(var i=0,k=f.bins,j=k.length;i<j;++i)k[i]=Math.pow(10,k[i]/20);s=r.requestAnimationFrame(m);f.time.value=d}}var i=i||1024,g=n.createAnalyser();g.fftSize=2*i;g.frequencyBinCount=i;g.smoothingTimeConstant=2>arguments.length?0.1:k;var f=j({},[g],[]);f.bins=new Float32Array(i);f.freqs=new Float32Array(i);f.time=q({min:0,max:1E9,value:0});for(var d=0;d<i;++d)f.freqs[d]=d*n.sampleRate/g.fftSize;var s;f.start=p.fire(function(){s||(s=r.requestAnimationFrame(m))});
f.stop=p.fire(function(){s=void 0});return f};(function(){var i={};t.load_sample=function(k,m,g){var f="sound:"+k,d=i[f];if(d)return m&&m(d),d;if(m){var j=new XMLHttpRequest;j.open("GET",k,!0);j.responseType="arraybuffer";j.onerror=function(d){g&&g(d,k)};j.onload=function(){n.decodeAudioData(j.response,function(d){m(i[f]=d);0<=LOG_LEVEL&&console.log("models/sample.js[31]:\t","Sound ["+k+"] loaded!")},function(d){g&&g(d,k)})};j.send()}};t.load_sample.clearCache=function(){i={}};t.sample=function(i,
m){function g(g,i,k,j,m){var a=n.createBufferSource();a.buffer=s;a.connect(f);a.playbackRate.value=i;a.gain.setValueAtTime(0,g.t1);a.gain.setTargetValueAtTime(k,g.t1,d.attackTime.value/3);3<arguments.length?a.noteGrainOn(g.t1,j,4<arguments.length?m:a.duration):a.noteOn(g.t1);return a}var f=n.createGainNode();f.gain.value=0.25;var d=j({},[],[f]);d.level=q({min:0.0010,max:10,audioParam:f.gain,mapping:"log"});d.attackTime=q({min:0.0010,max:10,value:0.02,mapping:"log"});d.releaseTime=q({min:0.0010,max:10,
value:0.1,mapping:"log"});var s;d.load=function(f,g,j){if(s)f.perform(j,g,f.stop);else{var p=g.t1-n.currentTime;t.load_sample(i,function(i){s=i;d.duration=s.duration;f.perform(j,g.jumpTo(n.currentTime+p),f.stop)},m)}};d.trigger=function(d,f){f=f||0;return p.fire(function(i){var k=Math.pow(2,f.valueOf()/12);g(i,k,d.valueOf())})};d.play=p.track([d.load,p.dynamic(function(f){var i=g(f,f.rate.valueOf(),1);return p.delay(d.duration,function(d){i.playbackRate.value=d.rate.valueOf()})})]);d.note=function(f,
i,k,j){4>arguments.length&&(j=k);return p.dynamic(function(n){var a=g(n,f.valueOf(),1,i,k);a.gain.value=0;a.gain.setTargetValueAtTime(1,n.t1,d.attackTime.value/3);a.playbackRate.setTargetValueAtTime(f.valueOf(),n.t1,n.dt/3);return p.track([p.spawn(p.track([p.delay(j),p.fire(function(b){a.gain.setTargetValueAtTime(0,b.t1,d.releaseTime.value/3);a.stop(b.t1+12*d.releaseTime.value)})])),p.delay(k,function(b){a.playbackRate.exponentialRampToValueAtTime(f.valueOf(),b.t1)})])})};return d};t.sample.clearCache=
t.load_sample.clearCache})();t.jsnode=function(i){var k=i.numberOfInputs||0,m=k+(i.audioParams?i.audioParams.length:0),g=i.numberOfOutputs||1,f=0<m?n.createChannelMerger(m):void 0,d=0<g?n.createChannelSplitter(g):void 0,p=[],o,q,r;o=0;for(q=m;o<q;++o)r=n.createGainNode(),p.push(r),r.connect(f,0,o);var v=[];o=0;for(q=g;o<q;++o)r=n.createGainNode(),v.push(r),d&&d.connect(r,o);var x;x=i.audioParams?Object.keys(i.audioParams):[];var a={},b=[],c=[];a.inputs=b;a.outputs=c;o=0;for(q=x.length;o<q;++o)a[x[o]]=
null;a.playbackTime=n.currentTime;var e=!1,h=!1,u=0,P=Infinity,Q,y=j({},p,v),K=0<x.length?t.dc(1):void 0;x.forEach(function(a,b){var c=p[k+b];y[a]=c.gain;c.gain.value=i.audioParams[a];K.connect(c)});var l=y.keep(n.createScriptProcessor(i.bufferLength||512,m,Math.min(1,g)));f&&f.connect(l);l.onaudioprocess=function(d){var e,f,j,l,m;e=0;if(!h){var o=d.outputBuffer.length;j=Math.floor(n.currentTime*n.sampleRate);l=Math.max(j,u);m=j+o;var p=l-j;j=m-j;if(m>l){e=0;for(f=k;e<f;++e)b[e]=d.inputBuffer.getChannelData(e).subarray(p,
j);e=0;for(f=g;e<f;++e)c[e]=d.outputBuffer.getChannelData(e).subarray(p,j);e=0;for(f=x.length;e<f;++e)a[x[e]]=d.inputBuffer.getChannelData(k+e).subarray(p,j);a.playbackTime=(d.playbackTime||n.currentTime)+p/n.sampleRate;a.samplesToStop=P-l;e=i.onaudioprocess.call(y,a);void 0===e&&(e=m-l)}l+e<m&&(1<=LOG_LEVEL&&console.log("models/jsnode.js[168]:\t","Finished",m,P),h=!0,setTimeout(Q,Math.round(1E3*o/n.sampleRate)))}};var R=d||n.destination;Q=function(){h=!0;l.disconnect();d&&d.disconnect();K&&(K.stop(0),
K.disconnect());f&&f.disconnect();y.drop(l);y.emit&&y.emit("finished")};var H;y.prepareAheadTime=0.1;y.start=function(a){if(!e&&!h)if(a){var b=Math.max(a,n.currentTime)-n.currentTime;H&&(cancelTimeout(H),H=null);var c=function(a){u=Math.floor(a*n.sampleRate);e=true;H=null;l.connect(R)};b<=y.prepareAheadTime?c(a):H=setTimeout(c,Math.round(1E3*(b-y.prepareAheadTime)),a)}else e=!0,l.connect(R)};y.stop=function(a){h||(P=Math.max(u,Math.ceil(a*n.sampleRate)))};0<k&&y.start(0);return y};return t});
