var LOG_LEVEL=4;org="undefined"===typeof org?{}:org;org.anclab=org.anclab||{};org.anclab.steller=org.anclab.steller||{};
(function(p,q){function t(a){var b={};if("on"in a){console.error("eventable.js[99]:\tASSERT failed (!('on' in obj)) ");debugger}if("off"in a){console.error("eventable.js[100]:\tASSERT failed (!('off' in obj)) ");debugger}if("emit"in a){console.error("eventable.js[101]:\tASSERT failed (!('emit' in obj)) ");debugger}a.on=function(a,d){var f,g;if(2<arguments.length){f=1;for(g=arguments.length;f<g;++f)this.on(a,arguments[f]);return this}var e=b[a]||(b[a]=[]);f=0;for(g=e.length;f<g;++f)if(e[f]===d)return this;
e.push(d);return this};a.off=function(a,d){var f,g;if(2<arguments.length){f=1;for(g=arguments.length;f<g;++f)this.off(a,arguments[f]);return this}var e=b[a];if(!e)return this;if(d){f=0;for(g=e.length;f<g;++f)if(e[f]===d)return e.splice(f,1),this;console.warning("eventable.js[68]:\tWARNING!\ttrue");return this}delete b[a];return this};a.emit=function(a){var d=b[a];if(!d)return this;var f,g;f=0;for(g=d.length;f<g;++f)try{d[f].apply(this,arguments)}catch(e){1<=LOG_LEVEL&&console.log("eventable.js[92]:\t",
"Exception in event watcher - ",e)}return this};return a}function n(a){var b=Object.create(n.prototype);b.spec=a=r(Object.create(a));b.getter=void 0;b.setter=void 0;b.valueOf=void 0;b.audioParam=void 0;b.watchers=[];b._value=void 0;a.audioParam?(b.audioParam=a.audioParam,b.getter=a.getter||n.getters.audioParam,b.setter=a.setter||n.setters.audioParam):a.options?(b.getter=a.getter||n.getters.value,b.setter=a.setter||n.setters.option):(b.getter=a.getter||n.getters.value,b.setter=a.setter||n.setters.value);
b.valueOf=b.getter;"value"in a&&b.setter(a.value);return b}function r(a){if(a.options){var b={};a.options.forEach(function(a,d){b["option:"+a]=d+1});a.limit=function(c){if("number"===typeof c){if(0<=c&&c<a.options.length)return a.options[c];throw Error("Invalid enumeration index");}if(b["option:"+c])return c;throw Error("Invalid enumeration value");}}return a}function o(a,b){var c,d,f=a.watchers;c=0;for(d=f.length;c<d;++c)f[c](b,a);return b}function s(){var a=0,b=4,c=[null,null,null,null],d=-1,f=
0;this.length=0;this.add=function(g){if(a>=b){var e=Array(2*b),i,h,m,l;i=d;h=0;m=a;for(l=b;h<m;++h,i=(i+1)%l)e[h]=c[i];c=e;f=a;d=0===a?-1:0;b*=2}c[f]=g;0>d&&(d=f);f=(f+1)%b;return this.length=a+=1};this.remove=function(){if(0>=a)throw Error("Empty queue");var f=c[d];c[d]=null;d=(d+1)%b;this.length=a-=1;return f};this.clear=function(){this.length=a=0;c.splice(0,c.length,null,null,null,null);b=4;d=-1;f=0};return this}function k(a,b){var c=e();if(g()&&!c)throw Error("PeriodicTimer needs requestAnimationFrame support. Use a sufficiently modern browser.");
var d=this,f=!1,i,b=void 0===b?15:Math.min(Math.max(g()?15:1,b),33);c&&12<=b?(d.start=function(){f||(f=!0,c(function(){f&&(c(arguments.callee),a())}))},d.stop=function(){f=!1}):(d.start=function(){f||(f=!0,i=setInterval(a,1))},d.stop=function(){f&&(f=!1,clearInterval(i),i=void 0)});d.__defineGetter__("running",function(){return f});d.__defineSetter__("running",function(a){a?d.start():d.stop();return f});5>=b&&console.warning("periodictimer.js[93]:\tWARNING!\tprecision_ms <= 5");d.computeAheadInterval_secs=
Math.round(3.333*b)/1E3;return d}function j(a){(p.JSNodeTimer_jsnodes||(p.JSNodeTimer_jsnodes=[])).push(a)}function m(a,b,c,d){this.dt=c;this.t1=a;this.t2=a+c;this.t1r=b;this.t2r=b+d.valueOf()*c;this.rate=d;this.data=null;return this}function h(a){return Math.round(1E3*a)/1E3}function g(){return"object"===typeof p&&"object"===typeof document&&p.document===document}function e(){try{return p.requestAnimationFrame||p.webkitRequestAnimationFrame||p.mozRequestAnimationFrame||p.msRequestAnimationFrame||
function(a){setTimeout(a,1E3/60)}}catch(a){}}function w(){try{return p.webkitAudioContext||p.mozAudioContext}catch(a){}}function i(){try{var a=p.performance,b=a&&(a.now||a.webkitNow||a.mozNow);if(b)return function(){return 0.0010*b.call(a)}}catch(c){}}t.observe=function(a,b,c){if(!a.emit){debugger;throw Error("eventable.js[113]:\tobj.emit");}var c=c||b,d=a[b];if("function"!==typeof d){debugger;throw Error("eventable.js[118]:\ttypeof(method) === 'function'");}a[b]=function(){var a=d.apply(this,arguments),
b=Array.prototype.slice.call(arguments);b.unshift(c);this.emit.apply(this,b);return a};return a};var y=function(){function a(f,c,d){f.inputs=c||[];f.outputs=d||[];f.numberOfInputs=f.inputs.length;f.numberOfOutputs=f.outputs.length;if(!(0<f.numberOfInputs+f.numberOfOutputs)){console.error("graphnode.js[37]:\tASSERT failed (node.numberOfInputs + node.numberOfOutputs > 0) ");debugger}f.context=f.inputs[0]&&f.inputs[0].context||f.outputs[0]&&f.outputs[0].context;if(!f.context){console.error("graphnode.js[41]:\tASSERT failed (node.context) ");
debugger}f.connect=function(a,b,c){var d,a=a||f.context.destination,b=f.outputs[b||0];d=a.inputs?a.inputs[c||0]:a;if("AudioParam"===d.constructor.name||"AudioGain"===d.constructor.name)b.connect(d);else if(d.numberOfInputs===b.numberOfOutputs){a=0;for(c=d.numberOfInputs;a<c;++a)b.connect(d,a,a)}else b.connect(d);return f};f.disconnect=function(){0<arguments.length?Array.prototype.forEach.call(arguments,function(a){f.outputs[a].disconnect()}):f.outputs.forEach(function(a){a.disconnect()});return f};
var g={},e=b(f);f.keep=function(a){var a=a||f,c=b(a);return g[c]=a};f.drop=function(f){f?(f=b(f),delete g[f]):delete a._preservedNodes[e]};a._preservedNodes[e]=g;return f}function b(a){var b=a[d];b||(b=c++,Object.defineProperty(a,d,{value:b,writable:!1,enumerable:!1,configurable:!1}));return b}var c=1,d="#org.anclab.steller.GraphNode.globalid";a._preservedNodes={};a.chain=function(b){var c,d;c=0;for(d=b.length-1;c<d;++c)b[c].connect(b[c+1]);return a};return a}();n.getters={value:function(){return this._value},
audioParam:function(){return this.audioParam.value}};n.setters={value:function(a){return this._value=a},audioParam:function(a){return this.audioParam.value=a},option:function(a){return this._value=this.spec.limit(a)}};n.mappings={};n.mappings.linear={fromNorm:function(a,b){return a.spec.min+b*(a.spec.max-a.spec.min)},toNorm:function(a){return(a.value-a.spec.min)/(a.spec.max-a.spec.min)}};n.mappings.log={fromNorm:function(a,b){var c=a.spec,d=Math.log(c.min),c=Math.log(c.max);return Math.exp(d+b*(c-
d))},toNorm:function(a){var b=a.spec,c=Math.log(b.min),b=Math.log(b.max);return(Math.log(a.value)-c)/(b-c)}};n.names=function(a){return Object.keys(a).filter(function(b){return a[b]instanceof n})};n.expose=function(a,b,c){c||(c=n.names(a));c.forEach(function(c){c in b&&console.warning("param.js[150]:\tWARNING!\tn in obj2");b[c]=a[c]});return n};n.bind=function(a,b,c){a instanceof n?a.bind(b,c):"value"in a?c?c.update(function(){b.value=a.value}):b.value=a.value:c?c.update(function(){b.value=a}):b.value=
a;return n};n.prototype.__defineGetter__("value",function(){return this.getter()});n.prototype.__defineSetter__("value",function(a){return a!==this.getter()?o(this,this.setter(a)):a});n.prototype.watch=function(a){var b,c,d=this.watchers;b=0;for(c=d.length;b<c;++b)if(d[b]===a)return this;d.push(a);return this};n.prototype.unwatch=function(a){var b=this.watchers;if(1>arguments.length||!a)return b.splice(0,b.length),this;for(var c=b.length-1;0<=c;--c)if(b[c]===a){b.splice(c,1);break}return this};n.prototype.changed=
function(){o(this,this.getter());return this};n.prototype.alias=function(a,b){if(!a){console.error("param.js[266]:\tASSERT failed (name) ","Param.alias call needs name as first argument.");debugger}var c=this,d=Object.create(c);d.spec=Object.create(c.spec);d.spec.name=a;b&&(d.spec.label=b);d.getter=function(){return c.getter()};d.setter=function(a){return c.setter(a)};d.alias=function(a,b){return c.alias(a,b)};return d};n.prototype.bind=function(a,b){var c=this;if(a.addEventListener){var d=c.spec,
f=d.mapping?n.mappings[d.mapping]:n.mappings.linear,g,e,i;if("checkbox"===a.type)g=function(){c.value=a.checked?1:0},e=b?function(){b.update(g)}:g,i=function(b){a.checked=b?!0:!1};else if("range"===a.type)g=function(){c.value=f.fromNorm(c,parseFloat(a.value))},e=b?function(){b.update(g)}:g,i=function(){a.value=f.toNorm(c)};else throw Error("org.anclab.steller.Param.bind: Unsupported control type - "+a.type);i.elem=a;i.unbind=function(){a.removeEventListener(e);c.unwatch(i)};a.addEventListener("change",
e);c.watch(i);i(c.value)}else if("string"===typeof a){var d=document.querySelectorAll(a),h,m;h=0;for(m=d.length;h<m;++h)this.bind(d[h])}else{var l=function(b){a.value=b};l.elem=a;l.unbind=function(){c.unwatch(l)};c.watch(l);a.value=c.value}return this};n.prototype.unbind=function(a){if("string"===typeof a){var a=document.querySelectorAll(a),b,c;b=0;for(c=a.length;b<c;++b)this.unbind(a[b])}else{var d=this.watchers;b=0;for(c=d.length;b<c;++b)if(d[b].elem===a){d[b].unbind();break}}return this};m.prototype.toString=
function(){return JSON.stringify([this.t1r,this.t2r-this.t1r,this.t1,this.t2-this.t1].map(h))};m.prototype.copy=function(){var a=new m(this.t1,this.t1r,this.dt,this.rate);this.data&&(a.data=Object.create(this.data));return a};m.prototype.advance=function(a){this.t1+=a;this.t2+=a;return this};m.prototype.advanceTo=function(a){return this.advance(a-this.t1)};m.prototype.tick=function(){this.t1=this.t2;this.t2+=this.dt;this.t1r=this.t2r;this.t2r+=this.dt*this.rate.valueOf();return this};m.prototype.jumpTo=
function(a){var a=a-this.t1,b=a*this.rate.valueOf();this.t1+=a;this.t2+=a;this.t1r+=b;this.t2r+=b;return this};m.prototype.syncWith=function(a){this.t1=a.t1;this.t2=this.t1+this.dt;this.t1r=a.t1r;this.t2r=this.t1r+this.rate.valueOf()*this.dt;return this};m.prototype.nudgeToRel=function(a){a=Math.max(this.t1r,a);this.t2r>this.t1r&&(this.t1+=(a-this.t1r)*(this.t2-this.t1)/(this.t2r-this.t1r));this.t1r=a;return this};m.prototype.rel2abs=function(a){return this.t1+(a-this.t1r)/this.rate.valueOf()};m.prototype.abs2rel=
function(a){return this.t1r+(a-this.t1)*this.rate.valueOf()};var M=function(a){function b(a){var b=Math.pow(10,4-Math.min(3,(""+(a-a%1)).length));return Math.round(a*b)/b}function c(a){return function(b){a.insertAdjacentElement("beforeend",b)}}a.basicUI=function(a,f,g){if(f.ui)return f.ui;var e=a.createElement("div");g&&e.insertAdjacentHTML("beforeend","<p><b>"+g+"</b></p>");n.names(f).map(function(a){var b=Object.create(f[a].spec);b.name=b.name||a;b.param=f[a];return b}).forEach(function(f){var g=
f.name,i=f.param;if("min"in f&&"max"in f){var l=a.createElement("div"),h=a.createElement("span"),m=a.createElement("span");h.innerText=(f.label||g)+": ";h.style.width="100px";h.style.display="inline-block";h.style.textAlign="left";var k=a.createElement("input");k.type="range";k.min=0;k.max=1;k.step=0.0010;var o="string"===typeof f.mapping?n.mappings[f.mapping]:f.mapping||n.mappings.linear,j=f.units?" "+f.units:"";k.value=o.toNorm(i);m.innerText=" ("+b(i.value)+j+")";k.changeModelParameter=function(){i.value=
o.fromNorm(i,parseFloat(this.value))};k.changeSliderValue=function(a){k.value=o.toNorm(i);m.innerText=" ("+b(a)+j+")"};k.addEventListener("change",k.changeModelParameter);i.watch(k.changeSliderValue);[h,k,m].forEach(c(l));e.insertAdjacentElement("beforeend",l)}});return f.ui=e};return a}({});q.Eventable=t;q.GraphNode=y;q.SoundModel=function(a,b,c){a=t(y(a,b,c));t.observe(a,"connect");t.observe(a,"disconnect");return a};q.Param=n;q.Scheduler=function(a,b){function c(a,b){a&&(z.add(a),z.add(b))}function d(a){a(l,
u.copy(),f)}function f(){}function h(a,b,c){c&&c(a,b,f)}function o(a,b){return function(c,d,g){function e(c,d){var x=h+a.valueOf();0<A&&d.t1<u.t1&&d.advance(A);d.t1>E?i&&B.add(i):d.t2r<x?(b&&b(d,d.t1r,d.t2r,h,x),d.tick(),i&&B.add(i)):(b&&x>=d.t1r&&b(d,d.t1r,x,h,x),d.t2r>d.t1r?g(c,d.nudgeToRel(x),f):g(c,d,f))}function i(a){e(a,d,f)}var h=d.t1r;e(c,d)}}function j(a){return function(b,c,f){a(c)(b,c,f)}}function y(a){function b(a,d,g){var e,i,D;if(0<c.length){D=c;c=[];e=0;for(i=D.length;e<i;++e)D[e](a,
d.copy(),f)}g(a,d,f)}if(0<arguments.length)return function(a,b,c){for(;a<b;++a)c.push(y());return c}(0,a,[]);var c=[];b.play=function(a){c.push(a);return this};b.cancel=function(){c.splice(0,c.length);return this};return b}function M(a){function b(a,d,e){g?e(a,d,f):c.push({sched:a,next:e,clock:d})}if(0<arguments.length)return function(a,b,c){for(;a<b;++a)c.push(M());return c}(0,a,[]);var c=[],d=[],g=!0;b.__defineGetter__("isOpen",function(){return g});b.__defineSetter__("isOpen",function(a){a?b.open():
b.close();return a});b.open=function(a,b,d){g=!0;var e=c,i,D,h,l=v();c=[];i=0;for(D=e.length;i<D;++i)h=e[i],h.next(h.sched,b?b.copy():h.clock.advanceTo(l),f);d&&d(a,b,f)};b.close=function(a,b,c){g=!1;c&&c(a,b,f)};b.toggle=function(a,c,f){return g?b.close(a,c,f):b.open(a,c,f)};b.cancel=function(a,b,d){c.splice(0,c.length);d&&d(a,b,f)};b.push=function(a,b,e){d.push({isOpen:g,cache:c});c=[];e&&e(a,b,f)};b.pop=function(a,b,g){var e=d.pop();c.push.apply(c,e.cache);this.isOpen=e.isOpen;g&&g(a,b,f)};return b}
var l=this===p?{}:this,q=e(),r=w();if(g()&&!q)throw Error("Scheduler needs requestAnimationFrame support. Use a sufficiently modern browser version.");var t=0.0010,v=function(){if(a){if(a instanceof r)return t=1/a.sampleRate,a.createGainNode(),function(){return a.currentTime};throw Error("Scheduler: Argument is not an audio context");}return i()||function(){return 0.0010*Date.now()}}(),K,L=!1;l.__defineGetter__("running",function(){return L});l.__defineSetter__("running",function(a){a?L||(L=!0,u.advanceTo(v()),
K.start()):(L=!1,K.stop())});l.frame_rate=n({min:15,max:75,value:60});var B=new s("tick"),z=new s("frames"),H=new s("update");K=new k(function(){var a,b,c,f,d;a=!0;b=v();W(b);for(E=b+F;b-u.t1>T;)A=b-u.t1,u.advance(A);for(;a||u.t1<E;){if(0<H.length){c=H.length;for(a=0;a<c;++a)H.remove()()}c=B.length;for(a=0;a<c;++a)B.remove()(l,u,h);u.t1<E&&u.tick();A=0;a=!1}if(0<z.length){c=z.length;for(a=0;a<c;a+=2)f=z.remove(),d=z.remove(),f(b,d)}if(l.ontick)l.ontick(b)},0,a);var I=1/60,N=I,F=K.computeAheadInterval_secs||
0.05,T=5*F,u=new m(v(),0,F,1),E=u.t1,A=0,W=function(){var a=1/60,b=u.t1,c=15;return function(f){var d=f-b;0.01<d&&0.07>d&&(N=I=a+=0.05*(d-a),F=3.33*I,T=5*F,0>=c--&&(l.frame_rate.value=Math.round(1/I),c=15));b=f}}(),U=function(){return a?function V(b){0===a.currentTime?setTimeout(V,100,b):(u=new m(v(),0,F,1),E=u.t1,l.play=U=d,d(b))}:d}(),O;b&&b.diagnostics?(4<=LOG_LEVEL&&console.log("scheduler.js[630]:\t","fire: diagnostics on"),O=function(a){return function(b,c,d){var g=v();c.t1<g&&console.warning("scheduler.js[634]:\tWARNING!\tclock.t1 < t");
a(c);d(b,c,f)}}):O=function(a){return function(b,c,d){a(c);d(b,c,f)}};l.audioContext=a;l.update=function(a){a&&H.add(a)};l.perform=function(a,b,c){a(l,b,c)};l.cancel=function(){H.clear();B.clear();z.clear()};l.play=U;l.stop=f;l.cont=h;l.delay=o;l.loop=function(a){return function x(b,c){a(b,c,x)}};l.loop_while=function(a,b){return function(c,d,g){function e(){a.valueOf()?b(c,d,e):g(c,d,f)}e()}};l.repeat=function(a,b){return function(c,d,g){function e(){if(i<a){i++;b(c,d,e)}else g(c,d,f)}var i=0;e()}};
l.fork=function(a){a=a&&a.constructor===Function?Array.prototype.slice.call(arguments,0):a.slice(0);return function(b,c,d){function g(b,i){e++;e===a.length&&d(b,c.syncWith(i),f)}var e=0;a.forEach(function(a){a(b,c.copy(),g)})}};l.spawn=function(a){a=a&&a.constructor===Function?Array.prototype.slice.call(arguments,0):a.slice(0);return function(b,c,d){a.forEach(function(a){a(b,c.copy(),f)});d(b,c,f)}};l.dynamic=j;l.track=function(a){function b(c,d,e,g,i){function h(b,c){if(l<m)a[l++](b,c,h);else e(b,
c,f)}var l=0,m=a.length;if(arguments.length>3){if(arguments.length!==5){console.error("scheduler.js[581]:\tASSERT failed (arguments.length === 5) ");debugger}l=g;m=i}h(c,d,e)}a&&a.constructor===Function&&(a=Array.prototype.slice.call(arguments,0));b.minIndex=0;b.maxIndex=a.length;b.models=a;return b};l.slice=function(a,b,c){c=arguments.length>2?c:a.maxIndex;b=arguments.length>1?Math.max(a.minIndex,Math.min(b,c)):a.minIndex;return function(d,f,e){a(d,f,e,b,c)}};l.fire=O;l.display=function(a){return function(b,
d,e){function g(b){b+N>i?a(d,i,b):c(g)}var i=d.t1;c(g);e(b,d,f)}};l.frame=function(a){return function(b,d,e){function g(h){if(h+N>i){d.jumpTo(h);a(d);e(b,d,f)}else c(g)}var i=d.t1;c(g)}};l.frames=function(a,b){return function(d,e,g){function i(b,c){var d,e=l+a.valueOf();if(A>0&&c.t1<u.t1){c.advance(A);if(j){k=k+void 0;j.intervals.length>4&&j.intervals.splice(0,j.intervals.length-4);if(j.intervals.length>0){j.intervals[0]=j.intervals[0]+void 0;j.intervals[3]=c.rate.valueOf()}}}if(c.t1>E)h&&B.add(h);
else{if(j&&c.t1r<=e){j.endTime=e;var o=c.rate.valueOf();for(d=Math.max(0.0010,I*o);m<c.t2r;){j.intervals.push(k);j.intervals.push(m);j.intervals.push(m+d);j.intervals.push(o);m=m+d}}if(c.t2r<e){c.tick();h&&B.add(h)}else{j.end=true;c.t2r>c.t1r?g(b,c.nudgeToRel(e),f):g(b,c,f)}}}function h(a){i(a,e,f)}var l=e.t1r,m=l,k=e.t1,o,j;if(b){o=function(a,d){if(d.intervals.length>0){var f=d.intervals[0],e=d.intervals[1],g=d.intervals[2],i=d.intervals[3];if(e<=d.endTime){if(f<N+a){b(d.clock,e,g,d.startTime,d.endTime,
i);d.intervals.splice(0,4)}c(o,d);return}}d.end||c(o,d)};j={clock:e,intervals:[],startTime:e.t1r,endTime:e.t1r+a.valueOf(),end:false};c(o,j)}i(d,e)}};l.log=function(a){return O(function(){console.log(a)})};l.anim=function(a,b){var c,d,f,e;switch(arguments.length){case 3:e=arguments[2];break;case 4:c=arguments[2];d=arguments[3];e=function(a){return(1-a)*c.valueOf()+a*d.valueOf()};break;case 5:c=arguments[2];d=arguments[3];f=arguments[4];e=function(a){a=f(a);return(1-a)*c.valueOf()+a*d.valueOf()};break;
default:throw Error("Invalid arguments to anim()");}return a.constructor.name==="AudioGain"||a.constructor.name==="AudioParam"?o(b,function(b,c,d,f,g){var g=g-f,i;if(c<=f){i=g>t?(c-f)/g:0;a.setValueAtTime(e(i),b.rel2abs(c))}a.linearRampToValueAtTime(e(g>t?(d-f)/g:1),b.rel2abs(d))}):o(b,function(b,c,d,f,g){b=g-f-(d-c);a.value=b>t?e((c-f)/b):e(1)})};l.rate=function(a){return function(b,c,d){c.rate=a;d(b,c,f)}};l.choice=function(a){return j(function(){return a[Math.floor(Math.random()*a.length)]})};
l.sync=y;l.gate=M;l.stats=function(){return{frame_jitter_ms:0}};l.running=b&&"running"in b&&b.running||!0;org.anclab.steller.Models&&(l.models=org.anclab.steller.Models(l));return l};q.Clock=m;q.PeriodicTimer=k;q.JSNodeTimer=function(a,b,c){if(c){var d=c.createJavaScriptNode(1024);d.onaudioprocess=function(){a()};var f=this,e=!1;j(d);f.start=function(){e||(e=!0,d.connect(c.destination))};f.stop=function(){e&&(d.disconnect(),e=!1)};f.__defineGetter__("running",function(){return e});f.__defineSetter__("running",
function(a){a?f.start():f.stop();return e});f.computeAheadInterval_secs=Math.round(2560)/c.sampleRate;return f}return k.call(this,a,b)};q.UI=M;q.Util={p2f:function(a){return 440*Math.pow(2,(a.valueOf()-69)/12)},f2p:function(a){a=69+12*Math.log(a.valueOf()/440)/Math.LN2;return Math.round(100*a)/100},augment:function(a,b){var c=org.anclab.steller;if(a in c)c[a].augmentors.push(b);else{var d=function(){var a=Array.prototype.slice.call(arguments,0),b={};d.augmentors.forEach(function(c){b=c.apply(b,a)||
b});return b};d.augmentors=[b];c[a]=d}return c[a]}};q.requestAnimationFrame=function(a){return function(b){return a(b)}}(e());q.AudioContext=w()})(function(){return"undefined"===typeof window?void 0:window}(),org.anclab.steller);if(!org.anclab.steller){console.error("models.js[20]:\tASSERT failed (org.anclab.steller) ");debugger}
org.anclab.steller.Util.augment("Models",function(p){var q=org.anclab.steller,t=org.anclab.steller.Util,n=q.SoundModel,r=q.Param,o=p.audioContext,s=this;s.chime=function(){var k=o.createGainNode(),j=n({},[],[k]);j.halfLife=r({min:0.0010,max:10,value:0.5,mapping:"log"});j.attackTime=r({min:0,max:1,value:0.01});j.level=r({min:0.125,max:4,audioParam:k.gain,mapping:"log"});j.play=function(m,h){void 0===h&&(h=1);return p.fire(function(g){var e=t.p2f(m.valueOf()),n=o.createOscillator();n.type=n.SINE;n.frequency.value=
e;var i=o.createGainNode();i.gain.value=0;i.gain.setValueAtTime(0,g.t1);i.gain.linearRampToValueAtTime(h.valueOf()/8,g.t1+j.attackTime.value);var e=440*j.halfLife.value/e,y=10*e;i.gain.setTargetValueAtTime(0,g.t1+j.attackTime.value,e);n.connect(i);i.connect(k);n.noteOn(g.t1);n.stop(g.t1+y)})};return j};s.dc=function(){var k,j,m;m=o.createBuffer(1,1024,o.sampleRate);j=m.getChannelData(0);for(k=0;1024>k;++k)j[k]=1;return function(h){var g=o.createBufferSource();g.buffer=m;g.loop=!0;g.noteOn(0);var e=
o.createGainNode();e.gain.value=h;g.connect(e);h=n({},[],[e]);h.level=r({min:-1,max:1,audioParam:e.gain});h.stop=function(e){g.stop(e)};return h}}();s.noise=function(){var k=o.createBuffer(1,5*o.sampleRate,o.sampleRate),j,m,h=k.getChannelData(0);j=0;for(m=h.length;j<m;++j)h[j]=2*Math.random()-1;return function(){var g=o.createBufferSource();g.buffer=k;g.loop=!0;g.gain.value=1;var e=o.createGainNode();e.gain.value=1;g.connect(e);g.noteOn(0);var h=s.dc(0);h.connect(e);e=n({},[],[e]);e.spread=r({min:0.01,
max:10,audioParam:g.gain});e.mean=h.level;return e}}();s.probe=function(){var k=r({min:-1,max:1,value:0}),j=r({min:-1,max:1,value:1}),m=r({min:0,max:1,value:0}),h=o.createJavaScriptNode(512,1,1),g=0,e=0,w=1-Math.exp(Math.log(0.5)/1024);h.onaudioprocess=function(i){for(var i=i.inputBuffer.getChannelData(0),h=i.length,o=0,a=0,o=0;o<h;++o)a=i[o],g+=w*(a-g),e+=w*(a*a-e);k.value=g;m.value=e;j.value=Math.sqrt(Math.max(0,e-g*g))};h.connect(o.destination);h=n({},[h],[]);h.mean=k;h.sigma=j;h.energy=m;return h};
s.mic=function(){function k(h,g,e){try{navigator.webkitGetUserMedia(h,g,e)}catch(m){e(m)}}function j(h,g){if(!m){if(!g){console.error("models/mic.js[46]:\tASSERT failed (stream) ");debugger}m=o.createMediaStreamSource(g)}m.connect(h.outputs[0]);h.error=null;h.ready.value=1}var m;return function(){var h=o.createGainNode(),g=n({},[],[h]);g.ready=r({min:-1,max:1,value:0});g.gain=r({min:0,max:1,audioParam:h.gain});m?j(g,null):k({audio:!0},function(e){return j(g,e)},function(e){g.error=e;g.gain.value=
0;g.ready.value=-1});return g}}();s.spectrum=function(k,j){function m(){if(w){var e=o.currentTime;h.getFloatFrequencyData(g.bins);for(var j=0,k=g.bins,a=k.length;j<a;++j)k[j]=Math.pow(10,k[j]/20);w=q.requestAnimationFrame(m);g.time.value=e}}var k=k||1024,h=o.createAnalyser();h.fftSize=2*k;h.frequencyBinCount=k;h.smoothingTimeConstant=2>arguments.length?0.1:j;var g=n({},[h],[]);g.bins=new Float32Array(k);g.freqs=new Float32Array(k);g.time=r({min:0,max:1E9,value:0});for(var e=0;e<k;++e)g.freqs[e]=e*
o.sampleRate/h.fftSize;var w;g.start=p.fire(function(){w||(w=q.requestAnimationFrame(m))});g.stop=p.fire(function(){w=void 0});return g};(function(){var k={};s.load_sample=function(j,m,h){var g="sound:"+j,e=k[g];if(e)return m&&m(e),e;if(m){var n=new XMLHttpRequest;n.open("GET",j,!0);n.responseType="arraybuffer";n.onerror=function(e){console.error("models/sample.js[22]:\t",e);h&&h(e,j)};n.onload=function(){o.decodeAudioData(n.response,function(e){m(k[g]=e);0<=LOG_LEVEL&&console.log("models/sample.js[31]:\t",
"Sound ["+j+"] loaded!")},function(e){console.error("models/sample.js[34]:\t","Sound ["+j+"] failed to decode.");h&&h(e,j)})};n.send()}};s.load_sample.clearCache=function(){k={}};s.sample=function(j,m){function h(i,h,j,a,b){if(!k){console.error("models/sample.js[109]:\tASSERT failed (soundBuff) ");debugger}var c=o.createBufferSource();c.buffer=k;c.connect(g);c.playbackRate.value=h;c.gain.setValueAtTime(0,i.t1);c.gain.setTargetValueAtTime(j,i.t1,e.attackTime.value/3);3<arguments.length?c.noteGrainOn(i.t1,
a,4<arguments.length?b:c.duration):c.noteOn(i.t1);return c}var g=o.createGainNode();g.gain.value=0.25;var e=n({},[],[g]);e.level=r({min:0.0010,max:10,audioParam:g.gain,mapping:"log"});e.attackTime=r({min:0.0010,max:10,value:0.02,mapping:"log"});e.releaseTime=r({min:0.0010,max:10,value:0.1,mapping:"log"});var k;e.load=function(g,h,n){if(k)g.perform(n,h,g.stop);else{var a=h.t1-o.currentTime;s.load_sample(j,function(b){k=b;e.duration=k.duration;g.perform(n,h.jumpTo(o.currentTime+a),g.stop)},m)}};e.trigger=
function(e,g){g=g||0;return p.fire(function(j){var a=Math.pow(2,g.valueOf()/12);h(j,a,e.valueOf())})};e.play=p.track([e.load,p.dynamic(function(g){var j=h(g,g.rate.valueOf(),1);return p.delay(e.duration,function(e){j.playbackRate.value=e.rate.valueOf()})})]);e.note=function(g,j,k,a){4>arguments.length&&(a=k);return p.dynamic(function(b){var c=h(b,g.valueOf(),1,j,k);c.gain.value=0;c.gain.setTargetValueAtTime(1,b.t1,e.attackTime.value/3);c.playbackRate.setTargetValueAtTime(g.valueOf(),b.t1,b.dt/3);
return p.track([p.spawn(p.track([p.delay(a),p.fire(function(a){c.gain.setTargetValueAtTime(0,a.t1,e.releaseTime.value/3);c.stop(a.t1+12*e.releaseTime.value)})])),p.delay(k,function(a){c.playbackRate.exponentialRampToValueAtTime(g.valueOf(),a.t1)})])})};return e};s.sample.clearCache=s.load_sample.clearCache})();s.jsnode=function(k){var j=k.numberOfInputs||0,m=k.numberOfOutputs||1,h=j+(k.audioParams?k.audioParams.length:0);if(!(0<=j)){console.error("models/jsnode.js[66]:\tASSERT failed (numberOfInputs >= 0) ");
debugger}if(!(0<=m)){console.error("models/jsnode.js[67]:\tASSERT failed (numberOfOutputs >= 0) ");debugger}if(!(0<m)){console.error("models/jsnode.js[68]:\tASSERT failed (numOutputs > 0) ");debugger}var g=0<h?o.createChannelMerger(h):void 0,e=0<m?o.createChannelSplitter(m):void 0,p=[],i,q,r;i=0;for(q=h;i<q;++i)r=o.createGainNode(),p.push(r),r.connect(g,0,i);var a=[];i=0;for(q=m;i<q;++i)r=o.createGainNode(),a.push(r),e&&e.connect(r,i);var b;if(k.audioParams){b=Object.keys(k.audioParams);if("inputs"in
k.audioParams){console.error("models/jsnode.js[90]:\tASSERT failed (!('inputs' in spec.audioParams)) ");debugger}if("outputs"in k.audioParams){console.error("models/jsnode.js[91]:\tASSERT failed (!('outputs' in spec.audioParams)) ");debugger}if("playbackTime"in k.audioParams){console.error("models/jsnode.js[92]:\tASSERT failed (!('playbackTime' in spec.audioParams)) ");debugger}}else b=[];var c={},d=[],f=[];c.inputs=d;c.outputs=f;i=0;for(q=b.length;i<q;++i)c[b[i]]=null;c.playbackTime=o.currentTime;
var t=!1,G=!1,P=0,Q=Infinity,R,l=n({},p,a),J=0<b.length?s.dc(1):void 0;b.forEach(function(a,d){var e=p[j+d];l[a]=e.gain;e.gain.value=k.audioParams[a];J.connect(e);if(b[d]in c){console.error("models/jsnode.js[191]:\tASSERT failed (!(paramNames[i] in obj)) ","Duplicate param name - ",b[d]);debugger}});var C=l.keep(o.createScriptProcessor(k.bufferLength||512,h,Math.min(1,m)));g&&g.connect(C);C.onaudioprocess=function(a){var e,g,h,i,n;e=0;if(!G){var p=a.outputBuffer.length;h=Math.floor(o.currentTime*
o.sampleRate);i=Math.max(h,P);n=h+p;var q=i-h;h=n-h;if(n>i){e=0;for(g=j;e<g;++e)d[e]=a.inputBuffer.getChannelData(e).subarray(q,h);e=0;for(g=m;e<g;++e)f[e]=a.outputBuffer.getChannelData(e).subarray(q,h);e=0;for(g=b.length;e<g;++e)c[b[e]]=a.inputBuffer.getChannelData(j+e).subarray(q,h);c.playbackTime=(a.playbackTime||o.currentTime)+q/o.sampleRate;c.samplesToStop=Q-i;e=k.onaudioprocess.call(l,c);void 0===e&&(e=n-i)}i+e<n&&(1<=LOG_LEVEL&&console.log("models/jsnode.js[168]:\t","Finished",n,Q),G=!0,setTimeout(R,
Math.round(1E3*p/o.sampleRate)))}};var S=e||o.destination;R=function(){G=!0;C.disconnect();e&&e.disconnect();J&&(J.stop(0),J.disconnect());g&&g.disconnect();l.drop(C);l.emit&&l.emit("finished")};var v;l.prepareAheadTime=0.1;l.start=function(a){if(!t&&!G)if(a){var b=Math.max(a,o.currentTime)-o.currentTime;v&&(cancelTimeout(v),v=null);var c=function(a){P=Math.floor(a*o.sampleRate);t=true;v=null;C.connect(S)};b<=l.prepareAheadTime?c(a):v=setTimeout(c,Math.round(1E3*(b-l.prepareAheadTime)),a)}else t=
!0,C.connect(S)};l.stop=function(a){G||(Q=Math.max(P,Math.ceil(a*o.sampleRate)))};0<j&&l.start(0);return l};return s});
