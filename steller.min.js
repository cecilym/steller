var LOG_LEVEL=1;org="undefined"===typeof org?{}:org;org.anclab=org.anclab||{};org.anclab.steller=org.anclab.steller||{};
(function(p,r){function u(a){var b={};a.on=function(a,c){var a=z(a),g=b[a]||(b[a]={}),d=c.__steller_eventable_id__||0;if(d in g)return this;d||Object.defineProperty(c,"__steller_eventable_id__",{value:d=J++,enumerable:!1,configurable:!1,writable:!1});g[d]=c;return this};a.off=function(a,c){var a=z(a),g=b[a];if(!g)return this;var d=c&&c.__steller_eventable_id__||0;d?delete g[d]:c||delete b[a];return this};a.emit=function(a){var a=z(a),c=b[a];if(!c)return this;for(var g in c)try{c[g].apply(this,arguments)}catch(d){1<=
LOG_LEVEL&&console.log("eventable.js[107]:\t","Exception in event watcher - ",d)}return this};return a}function j(a){var b=Object.create(j.prototype);b.spec=a=q(Object.create(a));b.getter=void 0;b.setter=void 0;b.valueOf=void 0;b.audioParam=void 0;b.watchers=[];b._value=void 0;a.audioParam?(b.audioParam=a.audioParam,b.getter=a.getter||j.getters.audioParam,b.setter=a.setter||j.setters.audioParam):a.options?(b.getter=a.getter||j.getters.value,b.setter=a.setter||j.setters.option):(b.getter=a.getter||
j.getters.value,b.setter=a.setter||j.setters.value);b.valueOf=b.getter;"value"in a&&b.setter(a.value);return b}function q(a){if(a.options){var b={};a.options.forEach(function(a,c){b["option:"+a]=c+1});a.limit=function(e){if("number"===typeof e){if(0<=e&&e<a.options.length)return a.options[e];throw Error("Invalid enumeration index");}if(b["option:"+e])return e;throw Error("Invalid enumeration value");}}return a}function n(a,b){var e,c,g=a.watchers;e=0;for(c=g.length;e<c;++e)g[e](b,a);return b}function t(){var a=
0,b=4,e=[null,null,null,null],c=-1,g=0;this.length=0;this.add=function(d){if(a>=b){var h=Array(2*b),f,o,i,l;f=c;o=0;i=a;for(l=b;o<i;++o,f=(f+1)%l)h[o]=e[f];e=h;g=a;c=0===a?-1:0;b*=2}e[g]=d;0>c&&(c=g);g=(g+1)%b;return this.length=a+=1};this.remove=function(){if(0>=a)throw Error("Empty queue");var g=e[c];e[c]=null;c=(c+1)%b;this.length=a-=1;return g};this.clear=function(){this.length=a=0;e.splice(0,e.length,null,null,null,null);b=4;c=-1;g=0};return this}function m(a,b){var e=d();if(h()&&!e)throw Error("PeriodicTimer needs requestAnimationFrame support. Use a sufficiently modern browser.");
var c=this,g=!1,f,b=void 0===b?15:Math.min(Math.max(h()?15:1,b),33);e&&12<=b?(c.start=function(){g||(g=!0,e(function(){g&&(e(arguments.callee),a())}))},c.stop=function(){g=!1}):(c.start=function(){g||(g=!0,f=setInterval(a,1))},c.stop=function(){g&&(g=!1,clearInterval(f),f=void 0)});c.__defineGetter__("running",function(){return g});c.__defineSetter__("running",function(a){a?c.start():c.stop();return g});c.computeAheadInterval_secs=Math.round(3.333*b)/1E3;return c}function k(a){(p.JSNodeTimer_jsnodes||
(p.JSNodeTimer_jsnodes=[])).push(a)}function i(a,b,e,c){this.dt=e;this.t1=a;this.t2=a+e;this.t1r=b;this.t2r=b+c.valueOf()*e;this.rate=c;this.data=null;return this}function f(a){return Math.round(1E3*a)/1E3}function h(){return"object"===typeof p&&"object"===typeof document&&p.document===document}function d(){try{return p.requestAnimationFrame||p.webkitRequestAnimationFrame||p.mozRequestAnimationFrame||p.msRequestAnimationFrame||function(a){setTimeout(a,1E3/60)}}catch(a){}}function s(){try{return p.webkitAudioContext||
p.mozAudioContext}catch(a){}}function o(){try{var a=p.performance,b=a&&(a.now||a.webkitNow||a.mozNow);if(b)return function(){return 0.0010*b.call(a)}}catch(e){}}var z=function(){var a={};return function(b){if(a[b])throw Error("Invalid event name - "+b);return b}}(),J=1;u.observe=function(a,b,e){var e=z(e||b),c=a[b];a[b]=function(){var a=c.apply(this,arguments),b=Array.prototype.slice.call(arguments);b.unshift(e);this.emit.apply(this,b);return a};return a};var L=function(){function a(g,e,c){g.inputs=
e||[];g.outputs=c||[];g.numberOfInputs=g.inputs.length;g.numberOfOutputs=g.outputs.length;g.context=g.inputs[0]&&g.inputs[0].context||g.outputs[0]&&g.outputs[0].context;g.connect=function(a,b,e){var c,a=a||g.context.destination,b=g.outputs[b||0];c=a.inputs?a.inputs[e||0]:a;if("AudioParam"===c.constructor.name||"AudioGain"===c.constructor.name)b.connect(c);else if(c.numberOfInputs===b.numberOfOutputs){a=0;for(e=c.numberOfInputs;a<e;++a)b.connect(c,a,a)}else b.connect(c);return g};g.disconnect=function(){0<
arguments.length?Array.prototype.forEach.call(arguments,function(a){g.outputs[a].disconnect()}):g.outputs.forEach(function(a){a.disconnect()});return g};var d={},h=b(g);g.keep=function(a){var a=a||g,c=b(a);return d[c]=a};g.drop=function(g){g?(g=b(g),delete d[g]):delete a._preservedNodes[h]};a._preservedNodes[h]=d;return g}function b(a){var b=a[c];b||(b=e++,Object.defineProperty(a,c,{value:b,writable:!1,enumerable:!1,configurable:!1}));return b}var e=1,c="#org.anclab.steller.GraphNode.globalid";a._preservedNodes=
{};a.chain=function(b){var c,e;c=0;for(e=b.length-1;c<e;++c)b[c].connect(b[c+1]);return a};return a}();j.getters={value:function(){return this._value},audioParam:function(){return this.audioParam.value}};j.setters={value:function(a){return this._value=a},audioParam:function(a){return this.audioParam.value=a},option:function(a){return this._value=this.spec.limit(a)}};j.mappings={};j.mappings.linear={fromNorm:function(a,b){return a.spec.min+b*(a.spec.max-a.spec.min)},toNorm:function(a){return(a.value-
a.spec.min)/(a.spec.max-a.spec.min)}};j.mappings.log={fromNorm:function(a,b){var e=a.spec,c=Math.log(e.min),e=Math.log(e.max);return Math.exp(c+b*(e-c))},toNorm:function(a){var b=a.spec,e=Math.log(b.min),b=Math.log(b.max);return(Math.log(a.value)-e)/(b-e)}};j.names=function(a){return Object.keys(a).filter(function(b){return a[b]instanceof j})};j.expose=function(a,b,e){e||(e=j.names(a));e.forEach(function(c){b[c]=a[c]});return j};j.bind=function(a,b,e){a instanceof j?a.bind(b,e):"value"in a?e?e.update(function(){b.value=
a.value}):b.value=a.value:e?e.update(function(){b.value=a}):b.value=a;return j};j.prototype.__defineGetter__("value",function(){return this.getter()});j.prototype.__defineSetter__("value",function(a){return a!==this.getter()?n(this,this.setter(a)):a});j.prototype.watch=function(a){var b,e,c=this.watchers;b=0;for(e=c.length;b<e;++b)if(c[b]===a)return this;c.push(a);return this};j.prototype.unwatch=function(a){var b=this.watchers;if(1>arguments.length||!a)return b.splice(0,b.length),this;for(var e=
b.length-1;0<=e;--e)if(b[e]===a){b.splice(e,1);break}return this};j.prototype.changed=function(){n(this,this.getter());return this};j.prototype.alias=function(a,b){var e=this,c=Object.create(e);c.spec=Object.create(e.spec);c.spec.name=a;b&&(c.spec.label=b);c.getter=function(){return e.getter()};c.setter=function(a){return e.setter(a)};c.alias=function(a,b){return e.alias(a,b)};return c};j.prototype.bind=function(a,b){var e=this;if(a.addEventListener){var c=e.spec,g=c.mapping?j.mappings[c.mapping]:
j.mappings.linear,d,h,f;if("checkbox"===a.type)d=function(){e.value=a.checked?1:0},h=b?function(){b.update(d)}:d,f=function(b){a.checked=b?!0:!1};else if("range"===a.type)d=function(){e.value=g.fromNorm(e,parseFloat(a.value))},h=b?function(){b.update(d)}:d,f=function(){a.value=g.toNorm(e)};else throw Error("org.anclab.steller.Param.bind: Unsupported control type - "+a.type);f.elem=a;f.unbind=function(){a.removeEventListener(h);e.unwatch(f)};a.addEventListener("change",h);e.watch(f);f(e.value)}else if("string"===
typeof a){var c=document.querySelectorAll(a),o,i;o=0;for(i=c.length;o<i;++o)this.bind(c[o])}else{var l=function(b){a.value=b};l.elem=a;l.unbind=function(){e.unwatch(l)};e.watch(l);a.value=e.value}return this};j.prototype.unbind=function(a){if("string"===typeof a){var a=document.querySelectorAll(a),b,e;b=0;for(e=a.length;b<e;++b)this.unbind(a[b])}else{var c=this.watchers;b=0;for(e=c.length;b<e;++b)if(c[b].elem===a){c[b].unbind();break}}return this};i.prototype.toString=function(){return JSON.stringify([this.t1r,
this.t2r-this.t1r,this.t1,this.t2-this.t1].map(f))};i.prototype.copy=function(){var a=new i(this.t1,this.t1r,this.dt,this.rate);this.data&&(a.data=Object.create(this.data));return a};i.prototype.advance=function(a){this.t1+=a;this.t2+=a;return this};i.prototype.advanceTo=function(a){return this.advance(a-this.t1)};i.prototype.tick=function(){this.t1=this.t2;this.t2+=this.dt;this.t1r=this.t2r;this.t2r+=this.dt*this.rate.valueOf();return this};i.prototype.jumpTo=function(a){var a=a-this.t1,b=a*this.rate.valueOf();
this.t1+=a;this.t2+=a;this.t1r+=b;this.t2r+=b;return this};i.prototype.syncWith=function(a){this.t1=a.t1;this.t2=this.t1+this.dt;this.t1r=a.t1r;this.t2r=this.t1r+this.rate.valueOf()*this.dt;return this};i.prototype.nudgeToRel=function(a){a=Math.max(this.t1r,a);this.t2r>this.t1r&&(this.t1+=(a-this.t1r)*(this.t2-this.t1)/(this.t2r-this.t1r));this.t1r=a;return this};i.prototype.rel2abs=function(a){return this.t1+(a-this.t1r)/this.rate.valueOf()};i.prototype.abs2rel=function(a){return this.t1r+(a-this.t1)*
this.rate.valueOf()};var w=function(a){function b(a){var b=Math.pow(10,4-Math.min(3,(""+(a-a%1)).length));return Math.round(a*b)/b}function e(a){return function(b){a.insertAdjacentElement("beforeend",b)}}a.basicUI=function(a,g,d){if(g.ui)return g.ui;var h=a.createElement("div");d&&h.insertAdjacentHTML("beforeend","<p><b>"+d+"</b></p>");j.names(g).map(function(a){var b=Object.create(g[a].spec);b.name=b.name||a;b.param=g[a];return b}).forEach(function(g){var d=g.name,f=g.param;if("min"in g&&"max"in
g){var o=a.createElement("div"),i=a.createElement("span"),n=a.createElement("span");i.innerText=(g.label||d)+": ";i.style.width="100px";i.style.display="inline-block";i.style.textAlign="left";var m=a.createElement("input");m.type="range";m.min=0;m.max=1;m.step=0.0010;var s="string"===typeof g.mapping?j.mappings[g.mapping]:g.mapping||j.mappings.linear,k=g.units?" "+g.units:"";m.value=s.toNorm(f);n.innerText=" ("+b(f.value)+k+")";m.changeModelParameter=function(){f.value=s.fromNorm(f,parseFloat(this.value))};
m.changeSliderValue=function(a){m.value=s.toNorm(f);n.innerText=" ("+b(a)+k+")"};m.addEventListener("change",m.changeModelParameter);f.watch(m.changeSliderValue);[i,m,n].forEach(e(o));h.insertAdjacentElement("beforeend",o)}});return g.ui=h};return a}({});r.Eventable=u;r.AsyncEventable=function(a){var a=u(a),b=a.on;a.on=function(e,c){if(!c)return this;var g=c.__steller_async_eventable__;g||Object.defineProperty(c,"__steller_async_eventable__",{value:g=function(){var b=arguments;setTimeout(function(){c.apply(a,
b)},0)},enumerable:!1,configurable:!1,writable:!1});b(e,g)};return a};r.GraphNode=L;r.SoundModel=function(a,b,e){a=u(L(a,b,e));u.observe(a,"connect");u.observe(a,"disconnect");return a};r.Param=j;r.Scheduler=function(a,b){function e(a,b){a&&(A.add(a),A.add(b))}function c(a){a(l,v.copy(),g)}function g(){}function f(a,b,e){e&&e(a,b,g)}function n(a,b){return function(e,c,d){function h(e,c){var y=o+a.valueOf();0<B&&c.t1<v.t1&&c.advance(B);c.t1>F?f&&C.add(f):c.t2r<y?(b&&b(c,c.t1r,c.t2r,o,y),c.tick(),f&&
C.add(f)):(b&&y>=c.t1r&&b(c,c.t1r,y,o,y),c.t2r>c.t1r?d(e,c.nudgeToRel(y),g):d(e,c,g))}function f(a){h(a,c,g)}var o=c.t1r;h(e,c)}}function k(a){return function(b,c,g){a(c)(b,c,g)}}function z(a){function b(a,e,d){var f,h,E;if(0<c.length){E=c;c=[];f=0;for(h=E.length;f<h;++f)E[f](a,e.copy(),g)}d(a,e,g)}if(0<arguments.length)return function(a,b,c){for(;a<b;++a)c.push(z());return c}(0,a,[]);var c=[];b.play=function(a){c.push(a);return this};b.cancel=function(){c.splice(0,c.length);return this};return b}
function J(a){function b(a,e,f){d?f(a,e,g):c.push({sched:a,next:f,clock:e})}if(0<arguments.length)return function(a,b,c){for(;a<b;++a)c.push(J());return c}(0,a,[]);var c=[],e=[],d=!0;b.__defineGetter__("isOpen",function(){return d});b.__defineSetter__("isOpen",function(a){a?b.open():b.close();return a});b.open=function(a,b,e){d=!0;var f=c,h,E,o,i=D();c=[];h=0;for(E=f.length;h<E;++h)o=f[h],o.next(o.sched,b?b.copy():o.clock.advanceTo(i),g);e&&e(a,b,g)};b.close=function(a,b,c){d=!1;c&&c(a,b,g)};b.toggle=
function(a,c,e){return d?b.close(a,c,e):b.open(a,c,e)};b.cancel=function(a,b,e){c.splice(0,c.length);e&&e(a,b,g)};b.push=function(a,b,f){e.push({isOpen:d,cache:c});c=[];f&&f(a,b,g)};b.pop=function(a,b,d){var f=e.pop();c.push.apply(c,f.cache);this.isOpen=f.isOpen;d&&d(a,b,g)};return b}var l=this===p?{}:this,L=d(),r=s();if(h()&&!L)throw Error("Scheduler needs requestAnimationFrame support. Use a sufficiently modern browser version.");var M=0.0010,D=function(){if(a){if(a instanceof r)return M=1/a.sampleRate,
a.createGainNode(),function(){return a.currentTime};throw Error("Scheduler: Argument is not an audio context");}return o()||function(){return 0.0010*Date.now()}}(),w,q=!1;l.__defineGetter__("running",function(){return q});l.__defineSetter__("running",function(a){a?q||(q=!0,v.advanceTo(D()),w.start()):(q=!1,w.stop())});l.frame_rate=j({min:15,max:75,value:60});var C=new t("tick"),A=new t("frames"),u=new t("update");w=new m(function(){var a,b,c,e,g;a=!0;b=D();W(b);for(F=b+G;b-v.t1>T;)B=b-v.t1,v.advance(B);
for(;a||v.t1<F;){if(0<u.length){c=u.length;for(a=0;a<c;++a)u.remove()()}c=C.length;for(a=0;a<c;++a)C.remove()(l,v,f);v.t1<F&&v.tick();B=0;a=!1}if(0<A.length){c=A.length;for(a=0;a<c;a+=2)e=A.remove(),g=A.remove(),e(b,g)}if(l.ontick)l.ontick(b)},0,a);var I=1/60,N=I,G=w.computeAheadInterval_secs||0.05,T=5*G,v=new i(D(),0,G,1),F=v.t1,B=0,W=function(){var a=1/60,b=v.t1,c=15;return function(e){var g=e-b;0.01<g&&0.07>g&&(N=I=a+=0.05*(g-a),G=3.33*I,T=5*G,0>=c--&&(l.frame_rate.value=Math.round(1/I),c=15));
b=e}}(),U=function(){return a?function V(b){0===a.currentTime?setTimeout(V,100,b):(v=new i(D(),0,G,1),F=v.t1,l.play=U=c,c(b))}:c}(),O;b&&b.diagnostics?(4<=LOG_LEVEL&&console.log("scheduler.js[630]:\t","fire: diagnostics on"),O=function(a){return function(b,c,e){D();a(c);e(b,c,g)}}):O=function(a){return function(b,c,e){a(c);e(b,c,g)}};l.audioContext=a;l.update=function(a){a&&u.add(a)};l.perform=function(a,b,c){a(l,b,c)};l.cancel=function(){u.clear();C.clear();A.clear()};l.play=U;l.stop=g;l.cont=f;
l.delay=n;l.loop=function(a){return function y(b,c){a(b,c,y)}};l.loop_while=function(a,b){return function(c,e,d){function f(){a.valueOf()?b(c,e,f):d(c,e,g)}f()}};l.repeat=function(a,b){return function(c,e,d){function f(){if(h<a){h++;b(c,e,f)}else d(c,e,g)}var h=0;f()}};l.fork=function(a){a=a&&a.constructor===Function?Array.prototype.slice.call(arguments,0):a.slice(0);return function(b,c,e){function d(b,h){f++;f===a.length&&e(b,c.syncWith(h),g)}var f=0;a.forEach(function(a){a(b,c.copy(),d)})}};l.spawn=
function(a){a=a&&a.constructor===Function?Array.prototype.slice.call(arguments,0):a.slice(0);return function(b,c,e){a.forEach(function(a){a(b,c.copy(),g)});e(b,c,g)}};l.dynamic=k;l.track=function(a){function b(c,e,d,f,h){function o(b,c){if(i<l)a[i++](b,c,o);else d(b,c,g)}var i=0,l=a.length;if(arguments.length>3){i=f;l=h}o(c,e,d)}a&&a.constructor===Function&&(a=Array.prototype.slice.call(arguments,0));b.minIndex=0;b.maxIndex=a.length;b.models=a;return b};l.slice=function(a,b,c){c=arguments.length>
2?c:a.maxIndex;b=arguments.length>1?Math.max(a.minIndex,Math.min(b,c)):a.minIndex;return function(e,g,d){a(e,g,d,b,c)}};l.fire=O;l.display=function(a){return function(b,c,d){function f(b){b+N>h?a(c,h,b):e(f)}var h=c.t1;e(f);d(b,c,g)}};l.frame=function(a){return function(b,c,d){function f(o){if(o+N>h){c.jumpTo(o);a(c);d(b,c,g)}else e(f)}var h=c.t1;e(f)}};l.frames=function(a,b){return function(c,d,f){function h(b,c){var e,d=i+a.valueOf();if(B>0&&c.t1<v.t1){c.advance(B);if(k){m=m+void 0;k.intervals.length>
4&&k.intervals.splice(0,k.intervals.length-4);if(k.intervals.length>0){k.intervals[0]=k.intervals[0]+void 0;k.intervals[3]=c.rate.valueOf()}}}if(c.t1>F)o&&C.add(o);else{if(k&&c.t1r<=d){k.endTime=d;var n=c.rate.valueOf();for(e=Math.max(0.0010,I*n);l<c.t2r;){k.intervals.push(m);k.intervals.push(l);k.intervals.push(l+e);k.intervals.push(n);l=l+e}}if(c.t2r<d){c.tick();o&&C.add(o)}else{k.end=true;c.t2r>c.t1r?f(b,c.nudgeToRel(d),g):f(b,c,g)}}}function o(a){h(a,d,g)}var i=d.t1r,l=i,m=d.t1,n,k;if(b){n=function(a,
c){if(c.intervals.length>0){var g=c.intervals[0],d=c.intervals[1],f=c.intervals[2],h=c.intervals[3];if(d<=c.endTime){if(g<N+a){b(c.clock,d,f,c.startTime,c.endTime,h);c.intervals.splice(0,4)}e(n,c);return}}c.end||e(n,c)};k={clock:d,intervals:[],startTime:d.t1r,endTime:d.t1r+a.valueOf(),end:false};e(n,k)}h(c,d)}};l.log=function(a){return O(function(){console.log(a)})};l.anim=function(a,b){var c,e,g,d;switch(arguments.length){case 3:d=arguments[2];break;case 4:c=arguments[2];e=arguments[3];d=function(a){return(1-
a)*c.valueOf()+a*e.valueOf()};break;case 5:c=arguments[2];e=arguments[3];g=arguments[4];d=function(a){a=g(a);return(1-a)*c.valueOf()+a*e.valueOf()};break;default:throw Error("Invalid arguments to anim()");}return a.constructor.name==="AudioGain"||a.constructor.name==="AudioParam"?n(b,function(b,c,e,g,f){var f=f-g,h;if(c<=g){h=f>M?(c-g)/f:0;a.setValueAtTime(d(h),b.rel2abs(c))}a.linearRampToValueAtTime(d(f>M?(e-g)/f:1),b.rel2abs(e))}):n(b,function(b,c,e,g,f){b=f-g-(e-c);a.value=b>M?d((c-g)/b):d(1)})};
l.rate=function(a){return function(b,c,e){c.rate=a;e(b,c,g)}};l.choice=function(a){return k(function(){return a[Math.floor(Math.random()*a.length)]})};l.sync=z;l.gate=J;l.stats=function(){return{frame_jitter_ms:0}};l.running=b&&"running"in b&&b.running||!0;org.anclab.steller.Models&&(l.models=org.anclab.steller.Models(l));return l};r.Clock=i;r.PeriodicTimer=m;r.JSNodeTimer=function(a,b,e){if(e){var c=e.createJavaScriptNode(1024);c.onaudioprocess=function(){a()};var g=this,d=!1;k(c);g.start=function(){d||
(d=!0,c.connect(e.destination))};g.stop=function(){d&&(c.disconnect(),d=!1)};g.__defineGetter__("running",function(){return d});g.__defineSetter__("running",function(a){a?g.start():g.stop();return d});g.computeAheadInterval_secs=Math.round(2560)/e.sampleRate;return g}return m.call(this,a,b)};r.UI=w;r.Util={p2f:function(a){return 440*Math.pow(2,(a.valueOf()-69)/12)},f2p:function(a){a=69+12*Math.log(a.valueOf()/440)/Math.LN2;return Math.round(100*a)/100},augment:function(a,b){var e=org.anclab.steller;
if(a in e)e[a].augmentors.push(b);else{var c=function(){var a=Array.prototype.slice.call(arguments,0),b={};c.augmentors.forEach(function(c){b=c.apply(b,a)||b});return b};c.augmentors=[b];e[a]=c}return e[a]}};r.requestAnimationFrame=function(a){return function(b){return a(b)}}(d());r.AudioContext=s()})(function(){return"undefined"===typeof window?void 0:window}(),org.anclab.steller);
org.anclab.steller.Util.augment("Models",function(p){var r=org.anclab.steller,u=org.anclab.steller.Util,j=r.SoundModel,q=r.Param,n=p.audioContext,t=this;t.chime=function(){var m=n.createGainNode(),k=j({},[],[m]);k.halfLife=q({min:0.0010,max:10,value:0.5,mapping:"log"});k.attackTime=q({min:0,max:1,value:0.01});k.level=q({min:0.125,max:4,audioParam:m.gain,mapping:"log"});k.play=function(i,f){void 0===f&&(f=1);return p.fire(function(h){var d=u.p2f(i.valueOf()),s=n.createOscillator();s.type=s.SINE;s.frequency.value=
d;var o=n.createGainNode();o.gain.value=0;o.gain.setValueAtTime(0,h.t1);o.gain.linearRampToValueAtTime(f.valueOf()/8,h.t1+k.attackTime.value);var d=440*k.halfLife.value/d,j=10*d;o.gain.setTargetValueAtTime(0,h.t1+k.attackTime.value,d);s.connect(o);o.connect(m);s.noteOn(h.t1);s.stop(h.t1+j)})};return k};t.dc=function(){var m,k,i;i=n.createBuffer(1,1024,n.sampleRate);k=i.getChannelData(0);for(m=0;1024>m;++m)k[m]=1;return function(f){var h=n.createBufferSource();h.buffer=i;h.loop=!0;h.noteOn(0);var d=
n.createGainNode();d.gain.value=f;h.connect(d);f=j({},[],[d]);f.level=q({min:-1,max:1,audioParam:d.gain});f.stop=function(d){h.stop(d)};return f}}();t.noise=function(){var m=n.createBuffer(1,5*n.sampleRate,n.sampleRate),k,i,f=m.getChannelData(0);k=0;for(i=f.length;k<i;++k)f[k]=2*Math.random()-1;return function(){var f=n.createBufferSource();f.buffer=m;f.loop=!0;f.gain.value=1;var d=n.createGainNode();d.gain.value=1;f.connect(d);f.noteOn(0);var i=t.dc(0);i.connect(d);d=j({},[],[d]);d.spread=q({min:0.01,
max:10,audioParam:f.gain});d.mean=i.level;return d}}();t.probe=function(){var m=q({min:-1,max:1,value:0}),k=q({min:-1,max:1,value:1}),i=q({min:0,max:1,value:0}),f=n.createJavaScriptNode(512,1,1),h=0,d=0,s=1-Math.exp(Math.log(0.5)/1024);f.onaudioprocess=function(f){for(var f=f.inputBuffer.getChannelData(0),n=f.length,j=0,p=0,j=0;j<n;++j)p=f[j],h+=s*(p-h),d+=s*(p*p-d);m.value=h;i.value=d;k.value=Math.sqrt(Math.max(0,d-h*h))};f.connect(n.destination);f=j({},[f],[]);f.mean=m;f.sigma=k;f.energy=i;return f};
t.mic=function(){function m(f,h,d){try{navigator.webkitGetUserMedia(f,h,d)}catch(i){d(i)}}function k(f,h){i||(i=n.createMediaStreamSource(h));i.connect(f.outputs[0]);f.error=null;f.ready.value=1}var i;return function(){var f=n.createGainNode(),h=j({},[],[f]);h.ready=q({min:-1,max:1,value:0});h.gain=q({min:0,max:1,audioParam:f.gain});i?k(h,null):m({audio:!0},function(d){return k(h,d)},function(d){h.error=d;h.gain.value=0;h.ready.value=-1});return h}}();t.spectrum=function(m,k){function i(){if(s){var d=
n.currentTime;f.getFloatFrequencyData(h.bins);for(var k=0,m=h.bins,j=m.length;k<j;++k)m[k]=Math.pow(10,m[k]/20);s=r.requestAnimationFrame(i);h.time.value=d}}var m=m||1024,f=n.createAnalyser();f.fftSize=2*m;f.frequencyBinCount=m;f.smoothingTimeConstant=2>arguments.length?0.1:k;var h=j({},[f],[]);h.bins=new Float32Array(m);h.freqs=new Float32Array(m);h.time=q({min:0,max:1E9,value:0});for(var d=0;d<m;++d)h.freqs[d]=d*n.sampleRate/f.fftSize;var s;h.start=p.fire(function(){s||(s=r.requestAnimationFrame(i))});
h.stop=p.fire(function(){s=void 0});return h};(function(){var m={};t.load_sample=function(k,i,f){var h="sound:"+k,d=m[h];if(d)return i&&i(d),d;if(i){var j=new XMLHttpRequest;j.open("GET",k,!0);j.responseType="arraybuffer";j.onerror=function(d){f&&f(d,k)};j.onload=function(){n.decodeAudioData(j.response,function(d){i(m[h]=d);0<=LOG_LEVEL&&console.log("models/sample.js[31]:\t","Sound ["+k+"] loaded!")},function(d){f&&f(d,k)})};j.send()}};t.load_sample.clearCache=function(){m={}};t.sample=function(k,
i){function f(f,i,k,j,p){var a=n.createBufferSource();a.buffer=m;a.connect(h);a.playbackRate.value=i;a.gain.setValueAtTime(0,f.t1);a.gain.setTargetValueAtTime(k,f.t1,d.attackTime.value/3);3<arguments.length?a.noteGrainOn(f.t1,j,4<arguments.length?p:a.duration):a.noteOn(f.t1);return a}var h=n.createGainNode();h.gain.value=0.25;var d=j({},[],[h]);d.level=q({min:0.0010,max:10,audioParam:h.gain,mapping:"log"});d.attackTime=q({min:0.0010,max:10,value:0.02,mapping:"log"});d.releaseTime=q({min:0.0010,max:10,
value:0.1,mapping:"log"});var m;d.load=function(f,h,j){if(m)f.perform(j,h,f.stop);else{var p=h.t1-n.currentTime;t.load_sample(k,function(i){m=i;d.duration=m.duration;f.perform(j,h.jumpTo(n.currentTime+p),f.stop)},i)}};d.trigger=function(d,h){h=h||0;return p.fire(function(i){var k=Math.pow(2,h.valueOf()/12);f(i,k,d.valueOf())})};d.play=p.track([d.load,p.dynamic(function(h){var i=f(h,h.rate.valueOf(),1);return p.delay(d.duration,function(d){i.playbackRate.value=d.rate.valueOf()})})]);d.note=function(h,
i,k,m){4>arguments.length&&(m=k);return p.dynamic(function(j){var a=f(j,h.valueOf(),1,i,k);a.gain.value=0;a.gain.setTargetValueAtTime(1,j.t1,d.attackTime.value/3);a.playbackRate.setTargetValueAtTime(h.valueOf(),j.t1,j.dt/3);return p.track([p.spawn(p.track([p.delay(m),p.fire(function(b){a.gain.setTargetValueAtTime(0,b.t1,d.releaseTime.value/3);a.stop(b.t1+12*d.releaseTime.value)})])),p.delay(k,function(b){a.playbackRate.exponentialRampToValueAtTime(h.valueOf(),b.t1)})])})};return d};t.sample.clearCache=
t.load_sample.clearCache})();t.jsnode=function(m){var k=m.numberOfInputs||0,i=k+(m.audioParams?m.audioParams.length:0),f=m.numberOfOutputs||1,h=0<i?n.createChannelMerger(i):void 0,d=0<f?n.createChannelSplitter(f):void 0,p=[],o,q,r;o=0;for(q=i;o<q;++o)r=n.createGainNode(),p.push(r),r.connect(h,0,o);var u=[];o=0;for(q=f;o<q;++o)r=n.createGainNode(),u.push(r),d&&d.connect(r,o);var w;w=m.audioParams?Object.keys(m.audioParams):[];var a={},b=[],e=[];a.inputs=b;a.outputs=e;o=0;for(q=w.length;o<q;++o)a[w[o]]=
null;a.playbackTime=n.currentTime;var c=!1,g=!1,P=0,Q=Infinity,R,x=j({},p,u),K=0<w.length?t.dc(1):void 0;w.forEach(function(a,b){var c=p[k+b];x[a]=c.gain;c.gain.value=m.audioParams[a];K.connect(c)});var l=x.keep(n.createScriptProcessor(m.bufferLength||512,i,Math.min(1,f)));h&&h.connect(l);l.onaudioprocess=function(c){var d,h,i,j,l;d=0;if(!g){var o=c.outputBuffer.length;i=Math.floor(n.currentTime*n.sampleRate);j=Math.max(i,P);l=i+o;var p=j-i;i=l-i;if(l>j){d=0;for(h=k;d<h;++d)b[d]=c.inputBuffer.getChannelData(d).subarray(p,
i);d=0;for(h=f;d<h;++d)e[d]=c.outputBuffer.getChannelData(d).subarray(p,i);d=0;for(h=w.length;d<h;++d)a[w[d]]=c.inputBuffer.getChannelData(k+d).subarray(p,i);a.playbackTime=(c.playbackTime||n.currentTime)+p/n.sampleRate;a.samplesToStop=Q-j;d=m.onaudioprocess.call(x,a);void 0===d&&(d=l-j)}j+d<l&&(1<=LOG_LEVEL&&console.log("models/jsnode.js[168]:\t","Finished",l,Q),g=!0,setTimeout(R,Math.round(1E3*o/n.sampleRate)))}};var S=d||n.destination;R=function(){g=!0;l.disconnect();d&&d.disconnect();K&&(K.stop(0),
K.disconnect());h&&h.disconnect();x.drop(l);x.emit&&x.emit("finished")};var H;x.prepareAheadTime=0.1;x.start=function(a){if(!c&&!g)if(a){var b=Math.max(a,n.currentTime)-n.currentTime;H&&(cancelTimeout(H),H=null);var d=function(a){P=Math.floor(a*n.sampleRate);c=true;H=null;l.connect(S)};b<=x.prepareAheadTime?d(a):H=setTimeout(d,Math.round(1E3*(b-x.prepareAheadTime)),a)}else c=!0,l.connect(S)};x.stop=function(a){g||(Q=Math.max(P,Math.ceil(a*n.sampleRate)))};0<k&&x.start(0);return x};return t});
