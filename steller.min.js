var LOG_LEVEL=4;org="undefined"===typeof org?{}:org;org.anclab=org.anclab||{};org.anclab.steller=org.anclab.steller||{};
(function(p,r){function v(a){var b={};if("on"in a){console.error("eventable.js[99]:\tASSERT failed (!('on' in obj)) ");debugger}if("off"in a){console.error("eventable.js[100]:\tASSERT failed (!('off' in obj)) ");debugger}if("emit"in a){console.error("eventable.js[101]:\tASSERT failed (!('emit' in obj)) ");debugger}a.on=function(a,d){var f,g;if(2<arguments.length){f=1;for(g=arguments.length;f<g;++f)this.on(a,arguments[f]);return this}var e=b[a]||(b[a]=[]);f=0;for(g=e.length;f<g;++f)if(e[f]===d)return this;
e.push(d);return this};a.off=function(a,d){var f,g;if(2<arguments.length){f=1;for(g=arguments.length;f<g;++f)this.off(a,arguments[f]);return this}var e=b[a];if(!e)return this;if(d){f=0;for(g=e.length;f<g;++f)if(e[f]===d)return e.splice(f,1),this;console.warning("eventable.js[68]:\tWARNING!\ttrue");return this}delete b[a];return this};a.emit=function(a){var d=b[a];if(!d)return this;var f,g;f=0;for(g=d.length;f<g;++f)try{d[f].apply(this,arguments)}catch(e){1<=LOG_LEVEL&&console.log("eventable.js[92]:\t",
"Exception in event watcher - ",e)}return this};return a}function l(a){var b=Object.create(l.prototype);b.spec=a=s(Object.create(a));b.getter=void 0;b.setter=void 0;b.valueOf=void 0;b.audioParam=void 0;b.watchers=[];b._value=void 0;a.audioParam?(b.audioParam=a.audioParam,b.getter=a.getter||l.getters.audioParam,b.setter=a.setter||l.setters.audioParam):a.options?(b.getter=a.getter||l.getters.value,b.setter=a.setter||l.setters.option):(b.getter=a.getter||l.getters.value,b.setter=a.setter||l.setters.value);
b.valueOf=b.getter;"value"in a&&b.setter(a.value);return b}function s(a){if(a.options){var b={};a.options.forEach(function(a,d){b["option:"+a]=d+1});a.limit=function(c){if("number"===typeof c){if(0<=c&&c<a.options.length)return a.options[c];throw Error("Invalid enumeration index");}if(b["option:"+c])return c;throw Error("Invalid enumeration value");}}return a}function m(a,b){var c,d,f=a.watchers;c=0;for(d=f.length;c<d;++c)f[c](b,a);return b}function t(){var a=0,b=4,c=[null,null,null,null],d=-1,f=
0;this.length=0;this.add=function(g){if(a>=b){var e=Array(2*b),h,n,k,o;h=d;n=0;k=a;for(o=b;n<k;++n,h=(h+1)%o)e[n]=c[h];c=e;f=a;d=0===a?-1:0;b*=2}c[f]=g;0>d&&(d=f);f=(f+1)%b;return this.length=a+=1};this.remove=function(){if(0>=a)throw Error("Empty queue");var f=c[d];c[d]=null;d=(d+1)%b;this.length=a-=1;return f};this.clear=function(){this.length=a=0;c.splice(0,c.length,null,null,null,null);b=4;d=-1;f=0};return this}function j(a,b){var c=e();if(g()&&!c)throw Error("PeriodicTimer needs requestAnimationFrame support. Use a sufficiently modern browser.");
var d=this,f=!1,h,b=void 0===b?15:Math.min(Math.max(g()?15:1,b),33);c&&12<=b?(d.start=function(){f||(f=!0,c(function(){f&&(c(arguments.callee),a())}))},d.stop=function(){f=!1}):(d.start=function(){f||(f=!0,h=setInterval(a,1))},d.stop=function(){f&&(f=!1,clearInterval(h),h=void 0)});d.__defineGetter__("running",function(){return f});d.__defineSetter__("running",function(a){a?d.start():d.stop();return f});5>=b&&console.warning("periodictimer.js[93]:\tWARNING!\tprecision_ms <= 5");d.computeAheadInterval_secs=
Math.round(3.333*b)/1E3;return d}function i(a){(p.JSNodeTimer_jsnodes||(p.JSNodeTimer_jsnodes=[])).push(a)}function k(a,b,c,d){this.dt=c;this.t1=a;this.t2=a+c;this.t1r=b;this.t2r=b+d.valueOf()*c;this.rate=d;this.data=null;return this}function h(a){return Math.round(1E3*a)/1E3}function g(){return"object"===typeof p&&"object"===typeof document&&p.document===document}function e(){try{return p.requestAnimationFrame||p.webkitRequestAnimationFrame||p.mozRequestAnimationFrame||p.msRequestAnimationFrame||
function(a){setTimeout(a,1E3/60)}}catch(a){}}function q(){try{return p.webkitAudioContext||p.mozAudioContext}catch(a){}}function n(){try{var a=p.performance,b=a&&(a.now||a.webkitNow||a.mozNow);if(b)return function(){return 0.0010*b.call(a)}}catch(c){}}v.observe=function(a,b,c){if(!a.emit){debugger;throw Error("eventable.js[113]:\tobj.emit");}var c=c||b,d=a[b];if("function"!==typeof d){debugger;throw Error("eventable.js[118]:\ttypeof(method) === 'function'");}a[b]=function(){var a=d.apply(this,arguments),
b=Array.prototype.slice.call(arguments);b.unshift(c);this.emit.apply(this,b);return a};return a};var I=function(){function a(f,c,d){f.inputs=c||[];f.outputs=d||[];f.numberOfInputs=f.inputs.length;f.numberOfOutputs=f.outputs.length;if(!(0<f.numberOfInputs+f.numberOfOutputs)){console.error("graphnode.js[37]:\tASSERT failed (node.numberOfInputs + node.numberOfOutputs > 0) ");debugger}f.context=f.inputs[0]&&f.inputs[0].context||f.outputs[0]&&f.outputs[0].context;if(!f.context){console.error("graphnode.js[41]:\tASSERT failed (node.context) ");
debugger}f.connect=function(a,b,c){var d,a=a||f.context.destination,b=f.outputs[b||0];d=a.inputs?a.inputs[c||0]:a;if("AudioParam"===d.constructor.name||"AudioGain"===d.constructor.name)b.connect(d);else if(d.numberOfInputs===b.numberOfOutputs){a=0;for(c=d.numberOfInputs;a<c;++a)b.connect(d,a,a)}else b.connect(d);return f};f.disconnect=function(){0<arguments.length?Array.prototype.forEach.call(arguments,function(a){f.outputs[a].disconnect()}):f.outputs.forEach(function(a){a.disconnect()});return f};
var g={},e=b(f);f.keep=function(a){var a=a||f,c=b(a);return g[c]=a};f.drop=function(f){f?(f=b(f),delete g[f]):delete a._preservedNodes[e]};a._preservedNodes[e]=g;return f}function b(a){var b=a[d];b||(b=c++,Object.defineProperty(a,d,{value:b,writable:!1,enumerable:!1,configurable:!1}));return b}var c=1,d="#org.anclab.steller.GraphNode.globalid";a._preservedNodes={};a.chain=function(b){var c,d;c=0;for(d=b.length-1;c<d;++c)b[c].connect(b[c+1]);return a};return a}();l.getters={value:function(){return this._value},
audioParam:function(){return this.audioParam.value}};l.setters={value:function(a){return this._value=a},audioParam:function(a){return this.audioParam.value=a},option:function(a){return this._value=this.spec.limit(a)}};l.mappings={};l.mappings.linear={fromNorm:function(a,b){return a.spec.min+b*(a.spec.max-a.spec.min)},toNorm:function(a){return(a.value-a.spec.min)/(a.spec.max-a.spec.min)}};l.mappings.log={fromNorm:function(a,b){var c=a.spec,d=Math.log(c.min),c=Math.log(c.max);return Math.exp(d+b*(c-
d))},toNorm:function(a){var b=a.spec,c=Math.log(b.min),b=Math.log(b.max);return(Math.log(a.value)-c)/(b-c)}};l.names=function(a){return Object.keys(a).filter(function(b){return a[b]instanceof l})};l.expose=function(a,b,c){c||(c=l.names(a));c.forEach(function(c){c in b&&console.warning("param.js[150]:\tWARNING!\tn in obj2");b[c]=a[c]});return l};l.bind=function(a,b,c){a instanceof l?a.bind(b,c):"value"in a?c?c.update(function(){b.value=a.value}):b.value=a.value:c?c.update(function(){b.value=a}):b.value=
a;return l};l.prototype.__defineGetter__("value",function(){return this.getter()});l.prototype.__defineSetter__("value",function(a){return a!==this.getter()?m(this,this.setter(a)):a});l.prototype.watch=function(a){var b,c,d=this.watchers;b=0;for(c=d.length;b<c;++b)if(d[b]===a)return this;d.push(a);return this};l.prototype.unwatch=function(a){var b=this.watchers;if(1>arguments.length||!a)return b.splice(0,b.length),this;for(var c=b.length-1;0<=c;--c)if(b[c]===a){b.splice(c,1);break}return this};l.prototype.changed=
function(){m(this,this.getter());return this};l.prototype.alias=function(a,b){if(!a){console.error("param.js[266]:\tASSERT failed (name) ","Param.alias call needs name as first argument.");debugger}var c=this,d=Object.create(c);d.spec=Object.create(c.spec);d.spec.name=a;b&&(d.spec.label=b);d.getter=function(){return c.getter()};d.setter=function(a){return c.setter(a)};d.alias=function(a,b){return c.alias(a,b)};return d};l.prototype.bind=function(a,b){var c=this;if(a.addEventListener){var d=c.spec,
f=d.mapping?l.mappings[d.mapping]:l.mappings.linear,g,e,h;if("checkbox"===a.type)g=function(){c.value=a.checked?1:0},e=b?function(){b.update(g)}:g,h=function(b){a.checked=b?!0:!1};else if("range"===a.type)g=function(){c.value=f.fromNorm(c,parseFloat(a.value))},e=b?function(){b.update(g)}:g,h=function(){a.value=f.toNorm(c)};else throw Error("org.anclab.steller.Param.bind: Unsupported control type - "+a.type);h.elem=a;h.unbind=function(){a.removeEventListener(e);c.unwatch(h)};a.addEventListener("change",
e);c.watch(h);h(c.value)}else if("string"===typeof a){var d=document.querySelectorAll(a),n,k;n=0;for(k=d.length;n<k;++n)this.bind(d[n])}else{var o=function(b){a.value=b};o.elem=a;o.unbind=function(){c.unwatch(o)};c.watch(o);a.value=c.value}return this};l.prototype.unbind=function(a){if("string"===typeof a){var a=document.querySelectorAll(a),b,c;b=0;for(c=a.length;b<c;++b)this.unbind(a[b])}else{var d=this.watchers;b=0;for(c=d.length;b<c;++b)if(d[b].elem===a){d[b].unbind();break}}return this};k.prototype.toString=
function(){return JSON.stringify([this.t1r,this.t2r-this.t1r,this.t1,this.t2-this.t1].map(h))};k.prototype.copy=function(){var a=new k(this.t1,this.t1r,this.dt,this.rate);this.data&&(a.data=Object.create(this.data));return a};k.prototype.advance=function(a){this.t1+=a;this.t2+=a;return this};k.prototype.advanceTo=function(a){return this.advance(a-this.t1)};k.prototype.tick=function(){this.t1=this.t2;this.t2+=this.dt;this.t1r=this.t2r;this.t2r+=this.dt*this.rate.valueOf();return this};k.prototype.jumpTo=
function(a){var a=a-this.t1,b=a*this.rate.valueOf();this.t1+=a;this.t2+=a;this.t1r+=b;this.t2r+=b;return this};k.prototype.syncWith=function(a){this.t1=a.t1;this.t2=this.t1+this.dt;this.t1r=a.t1r;this.t2r=this.t1r+this.rate.valueOf()*this.dt;return this};k.prototype.nudgeToRel=function(a){a=Math.max(this.t1r,a);this.t2r>this.t1r&&(this.t1+=(a-this.t1r)*(this.t2-this.t1)/(this.t2r-this.t1r));this.t1r=a;return this};k.prototype.rel2abs=function(a){return this.t1+(a-this.t1r)/this.rate.valueOf()};k.prototype.abs2rel=
function(a){return this.t1r+(a-this.t1)*this.rate.valueOf()};var O=function(a){function b(a){var b=Math.pow(10,4-Math.min(3,(""+(a-a%1)).length));return Math.round(a*b)/b}function c(a){return function(b){a.insertAdjacentElement("beforeend",b)}}a.basicUI=function(a,f,g){if(f.ui)return f.ui;var e=a.createElement("div");g&&e.insertAdjacentHTML("beforeend","<p><b>"+g+"</b></p>");l.names(f).map(function(a){var b=Object.create(f[a].spec);b.name=b.name||a;b.param=f[a];return b}).forEach(function(f){var g=
f.name,h=f.param;if("min"in f&&"max"in f){var n=a.createElement("div"),k=a.createElement("span"),m=a.createElement("span");k.innerText=(f.label||g)+": ";k.style.width="100px";k.style.display="inline-block";k.style.textAlign="left";var j=a.createElement("input");j.type="range";j.min=0;j.max=1;j.step=0.0010;var i="string"===typeof f.mapping?l.mappings[f.mapping]:f.mapping||l.mappings.linear,q=f.units?" "+f.units:"";j.value=i.toNorm(h);m.innerText=" ("+b(h.value)+q+")";j.changeModelParameter=function(){h.value=
i.fromNorm(h,parseFloat(this.value))};j.changeSliderValue=function(a){j.value=i.toNorm(h);m.innerText=" ("+b(a)+q+")"};j.addEventListener("change",j.changeModelParameter);h.watch(j.changeSliderValue);[k,j,m].forEach(c(n));e.insertAdjacentElement("beforeend",n)}});return f.ui=e};return a}({});r.Eventable=v;r.GraphNode=I;r.SoundModel=function(a,b,c){a=v(I(a,b,c));v.observe(a,"connect");v.observe(a,"disconnect");return a};r.Param=l;r.Scheduler=function(a,b){function c(a,b){a&&(B.add(a),B.add(b))}function d(a){a(o,
u.copy(),f)}function f(){}function h(a,b,c){c&&c(a,b,f)}function m(a,b){return function(c,d,g){function e(c,d){var A=n+a.valueOf();0<C&&d.t1<u.t1&&d.advance(C);d.t1>F?h&&D.add(h):d.t2r<A?(b&&b(d,d.t1r,d.t2r,n,A),d.tick(),h&&D.add(h)):(b&&A>=d.t1r&&b(d,d.t1r,A,n,A),d.t2r>d.t1r?g(c,d.nudgeToRel(A),f):g(c,d,f))}function h(a){e(a,d,f)}var n=d.t1r;e(c,d)}}function i(a){return function(b,c,f){a(c)(b,c,f)}}function I(a){function b(a,d,g){var e,h,E;if(0<c.length){E=c;c=[];e=0;for(h=E.length;e<h;++e)E[e](a,
d.copy(),f)}g(a,d,f)}if(0<arguments.length)return function(a,b,c){for(;a<b;++a)c.push(I());return c}(0,a,[]);var c=[];b.play=function(a){c.push(a);return this};b.cancel=function(){c.splice(0,c.length);return this};return b}function O(a){function b(a,d,e){g?e(a,d,f):c.push({sched:a,next:e,clock:d})}if(0<arguments.length)return function(a,b,c){for(;a<b;++a)c.push(O());return c}(0,a,[]);var c=[],d=[],g=!0;b.__defineGetter__("isOpen",function(){return g});b.__defineSetter__("isOpen",function(a){a?b.open():
b.close();return a});b.open=function(a,b,d){g=!0;var e=c,h,E,n,k=y();c=[];h=0;for(E=e.length;h<E;++h)n=e[h],n.next(n.sched,b?b.copy():n.clock.advanceTo(k),f);d&&d(a,b,f)};b.close=function(a,b,c){g=!1;c&&c(a,b,f)};b.toggle=function(a,c,f){return g?b.close(a,c,f):b.open(a,c,f)};b.cancel=function(a,b,d){c.splice(0,c.length);d&&d(a,b,f)};b.push=function(a,b,e){d.push({isOpen:g,cache:c});c=[];e&&e(a,b,f)};b.pop=function(a,b,g){var e=d.pop();c.push.apply(c,e.cache);this.isOpen=e.isOpen;g&&g(a,b,f)};return b}
var o=this===p?{}:this,r=e(),s=q();if(g()&&!r)throw Error("Scheduler needs requestAnimationFrame support. Use a sufficiently modern browser version.");var x=0.0010,y=function(){if(a){if(a instanceof s)return x=1/a.sampleRate,a.createGainNode(),function(){return a.currentTime};throw Error("Scheduler: Argument is not an audio context");}return n()||function(){return 0.0010*Date.now()}}(),z,N=!1;o.__defineGetter__("running",function(){return N});o.__defineSetter__("running",function(a){a?N||(N=!0,u.advanceTo(y()),
z.start()):(N=!1,z.stop())});o.frame_rate=l({min:15,max:75,value:60});var D=new t("tick"),B=new t("frames"),J=new t("update");z=new j(function(){var a,b,c,f,d;a=!0;b=y();U(b);for(F=b+G;b-u.t1>v;)C=b-u.t1,u.advance(C);for(;a||u.t1<F;){if(0<J.length){c=J.length;for(a=0;a<c;++a)J.remove()()}c=D.length;for(a=0;a<c;++a)D.remove()(o,u,h);u.t1<F&&u.tick();C=0;a=!1}if(0<B.length){c=B.length;for(a=0;a<c;a+=2)f=B.remove(),d=B.remove(),f(b,d)}if(o.ontick)o.ontick(b)},0,a);var K=1/60,P=K,G=z.computeAheadInterval_secs||
0.05,v=5*G,u=new k(y(),0,G,1),F=u.t1,C=0,U=function(){var a=1/60,b=u.t1,c=15;return function(f){var d=f-b;0.01<d&&0.07>d&&(P=K=a+=0.05*(d-a),G=3.33*K,v=5*G,0>=c--&&(o.frame_rate.value=Math.round(1/K),c=15));b=f}}(),S=function(){return a?function T(b){0===a.currentTime?setTimeout(T,100,b):(u=new k(y(),0,G,1),F=u.t1,o.play=S=d,d(b))}:d}(),Q;b&&b.diagnostics?(4<=LOG_LEVEL&&console.log("scheduler.js[630]:\t","fire: diagnostics on"),Q=function(a){return function(b,c,d){var g=y();c.t1<g&&console.warning("scheduler.js[634]:\tWARNING!\tclock.t1 < t");
a(c);d(b,c,f)}}):Q=function(a){return function(b,c,d){a(c);d(b,c,f)}};o.audioContext=a;o.update=function(a){a&&J.add(a)};o.perform=function(a,b,c){a(o,b,c)};o.cancel=function(){J.clear();D.clear();B.clear()};o.play=S;o.stop=f;o.cont=h;o.delay=m;o.loop=function(a){return function A(b,c){a(b,c,A)}};o.loop_while=function(a,b){return function(c,d,g){function e(){a.valueOf()?b(c,d,e):g(c,d,f)}e()}};o.repeat=function(a,b){return function(c,d,g){function e(){if(h<a){h++;b(c,d,e)}else g(c,d,f)}var h=0;e()}};
o.fork=function(a){a=a&&a.constructor===Function?Array.prototype.slice.call(arguments,0):a.slice(0);return function(b,c,d){function g(b,h){e++;e===a.length&&d(b,c.syncWith(h),f)}var e=0;a.forEach(function(a){a(b,c.copy(),g)})}};o.spawn=function(a){a=a&&a.constructor===Function?Array.prototype.slice.call(arguments,0):a.slice(0);return function(b,c,d){a.forEach(function(a){a(b,c.copy(),f)});d(b,c,f)}};o.dynamic=i;o.track=function(a){function b(c,d,e,g,h){function n(b,c){if(k<j)a[k++](b,c,n);else e(b,
c,f)}var k=0,j=a.length;if(arguments.length>3){if(arguments.length!==5){console.error("scheduler.js[581]:\tASSERT failed (arguments.length === 5) ");debugger}k=g;j=h}n(c,d,e)}a&&a.constructor===Function&&(a=Array.prototype.slice.call(arguments,0));b.minIndex=0;b.maxIndex=a.length;b.models=a;return b};o.slice=function(a,b,c){c=arguments.length>2?c:a.maxIndex;b=arguments.length>1?Math.max(a.minIndex,Math.min(b,c)):a.minIndex;return function(d,f,e){a(d,f,e,b,c)}};o.fire=Q;o.display=function(a){return function(b,
d,e){function g(b){b+P>h?a(d,h,b):c(g)}var h=d.t1;c(g);e(b,d,f)}};o.frame=function(a){return function(b,d,e){function g(n){if(n+P>h){d.jumpTo(n);a(d);e(b,d,f)}else c(g)}var h=d.t1;c(g)}};o.frames=function(a,b){return function(d,e,g){function h(b,c){var d,e=k+a.valueOf();if(C>0&&c.t1<u.t1){c.advance(C);if(i){o=o+void 0;i.intervals.length>4&&i.intervals.splice(0,i.intervals.length-4);if(i.intervals.length>0){i.intervals[0]=i.intervals[0]+void 0;i.intervals[3]=c.rate.valueOf()}}}if(c.t1>F)n&&D.add(n);
else{if(i&&c.t1r<=e){i.endTime=e;var m=c.rate.valueOf();for(d=Math.max(0.0010,K*m);j<c.t2r;){i.intervals.push(o);i.intervals.push(j);i.intervals.push(j+d);i.intervals.push(m);j=j+d}}if(c.t2r<e){c.tick();n&&D.add(n)}else{i.end=true;c.t2r>c.t1r?g(b,c.nudgeToRel(e),f):g(b,c,f)}}}function n(a){h(a,e,f)}var k=e.t1r,j=k,o=e.t1,m,i;if(b){m=function(a,d){if(d.intervals.length>0){var f=d.intervals[0],e=d.intervals[1],g=d.intervals[2],h=d.intervals[3];if(e<=d.endTime){if(f<P+a){b(d.clock,e,g,d.startTime,d.endTime,
h);d.intervals.splice(0,4)}c(m,d);return}}d.end||c(m,d)};i={clock:e,intervals:[],startTime:e.t1r,endTime:e.t1r+a.valueOf(),end:false};c(m,i)}h(d,e)}};o.log=function(a){return Q(function(){console.log(a)})};o.anim=function(a,b){var c,d,f,e;switch(arguments.length){case 3:e=arguments[2];break;case 4:c=arguments[2];d=arguments[3];e=function(a){return(1-a)*c.valueOf()+a*d.valueOf()};break;case 5:c=arguments[2];d=arguments[3];f=arguments[4];e=function(a){a=f(a);return(1-a)*c.valueOf()+a*d.valueOf()};break;
default:throw Error("Invalid arguments to anim()");}return a.constructor.name==="AudioGain"||a.constructor.name==="AudioParam"?m(b,function(b,c,d,f,g){var g=g-f,h;if(c<=f){h=g>x?(c-f)/g:0;a.setValueAtTime(e(h),b.rel2abs(c))}a.linearRampToValueAtTime(e(g>x?(d-f)/g:1),b.rel2abs(d))}):m(b,function(b,c,d,f,g){b=g-f-(d-c);a.value=b>x?e((c-f)/b):e(1)})};o.rate=function(a){return function(b,c,d){c.rate=a;d(b,c,f)}};o.choice=function(a){return i(function(){return a[Math.floor(Math.random()*a.length)]})};
o.sync=I;o.gate=O;o.stats=function(){return{frame_jitter_ms:0}};o.running=b&&"running"in b&&b.running||!0;org.anclab.steller.Models&&(o.models=org.anclab.steller.Models(o));return o};r.Clock=k;r.PeriodicTimer=j;r.JSNodeTimer=function(a,b,c){if(c){var d=c.createJavaScriptNode(1024);d.onaudioprocess=function(){a()};var f=this,e=!1;i(d);f.start=function(){e||(e=!0,d.connect(c.destination))};f.stop=function(){e&&(d.disconnect(),e=!1)};f.__defineGetter__("running",function(){return e});f.__defineSetter__("running",
function(a){a?f.start():f.stop();return e});f.computeAheadInterval_secs=Math.round(2560)/c.sampleRate;return f}return j.call(this,a,b)};r.UI=O;r.Util={p2f:function(a){return 440*Math.pow(2,(a.valueOf()-69)/12)},f2p:function(a){a=69+12*Math.log(a.valueOf()/440)/Math.LN2;return Math.round(100*a)/100},augment:function(a,b){var c=org.anclab.steller;if(a in c)c[a].augmentors.push(b);else{var d=function(){var a=Array.prototype.slice.call(arguments,0),b={};d.augmentors.forEach(function(c){b=c.apply(b,a)||
b});return b};d.augmentors=[b];c[a]=d}return c[a]}};r.requestAnimationFrame=function(a){return function(b){return a(b)}}(e());r.AudioContext=q()})(function(){return"undefined"===typeof window?void 0:window}(),org.anclab.steller);if(!org.anclab.steller){console.error("models.js[20]:\tASSERT failed (org.anclab.steller) ");debugger}
org.anclab.steller.Util.augment("Models",function(p){var r=org.anclab.steller,v=org.anclab.steller.Util,l=r.SoundModel,s=r.Param,m=p.audioContext,t=this;t.chime=function(){var j=m.createGainNode(),i=l({},[],[j]);i.halfLife=s({min:0.0010,max:10,value:0.5,mapping:"log"});i.attackTime=s({min:0,max:1,value:0.01});i.level=s({min:0.125,max:4,audioParam:j.gain,mapping:"log"});i.play=function(k,h){void 0===h&&(h=1);return p.fire(function(g){var e=v.p2f(k.valueOf()),q=m.createOscillator();q.type=q.SINE;q.frequency.value=
e;var n=m.createGainNode();n.gain.value=0;n.gain.setValueAtTime(0,g.t1);n.gain.linearRampToValueAtTime(h.valueOf()/8,g.t1+i.attackTime.value);var e=440*i.halfLife.value/e,l=10*e;n.gain.setTargetValueAtTime(0,g.t1+i.attackTime.value,e);q.connect(n);n.connect(j);q.noteOn(g.t1);q.stop(g.t1+l)})};return i};t.dc=function(){var j,i,k;k=m.createBuffer(1,1024,m.sampleRate);i=k.getChannelData(0);for(j=0;1024>j;++j)i[j]=1;return function(h){var g=m.createBufferSource();g.buffer=k;g.loop=!0;g.noteOn(0);var e=
m.createGainNode();e.gain.value=h;g.connect(e);h=l({},[],[e]);h.level=s({min:-1,max:1,audioParam:e.gain});h.stop=function(e){g.stop(e)};return h}}();t.noise=function(){var j=m.createBuffer(1,5*m.sampleRate,m.sampleRate),i,k,h=j.getChannelData(0);i=0;for(k=h.length;i<k;++i)h[i]=2*Math.random()-1;return function(){var g=m.createBufferSource();g.buffer=j;g.loop=!0;g.gain.value=1;var e=m.createGainNode();e.gain.value=1;g.connect(e);g.noteOn(0);var h=t.dc(0);h.connect(e);e=l({},[],[e]);e.spread=s({min:0.01,
max:10,audioParam:g.gain});e.mean=h.level;return e}}();t.probe=function(){var j=s({min:-1,max:1,value:0}),i=s({min:-1,max:1,value:1}),k=s({min:0,max:1,value:0}),h=m.createJavaScriptNode(512,1,1),g=0,e=0,q=1-Math.exp(Math.log(0.5)/1024);h.onaudioprocess=function(h){for(var h=h.inputBuffer.getChannelData(0),m=h.length,l=0,a=0,l=0;l<m;++l)a=h[l],g+=q*(a-g),e+=q*(a*a-e);j.value=g;k.value=e;i.value=Math.sqrt(Math.max(0,e-g*g))};h.connect(m.destination);h=l({},[h],[]);h.mean=j;h.sigma=i;h.energy=k;return h};
t.mic=function(){function j(h,g,e){try{navigator.webkitGetUserMedia(h,g,e)}catch(i){e(i)}}function i(h,g){if(!k){if(!g){console.error("models/mic.js[46]:\tASSERT failed (stream) ");debugger}k=m.createMediaStreamSource(g)}k.connect(h.outputs[0]);h.error=null;h.ready.value=1}var k;return function(){var h=m.createGainNode(),g=l({},[],[h]);g.ready=s({min:-1,max:1,value:0});g.gain=s({min:0,max:1,audioParam:h.gain});k?i(g,null):j({audio:!0},function(e){return i(g,e)},function(e){g.error=e;g.gain.value=
0;g.ready.value=-1});return g}}();t.spectrum=function(j,i){function k(){if(q){var e=m.currentTime;h.getFloatFrequencyData(g.bins);for(var i=0,j=g.bins,a=j.length;i<a;++i)j[i]=Math.pow(10,j[i]/20);q=r.requestAnimationFrame(k);g.time.value=e}}var j=j||1024,h=m.createAnalyser();h.fftSize=2*j;h.frequencyBinCount=j;h.smoothingTimeConstant=2>arguments.length?0.1:i;var g=l({},[h],[]);g.bins=new Float32Array(j);g.freqs=new Float32Array(j);g.time=s({min:0,max:1E9,value:0});for(var e=0;e<j;++e)g.freqs[e]=e*
m.sampleRate/h.fftSize;var q;g.start=p.fire(function(){q||(q=r.requestAnimationFrame(k))});g.stop=p.fire(function(){q=void 0});return g};(function(){var j={};t.load_sample=function(i,k,h){var g="sound:"+i,e=j[g];if(e)return k&&k(e),e;if(k){var l=new XMLHttpRequest;l.open("GET",i,!0);l.responseType="arraybuffer";l.onerror=function(e){console.error("models/sample.js[22]:\t",e);h&&h(e,i)};l.onload=function(){m.decodeAudioData(l.response,function(e){k(j[g]=e);0<=LOG_LEVEL&&console.log("models/sample.js[31]:\t",
"Sound ["+i+"] loaded!")},function(e){console.error("models/sample.js[34]:\t","Sound ["+i+"] failed to decode.");h&&h(e,i)})};l.send()}};t.load_sample.clearCache=function(){j={}};t.sample=function(i,j){function h(h,i,j,a,b){if(!q){console.error("models/sample.js[109]:\tASSERT failed (soundBuff) ");debugger}var c=m.createBufferSource();c.buffer=q;c.connect(g);c.playbackRate.value=i;c.gain.setValueAtTime(0,h.t1);c.gain.setTargetValueAtTime(j,h.t1,e.attackTime.value/3);3<arguments.length?c.noteGrainOn(h.t1,
a,4<arguments.length?b:c.duration):c.noteOn(h.t1);return c}var g=m.createGainNode();g.gain.value=0.25;var e=l({},[],[g]);e.level=s({min:0.0010,max:10,audioParam:g.gain,mapping:"log"});e.attackTime=s({min:0.0010,max:10,value:0.02,mapping:"log"});e.releaseTime=s({min:0.0010,max:10,value:0.1,mapping:"log"});var q;e.load=function(g,h,l){if(q)g.perform(l,h,g.stop);else{var a=h.t1-m.currentTime;t.load_sample(i,function(b){q=b;e.duration=q.duration;g.perform(l,h.jumpTo(m.currentTime+a),g.stop)},j)}};e.trigger=
function(e,g){g=g||0;return p.fire(function(i){var a=Math.pow(2,g.valueOf()/12);h(i,a,e.valueOf())})};e.play=p.track([e.load,p.dynamic(function(g){var i=h(g,g.rate.valueOf(),1);return p.delay(e.duration,function(e){i.playbackRate.value=e.rate.valueOf()})})]);e.note=function(g,i,j,a){4>arguments.length&&(a=j);return p.dynamic(function(b){var c=h(b,g.valueOf(),1,i,j);c.gain.value=0;c.gain.setTargetValueAtTime(1,b.t1,e.attackTime.value/3);c.playbackRate.setTargetValueAtTime(g.valueOf(),b.t1,b.dt/3);
return p.track([p.spawn(p.track([p.delay(a),p.fire(function(a){c.gain.setTargetValueAtTime(0,a.t1,e.releaseTime.value/3);c.stop(a.t1+12*e.releaseTime.value)})])),p.delay(j,function(a){c.playbackRate.exponentialRampToValueAtTime(g.valueOf(),a.t1)})])})};return e};t.sample.clearCache=t.load_sample.clearCache})();t.jsnode=function(j){var i=j.numberOfInputs||0,k=i+(j.audioParams?j.audioParams.length:0),h=j.numberOfOutputs||1;if(!(0<h)){console.error("models/jsnode.js[62]:\tASSERT failed (numOutputs > 0) ");
debugger}var g=0<k?m.createChannelMerger(k):void 0,e=0<h?m.createChannelSplitter(h):void 0,q=[],n,p,r;n=0;for(p=k;n<p;++n)r=m.createGainNode(),q.push(r),r.connect(g,0,n);var a=[];n=0;for(p=h;n<p;++n)r=m.createGainNode(),a.push(r),e&&e.connect(r,n);var b;if(j.audioParams){b=Object.keys(j.audioParams);if("inputs"in j.audioParams){console.error("models/jsnode.js[84]:\tASSERT failed (!('inputs' in spec.audioParams)) ");debugger}if("outputs"in j.audioParams){console.error("models/jsnode.js[85]:\tASSERT failed (!('outputs' in spec.audioParams)) ");
debugger}if("playbackTime"in j.audioParams){console.error("models/jsnode.js[86]:\tASSERT failed (!('playbackTime' in spec.audioParams)) ");debugger}}else b=[];var c={},d=[],f=[];c.inputs=d;c.outputs=f;n=0;for(p=b.length;n<p;++n)c[b[n]]=null;c.playbackTime=m.currentTime;var s=0===i,v=!1,H=!1,R=0,L=Infinity,o,w=l({},q,a),M=0<b.length?t.dc(1):void 0;b.forEach(function(a,d){var e=q[i+d];w[a]=e.gain;e.gain.value=j.audioParams[a];M.connect(e);if(b[d]in c){console.error("models/jsnode.js[173]:\tASSERT failed (!(paramNames[i] in obj)) ",
"Duplicate param name - ",b[d]);debugger}});var x=w.keep(m.createJavaScriptNode(1024,k,Math.min(1,h)));g&&g.connect(x);x.onaudioprocess=function(a){var e,g,k,l,n,p;e=0;s?(k=Math.floor(m.currentTime*m.sampleRate),l=Math.max(k,R),n=Math.min(k+1024,L)):(l=k,n=k+1024);p=l-k;k=n-k;if(n>l){e=0;for(g=i;e<g;++e)d[e]=a.inputBuffer.getChannelData(e).subarray(p,k);e=0;for(g=h;e<g;++e)f[e]=a.outputBuffer.getChannelData(e).subarray(p,k);e=0;for(g=b.length;e<g;++e)c[b[e]]=a.inputBuffer.getChannelData(i+e).subarray(p,
k);c.playbackTime=(a.playbackTime||m.currentTime)+p/m.sampleRate;e=j.onaudioprocess.call(w,c);void 0===e&&(e=a.outputBuffer.length)}if(!H&&(l+e<n||s&&n>=L))1<=LOG_LEVEL&&console.log("models/jsnode.js[150]:\t","Finished",n,L),H=!0,setTimeout(o,Math.round(1024E3/m.sampleRate))};var y=e||m.destination;if(0===i){var z;o=function(){H=!0;x.disconnect();e&&e.disconnect();M&&(M.stop(0),M.disconnect());g&&g.disconnect();w.drop(x);w.emit&&w.emit("stop")};s=!0;w.prepareAheadTime=0.1;w.start=function(a){if(!v&&
!H)if(a){var b=Math.max(a,m.currentTime)-m.currentTime;z&&(cancelTimeout(z),z=null);var c=function(a){R=Math.floor(a*m.sampleRate);v=true;z=null;x.connect(y)};b<=w.prepareAheadTime?c(a):z=setTimeout(c,Math.round(1E3*(b-w.prepareAheadTime)),a)}else x.connect(y)};w.stop=function(a){H||(L=Math.max(R,Math.ceil(a*m.sampleRate)),0>=a-m.currentTime&&(4<=LOG_LEVEL&&console.log("models/jsnode.js[249]:\t","Stopping immediately."),setTimeout(o,0)))}}else x.connect(y);return w};return t});
