var LOG_LEVEL=1;org="undefined"===typeof org?{}:org;org.anclab=org.anclab||{};org.anclab.steller=org.anclab.steller||{};
(function(q,s){function u(a){var b={};a.on=function(a,d){var a=z(a),f=b[a]||(b[a]={}),h=d.__steller_eventable_id__||0;if(h in f)return this;h||Object.defineProperty(d,"__steller_eventable_id__",{value:h=L++,enumerable:!1,configurable:!1,writable:!1});f[h]=d;return this};a.off=function(a,d){var a=z(a),f=b[a];if(!f)return this;var h=d&&d.__steller_eventable_id__||0;h?delete f[h]:d||delete b[a];return this};a.emit=function(a){var a=z(a),d=b[a];if(!d)return this;for(var f in d)try{d[f].apply(this,arguments)}catch(h){1<=
LOG_LEVEL&&console.log("eventable.js[107]:\t","Exception in event watcher - ",h)}return this};return a}function j(a){var b=Object.create(j.prototype);b.spec=a=t(Object.create(a));b.getter=void 0;b.setter=void 0;b.valueOf=void 0;b.audioParam=void 0;b.watchers=[];b._value=void 0;a.audioParam?(b.audioParam=a.audioParam,b.getter=a.getter||j.getters.audioParam,b.setter=a.setter||j.setters.audioParam):a.options?(b.getter=a.getter||j.getters.value,b.setter=a.setter||j.setters.option):(b.getter=a.getter||
j.getters.value,b.setter=a.setter||j.setters.value);b.valueOf=b.getter;"value"in a&&b.setter(a.value);return b}function t(a){if(a.options){var b={};a.options.forEach(function(a,d){b["option:"+a]=d+1});a.limit=function(c){if("number"===typeof c){if(0<=c&&c<a.options.length)return a.options[c];throw Error("Invalid enumeration index");}if(b["option:"+c])return c;throw Error("Invalid enumeration value");}}return a}function l(a,b){var c,d,f=a.watchers;c=0;for(d=f.length;c<d;++c)f[c](b,a);return b}function v(){var a=
0,b=4,c=[null,null,null,null],d=-1,f=0;this.length=0;this.add=function(h){if(a>=b){var g=Array(2*b),e,i,o,k;e=d;i=0;o=a;for(k=b;i<o;++i,e=(e+1)%k)g[i]=c[e];c=g;f=a;d=0===a?-1:0;b*=2}c[f]=h;0>d&&(d=f);f=(f+1)%b;return this.length=a+=1};this.remove=function(){if(0>=a)throw Error("Empty queue");var f=c[d];c[d]=null;d=(d+1)%b;this.length=a-=1;return f};this.clear=function(){this.length=a=0;c.splice(0,c.length,null,null,null,null);b=4;d=-1;f=0};return this}function m(a,b){var c=g();if(e()&&!c)throw Error("PeriodicTimer needs requestAnimationFrame support. Use a sufficiently modern browser.");
var d=this,f=!1,h,b=void 0===b?15:Math.min(Math.max(e()?15:1,b),33);c&&12<=b?(d.start=function(){f||(f=!0,h=c(function(){f?(h=c(arguments.callee),a()):h=void 0}))},d.stop=function(){f=!1;h&&(cancelAnimationFrame(h),h=void 0)}):(d.start=function(){f||(f=!0,h=setInterval(a,1))},d.stop=function(){f&&(f=!1,clearInterval(h),h=void 0)});d.__defineGetter__("running",function(){return f});d.__defineSetter__("running",function(a){a?d.start():d.stop();return f});d.computeAheadInterval_secs=Math.round(3.333*
b)/1E3;return d}function r(a){(q.JSNodeTimer_jsnodes||(q.JSNodeTimer_jsnodes=[])).push(a)}function k(a,b,c,d){this.dt=c;this.t1=a;this.t2=a+c;this.t1r=b;this.t2r=b+d.valueOf()*c;this.rate=d;this.data=null;return this}function i(a){return Math.round(1E3*a)/1E3}function e(){return"object"===typeof q&&"object"===typeof document&&q.document===document}function g(){try{return q.requestAnimationFrame||q.webkitRequestAnimationFrame||q.mozRequestAnimationFrame||q.msRequestAnimationFrame||function(a){setTimeout(a,
1E3/60)}}catch(a){}}function n(){(function(){function a(a,f,h){a[h]=a[h]||a[f];b(a,f,h)}function b(a,b,h){var c=a[b];a[b]=function(){console.warn("Web Audio API: Deprecated name %s used. Use %s instead.",b,h);a[b]=c||a[h];return c.apply(this,arguments)}}var c=this;c.AudioContext=function(c){if(c)return function(){var f,h,e;if(0===arguments.length)f=new c;else if(3===arguments.length)f=new c(arguments[0],arguments[1],arguments[2]);else throw Error("Invalid instantiation of AudioContext");a(f,"createGainNode",
"createGain");a(f,"createDelayNode","createDelay");a(f,"createJavaScriptNode","createScriptProcessor");a(f,"createWaveTable","createPeriodicWave");h=Object.getPrototypeOf(f.createGain().gain);e=Object.getPrototypeOf(h);e.setValueAtTime&&(console.warn("Implementation uses extra dummy interface for AudioGainParam. This will be removed."),h=e);a(h,"setTargetValueAtTime","setTargetAtTime");h=Object.getPrototypeOf(f.createBufferSource());a(h,"noteOff","stop");h.start?(b(h,"noteOn","start"),b(h,"noteGrainOn",
"start")):(console.warn("Web Audio API: Only BufferSource.note[Grain]On available. Providing BufferSource.start."),h.start=function(a,b,f){switch(arguments.length){case 1:return this.noteOn(a);case 3:return this.noteGrainOn(a,b,f);default:throw Error("Invalid arguments to BufferSource.start");}},b(h,"noteOn","start"),b(h,"noteOff","stop"));h=Object.getPrototypeOf(f.createOscillator());a(h,"noteOn","start");a(h,"noteOff","stop");a(h,"setWaveTable","setPeriodicWave");return f};console.warn("Web Audio API not supported on this client.")}(c.AudioContext||
c.webkitAudioContext);c.webkitAudioContext=function(){console.warn('Use "new AudioContext" instead of "new webkitAudioContext".');switch(arguments.length){case 0:return new c.AudioContext;case 3:return new c.AudioContext(arguments[0],arguments[1],arguments[2]);default:throw Error("Invalid AudioContext creation");}}})();return AudioContext}function o(){try{var a=q.performance,b=a&&(a.now||a.webkitNow||a.mozNow);if(b)return function(){return 0.0010*b.call(a)}}catch(c){}return function(){return 0.0010*
Date.now()}}var z=function(){var a={};return function(b){if(a[b])throw Error("Invalid event name - "+b);return b}}(),L=1;u.observe=function(a,b,c){var c=z(c||b),d=a[b];a[b]=function(){var a=d.apply(this,arguments),b=Array.prototype.slice.call(arguments);b.unshift(c);this.emit.apply(this,b);return a};return a};var N=function(){function a(f,c,d){f.inputs=c||[];f.outputs=d||[];f.numberOfInputs=f.inputs.length;f.numberOfOutputs=f.outputs.length;f.context=f.inputs[0]&&f.inputs[0].context||f.outputs[0]&&
f.outputs[0].context;f.connect=function(a,b,c){var h,a=a||f.context.destination,b=f.outputs[b||0];h=a.inputs?a.inputs[c||0]:a;if("AudioParam"===h.constructor.name||"AudioGain"===h.constructor.name)b.connect(h);else if(h.numberOfInputs===b.numberOfOutputs){a=0;for(c=h.numberOfInputs;a<c;++a)b.connect(h,a,a)}else b.connect(h);return f};f.disconnect=function(){0<arguments.length?Array.prototype.forEach.call(arguments,function(a){f.outputs[a].disconnect()}):f.outputs.forEach(function(a){a.disconnect()});
return f};var e={},g=b(f);f.keep=function(a){var a=a||f,c=b(a);return e[c]=a};f.drop=function(c){c?(c=b(c),delete e[c]):delete a._preservedNodes[g]};a._preservedNodes[g]=e;return f}function b(a){var b=a[d];b||(b=c++,Object.defineProperty(a,d,{value:b,writable:!1,enumerable:!1,configurable:!1}));return b}var c=1,d="#org.anclab.steller.GraphNode.globalid";a._preservedNodes={};a.chain=function(b){var c,d;c=0;for(d=b.length-1;c<d;++c)b[c].connect(b[c+1]);return a};return a}();j.getters={value:function(){return this._value},
audioParam:function(){return this.audioParam.value}};j.setters={value:function(a){return this._value=a},audioParam:function(a){return this.audioParam.value=a},option:function(a){return this._value=this.spec.limit(a)}};j.mappings={};j.mappings.linear={fromNorm:function(a,b){return a.spec.min+b*(a.spec.max-a.spec.min)},toNorm:function(a){return(a.value-a.spec.min)/(a.spec.max-a.spec.min)}};j.mappings.log={fromNorm:function(a,b){var c=a.spec,d=Math.log(c.min),c=Math.log(c.max);return Math.exp(d+b*(c-
d))},toNorm:function(a){var b=a.spec,c=Math.log(b.min),b=Math.log(b.max);return(Math.log(a.value)-c)/(b-c)}};j.names=function(a){return Object.keys(a).filter(function(b){return a[b]instanceof j})};j.expose=function(a,b,c){c||(c=j.names(a));c.forEach(function(c){b[c]=a[c]});return j};j.bind=function(a,b,c){a instanceof j?a.bind(b,c):"value"in a?c?c.update(function(){b.value=a.value}):b.value=a.value:c?c.update(function(){b.value=a}):b.value=a;return j};j.prototype.__defineGetter__("value",function(){return this.getter()});
j.prototype.__defineSetter__("value",function(a){return a!==this.getter()?l(this,this.setter(a)):a});j.prototype.watch=function(a){var b,c,d=this.watchers;b=0;for(c=d.length;b<c;++b)if(d[b]===a)return this;d.push(a);return this};j.prototype.unwatch=function(a){var b=this.watchers;if(1>arguments.length||!a)return b.splice(0,b.length),this;for(var c=b.length-1;0<=c;--c)if(b[c]===a){b.splice(c,1);break}return this};j.prototype.changed=function(){l(this,this.getter());return this};j.prototype.alias=function(a,
b){var c=this,d=Object.create(c);d.spec=Object.create(c.spec);d.spec.name=a;b&&(d.spec.label=b);d.getter=function(){return c.getter()};d.setter=function(a){return c.setter(a)};d.alias=function(a,b){return c.alias(a,b)};return d};j.prototype.bind=function(a,b){var c=this;if(a.addEventListener){var d=c.spec,f=d.mapping?j.mappings[d.mapping]:j.mappings.linear,h,e,g;if("checkbox"===a.type)h=function(){c.value=a.checked?1:0},e=b?function(){b.update(h)}:h,g=function(b){a.checked=b?!0:!1};else if("range"===
a.type)h=function(){c.value=f.fromNorm(c,parseFloat(a.value))},e=b?function(){b.update(h)}:h,g=function(){a.value=f.toNorm(c)};else throw Error("org.anclab.steller.Param.bind: Unsupported control type - "+a.type);g.elem=a;g.unbind=function(){a.removeEventListener(e);c.unwatch(g)};a.addEventListener("change",e);c.watch(g);g(c.value)}else if("string"===typeof a){var d=document.querySelectorAll(a),i,o;i=0;for(o=d.length;i<o;++i)this.bind(d[i])}else{var k=function(b){a.value=b};k.elem=a;k.unbind=function(){c.unwatch(k)};
c.watch(k);a.value=c.value}return this};j.prototype.unbind=function(a){if("string"===typeof a){var a=document.querySelectorAll(a),b,c;b=0;for(c=a.length;b<c;++b)this.unbind(a[b])}else{var d=this.watchers;b=0;for(c=d.length;b<c;++b)if(d[b].elem===a){d[b].unbind();break}}return this};k.prototype.toString=function(){return JSON.stringify([this.t1r,this.t2r-this.t1r,this.t1,this.t2-this.t1].map(i))};k.prototype.copy=function(){var a=new k(this.t1,this.t1r,this.dt,this.rate);this.data&&(a.data=Object.create(this.data));
return a};k.prototype.advance=function(a){this.t1+=a;this.t2+=a;return this};k.prototype.advanceTo=function(a){return this.advance(a-this.t1)};k.prototype.tick=function(){this.t1=this.t2;this.t2+=this.dt;this.t1r=this.t2r;this.t2r+=this.dt*this.rate.valueOf();return this};k.prototype.jumpTo=function(a){var a=a-this.t1,b=a*this.rate.valueOf();this.t1+=a;this.t2+=a;this.t1r+=b;this.t2r+=b;return this};k.prototype.syncWith=function(a){this.t1=a.t1;this.t2=this.t1+this.dt;this.t1r=a.t1r;this.t2r=this.t1r+
this.rate.valueOf()*this.dt;return this};k.prototype.nudgeToRel=function(a){a=Math.max(this.t1r,a);this.t2r>this.t1r&&(this.t1+=(a-this.t1r)*(this.t2-this.t1)/(this.t2r-this.t1r));this.t1r=a;return this};k.prototype.rel2abs=function(a){return this.t1+(a-this.t1r)/this.rate.valueOf()};k.prototype.abs2rel=function(a){return this.t1r+(a-this.t1)*this.rate.valueOf()};var E=function(a){function b(a){var b=Math.pow(10,4-Math.min(3,(""+(a-a%1)).length));return Math.round(a*b)/b}function c(a){return function(b){a.insertAdjacentElement("beforeend",
b)}}a.basicUI=function(a,f,h){if(f.ui)return f.ui;var e=a.createElement("div");h&&e.insertAdjacentHTML("beforeend","<p><b>"+h+"</b></p>");j.names(f).map(function(a){var b=Object.create(f[a].spec);b.name=b.name||a;b.param=f[a];return b}).forEach(function(h){var f=h.name,g=h.param;if("min"in h&&"max"in h){var i=a.createElement("div"),o=a.createElement("span"),k=a.createElement("span");o.innerText=(h.label||f)+": ";o.style.width="100px";o.style.display="inline-block";o.style.textAlign="left";var l=a.createElement("input");
l.type="range";l.min=0;l.max=1;l.step=0.0010;var m="string"===typeof h.mapping?j.mappings[h.mapping]:h.mapping||j.mappings.linear,n=h.units?" "+h.units:"";l.value=m.toNorm(g);k.innerText=" ("+b(g.value)+n+")";l.changeModelParameter=function(){g.value=m.fromNorm(g,parseFloat(this.value))};l.changeSliderValue=function(a){l.value=m.toNorm(g);k.innerText=" ("+b(a)+n+")"};l.addEventListener("change",l.changeModelParameter);g.watch(l.changeSliderValue);[o,l,k].forEach(c(i));e.insertAdjacentElement("beforeend",
i)}});return f.ui=e};return a}({});s.Eventable=u;s.AsyncEventable=function(a){var a=u(a),b=a.on;a.on=function(c,d){if(!d)return this;var f=d.__steller_async_eventable__;f||Object.defineProperty(d,"__steller_async_eventable__",{value:f=function(){var b=arguments;setTimeout(function(){d.apply(a,b)},0)},enumerable:!1,configurable:!1,writable:!1});b(c,f)};return a};s.GraphNode=N;s.SoundModel=function(a,b,c){a=u(N(a,b,c));u.observe(a,"connect");u.observe(a,"disconnect");return a};s.Param=j;s.Scheduler=
function(a,b){function c(a){a&&t.add(a)}function d(a,b){a&&(A.add(a),A.add(b))}function f(a){a(p,w.copy(),h)}function h(){}function i(a,b,c){c&&c(a,b,h)}function l(a,b){return function(f,d,e){function g(f,d){var y=o+a.valueOf();0<B&&d.t1<w.t1&&d.advance(B);d.t1>G?c(i):d.t2r<y?(b&&b(d,d.t1r,d.t2r,o,y),d.tick(),c(i)):(b&&y>=d.t1r&&b(d,d.t1r,y,o,y),d.t2r>d.t1r?e(f,d.nudgeToRel(y),h):e(f,d,h))}function i(a){g(a,d,h)}var o=d.t1r;g(f,d)}}function r(a){return function(b,c,d){a(c)(b,c,d)}}function z(a){function b(a,
d,f){var e,g,F;if(0<c.length){F=c;c=[];e=0;for(g=F.length;e<g;++e)F[e](a,d.copy(),h)}f(a,d,h)}if(0<arguments.length)return function(a,b,c){for(;a<b;++a)c.push(z());return c}(0,a,[]);var c=[];b.play=function(a){c.push(a);return this};b.cancel=function(){c.splice(0,c.length);return this};return b}function L(a){function b(a,d,e){f?e(a,d,h):c.push({sched:a,next:e,clock:d})}if(0<arguments.length)return function(a,b,c){for(;a<b;++a)c.push(L());return c}(0,a,[]);var c=[],d=[],f=!0;b.__defineGetter__("isOpen",
function(){return f});b.__defineSetter__("isOpen",function(a){a?b.open():b.close();return a});b.open=function(a,b,d){f=!0;var e=c,g,F,i,o=D();c=[];g=0;for(F=e.length;g<F;++g)i=e[g],i.next(i.sched,b?b.copy():i.clock.advanceTo(o),h);d&&d(a,b,h)};b.close=function(a,b,c){f=!1;c&&c(a,b,h)};b.toggle=function(a,c,d){return f?b.close(a,c,d):b.open(a,c,d)};b.cancel=function(a,b,d){c.splice(0,c.length);d&&d(a,b,h)};b.push=function(a,b,e){d.push({isOpen:f,cache:c});c=[];e&&e(a,b,h)};b.pop=function(a,b,f){var e=
d.pop();c.push.apply(c,e.cache);this.isOpen=e.isOpen;f&&f(a,b,h)};return b}var p=this===q?{}:this,N=g();n();if(e()&&!N)throw Error("Scheduler needs requestAnimationFrame support. Use a sufficiently modern browser version.");var O=0.0010,D=function(){if(a){if(a.createGain||a.createGainNode)return O=1/a.sampleRate,a.createGain=a.createGainNode=a.createGain||a.createGainNode,a.createGainNode(),function(){return a.currentTime};throw Error("Scheduler: Argument is not an audio context");}return o()||function(){return 0.0010*
Date.now()}}(),s,E=!1;p.__defineGetter__("running",function(){return E});p.__defineSetter__("running",function(a){a?E||(E=!0,w.advanceTo(D()),f.activeFunc&&(f=f.activeFunc,H=H.activeFunc),s.start()):(E=!1,s.stop(),f=function(a){function b(a){c(a)}b.activeFunc=a;return b}(f),H=function(a){function b(d){c(function(){a(d)})}b.activeFunc=a;return b}(H))});p.frame_rate=j({min:15,max:75,value:60});var t=new v("tick"),A=new v("frames"),u=new v("update");s=new m(function(){var a,b,c,d,f;a=!0;b=D();V(b);for(G=
b+I;b-w.t1>T;)B=b-w.t1,w.advance(B);for(;a||w.t1<G;){if(0<u.length){c=u.length;for(a=0;a<c;++a)u.remove()()}c=t.length;for(a=0;a<c;++a)t.remove()(p,w,i);w.t1<G&&w.tick();B=0;a=!1}if(0<A.length){c=A.length;for(a=0;a<c;a+=2)d=A.remove(),f=A.remove(),d(b,f)}if(p.ontick)p.ontick(b)},0,a);var K=1/60,P=K,I=s.computeAheadInterval_secs||0.05,T=5*I,w=new k(D(),0,I,1),G=w.t1,B=0,V=function(){var a=1/60,b=w.t1,c=15;return function(d){var f=d-b;0.01<f&&0.07>f&&(P=K=a+=0.05*(f-a),I=3.33*K,T=5*I,0>=c--&&(p.frame_rate.value=
Math.round(1/K),c=15));b=d}}(),H=function(){return a?function U(b){0===a.currentTime?setTimeout(U,100,b):(w=new k(D(),0,I,1),G=w.t1,p.play=H=f,f(b))}:f}(),Q;b&&b.diagnostics?(4<=LOG_LEVEL&&console.log("scheduler.js[649]:\t","fire: diagnostics on"),Q=function(a){return function(b,c,d){D();a(c);d(b,c,h)}}):Q=function(a){return function(b,c,d){a(c);d(b,c,h)}};p.audioContext=a;p.update=function(a){a&&u.add(a)};p.perform=function(a,b,c){a(p,b,c)};p.cancel=function(){u.clear();t.clear();A.clear()};p.play=
H;p.stop=h;p.cont=i;p.delay=l;p.loop=function(a){return function y(b,c){a(b,c,y)}};p.loop_while=function(a,b){return function(c,d,f){function e(){a.valueOf()?b(c,d,e):f(c,d,h)}e()}};p.repeat=function(a,b){return function(c,d,f){function e(){if(g<a){g++;b(c,d,e)}else f(c,d,h)}var g=0;e()}};p.fork=function(a){a=a&&a.constructor===Function?Array.prototype.slice.call(arguments,0):a.slice(0);return function(b,c,d){function f(b,g){e++;e===a.length&&d(b,c.syncWith(g),h)}var e=0;a.forEach(function(a){a(b,
c.copy(),f)})}};p.spawn=function(a){a=a&&a.constructor===Function?Array.prototype.slice.call(arguments,0):a.slice(0);return function(b,c,d){a.forEach(function(a){a(b,c.copy(),h)});d(b,c,h)}};p.dynamic=r;p.track=function(a){function b(c,d,f,e,g){function i(b,c){if(o<l)a[o++](b,c,i);else f(b,c,h)}var o=0,l=a.length;if(arguments.length>3){o=e;l=g}i(c,d,f)}a&&a.constructor===Function&&(a=Array.prototype.slice.call(arguments,0));b.minIndex=0;b.maxIndex=a.length;b.models=a;return b};p.slice=function(a,
b,c){c=arguments.length>2?c:a.maxIndex;b=arguments.length>1?Math.max(a.minIndex,Math.min(b,c)):a.minIndex;return function(d,f,h){a(d,f,h,b,c)}};p.fire=Q;p.display=function(a){return function(b,c,f){function e(b){b+P>g?a(c,g,b):d(e)}var g=c.t1;d(e);f(b,c,h)}};p.frame=function(a){return function(b,c,f){function e(i){if(i+P>g){c.jumpTo(i);a(c);f(b,c,h)}else d(e)}var g=c.t1;d(e)}};p.frames=function(a,b){return function(f,e,g){function i(b,d){var f,e=l+a.valueOf();if(B>0&&d.t1<w.t1){d.advance(B);if(n){m=
m+void 0;n.intervals.length>4&&n.intervals.splice(0,n.intervals.length-4);if(n.intervals.length>0){n.intervals[0]=n.intervals[0]+void 0;n.intervals[3]=d.rate.valueOf()}}}if(d.t1>G)c(o);else{if(n&&d.t1r<=e){n.endTime=e;var j=d.rate.valueOf();for(f=Math.max(0.0010,K*j);k<d.t2r;){n.intervals.push(m);n.intervals.push(k);n.intervals.push(k+f);n.intervals.push(j);k=k+f}}if(d.t2r<e){d.tick();c(o)}else{if(n)n.end=true;d.t2r>d.t1r?g(b,d.nudgeToRel(e),h):g(b,d,h)}}}function o(a){i(a,e,h)}var l=e.t1r,k=l,m=
e.t1,j,n;if(b){j=function(a,c){if(c.intervals.length>0){var f=c.intervals[0],e=c.intervals[1],h=c.intervals[2],g=c.intervals[3];if(e<=c.endTime){if(f<P+a){b(c.clock,e,h,c.startTime,c.endTime,g);c.intervals.splice(0,4)}d(j,c);return}}c.end||d(j,c)};n={clock:e,intervals:[],startTime:e.t1r,endTime:e.t1r+a.valueOf(),end:false};d(j,n)}i(f,e)}};p.log=function(a){return Q(function(){console.log(a)})};p.anim=function(a,b){var c,d,f,e;switch(arguments.length){case 3:e=arguments[2];break;case 4:c=arguments[2];
d=arguments[3];e=function(a){return(1-a)*c.valueOf()+a*d.valueOf()};break;case 5:c=arguments[2];d=arguments[3];f=arguments[4];e=function(a){a=f(a);return(1-a)*c.valueOf()+a*d.valueOf()};break;default:throw Error("Invalid arguments to anim()");}return a.constructor.name==="AudioGain"||a.constructor.name==="AudioParam"?l(b,function(b,c,d,f,h){var h=h-f,g;if(c<=f){g=h>O?(c-f)/h:0;a.setValueAtTime(e(g),b.rel2abs(c))}a.linearRampToValueAtTime(e(h>O?(d-f)/h:1),b.rel2abs(d))}):l(b,function(b,c,d,f,h){b=
h-f-(d-c);a.value=b>O?e((c-f)/b):e(1)})};p.rate=function(a){return function(b,c,d){c.rate=a;d(b,c,h)}};p.choice=function(a){return r(function(){return a[Math.floor(Math.random()*a.length)]})};p.sync=z;p.gate=L;p.stats=function(){return{frame_jitter_ms:0}};p.running=b&&"running"in b&&b.running||!0;org.anclab.steller.Models&&(p.models=org.anclab.steller.Models(p));return p};s.Clock=k;s.PeriodicTimer=m;s.JSNodeTimer=function(a,b,c){if(c){var d=c.createJavaScriptNode(1024);d.onaudioprocess=function(){a()};
var f=this,e=!1;r(d);f.start=function(){e||(e=!0,d.connect(c.destination))};f.stop=function(){e&&(d.disconnect(),e=!1)};f.__defineGetter__("running",function(){return e});f.__defineSetter__("running",function(a){a?f.start():f.stop();return e});f.computeAheadInterval_secs=Math.round(2560)/c.sampleRate;return f}return m.call(this,a,b)};s.UI=E;s.Util={p2f:function(a){return 440*Math.pow(2,(a.valueOf()-69)/12)},f2p:function(a){a=69+12*Math.log(a.valueOf()/440)/Math.LN2;return Math.round(100*a)/100},augment:function(a,
b){var c=org.anclab.steller;if(a in c)c[a].augmentors.push(b);else{var d=function(){var a=Array.prototype.slice.call(arguments,0),b={};d.augmentors.forEach(function(c){b=c.apply(b,a)||b});return b};d.augmentors=[b];c[a]=d}return c[a]}};s.requestAnimationFrame=function(a){return function(b){return a(b)}}(g());s.AudioContext=n()})(function(){return"undefined"===typeof window?void 0:window}(),org.anclab.steller);
org.anclab.steller.Util.augment("Models",function(q){var s=org.anclab.steller,u=org.anclab.steller.Util,j=s.SoundModel,t=s.Param,l=q.audioContext,v=this;v.chime=function(){var m=l.createGainNode(),r=j({},[],[m]);r.halfLife=t({min:0.0010,max:10,value:0.5,mapping:"log"});r.attackTime=t({min:0.0010,max:1,value:0.01,mapping:"log"});r.level=t({min:0.125,max:4,audioParam:m.gain,mapping:"log"});r.play=function(k,i){void 0===i&&(i=1);return q.fire(function(e){var g=u.p2f(k.valueOf()),n=l.createOscillator();
n.type=n.SINE;n.frequency.value=g;var o=l.createGainNode();o.gain.value=0;o.gain.setValueAtTime(0,e.t1);o.gain.linearRampToValueAtTime(i.valueOf()/8,e.t1+r.attackTime.value);var g=440*r.halfLife.value/g,j=10*g;o.gain.setTargetAtTime(0,e.t1+r.attackTime.value,g);n.connect(o);o.connect(m);n.start(e.t1);n.stop(e.t1+j)})};return r};v.dc=function(){var m,r,k;k=l.createBuffer(1,1024,l.sampleRate);r=k.getChannelData(0);for(m=0;1024>m;++m)r[m]=1;return function(i){var e=l.createBufferSource();e.buffer=k;
e.loop=!0;e.start(0);var g=l.createGainNode();g.gain.value=i;e.connect(g);i=j({},[],[g]);i.level=t({min:-1,max:1,audioParam:g.gain});i.stop=function(g){e.stop(g)};return i}}();v.noise=function(){var m=l.createBuffer(1,5*l.sampleRate,l.sampleRate),r,k,i=m.getChannelData(0);r=0;for(k=i.length;r<k;++r)i[r]=2*Math.random()-1;return function(){var e=l.createBufferSource();e.buffer=m;e.loop=!0;e.gain.value=1;var g=l.createGainNode();g.gain.value=1;e.connect(g);e.start(0);var i=v.dc(0);i.connect(g);g=j({},
[],[g]);g.spread=t({min:0.01,max:10,audioParam:e.gain,mapping:"log"});g.mean=i.level;return g}}();v.probe=function(){var m=t({min:-1,max:1,value:0}),r=t({min:-1,max:1,value:1}),k=t({min:0,max:1,value:0}),i=l.createScriptProcessor(512,1,1),e=0,g=0,n=1-Math.exp(Math.log(0.5)/1024);i.onaudioprocess=function(i){for(var i=i.inputBuffer.getChannelData(0),l=i.length,j=0,q=0,j=0;j<l;++j)q=i[j],e+=n*(q-e),g+=n*(q*q-g);m.value=e;k.value=g;r.value=Math.sqrt(Math.max(0,g-e*e))};i.connect(l.destination);i=j({},
[i],[]);i.mean=m;i.sigma=r;i.energy=k;return i};v.mic=function(){function m(i,e,g){try{navigator.webkitGetUserMedia(i,e,g)}catch(l){g(l)}}function r(i,e){k||(k=l.createMediaStreamSource(e));k.connect(i.outputs[0]);i.error=null;i.ready.value=1}var k;return function(){var i=l.createGainNode(),e=j({},[],[i]);e.ready=t({min:-1,max:1,value:0});e.gain=t({min:0,max:1,audioParam:i.gain});k?r(e,null):m({audio:!0},function(g){return r(e,g)},function(g){e.error=g;e.gain.value=0;e.ready.value=-1});return e}}();
v.spectrum=function(m,r){function k(){if(n){var g=l.currentTime;i.getFloatFrequencyData(e.bins);for(var j=0,m=e.bins,r=m.length;j<r;++j)m[j]=Math.pow(10,m[j]/20);n=s.requestAnimationFrame(k);e.time.value=g}}var m=m||1024,i=l.createAnalyser();i.fftSize=2*m;i.frequencyBinCount=m;i.smoothingTimeConstant=2>arguments.length?0.1:r;var e=j({},[i],[]);e.bins=new Float32Array(m);e.freqs=new Float32Array(m);e.time=t({min:0,max:1E9,value:0});for(var g=0;g<m;++g)e.freqs[g]=g*l.sampleRate/i.fftSize;var n;e.start=
q.fire(function(){n||(n=s.requestAnimationFrame(k))});e.stop=q.fire(function(){n=void 0});return e};(function(){var m={};v.load_sample=function(j,k,i){var e="sound:"+j,g=m[e];if(g)return k&&k(g),g;if(k){var n=new XMLHttpRequest;n.open("GET",j,!0);n.responseType="arraybuffer";n.onerror=function(e){i&&i(e,j)};n.onload=function(){l.decodeAudioData(n.response,function(g){k(m[e]=g);0<=LOG_LEVEL&&console.log("models/sample.js[31]:\t","Sound ["+j+"] loaded!")},function(e){i&&i(e,j)})};n.send()}};v.load_sample.clearCache=
function(){m={}};v.sample=function(m,k){function i(i,j,k,m,r){var a=l.createBufferSource();a.buffer=n;a.connect(e);a.playbackRate.value=j;a.gain.setValueAtTime(0,i.t1);a.gain.setTargetAtTime(k,i.t1,g.attackTime.value/3);3<arguments.length?a.noteGrainOn(i.t1,m,4<arguments.length?r:a.duration):a.noteOn(i.t1);return a}var e=l.createGainNode();e.gain.value=0.25;var g=j({},[],[e]);g.level=t({min:0.0010,max:10,audioParam:e.gain,mapping:"log"});g.attackTime=t({min:0.0010,max:10,value:0.02,mapping:"log"});
g.releaseTime=t({min:0.0010,max:10,value:0.1,mapping:"log"});var n;g.load=function(e,i,j){if(n)e.perform(j,i,e.stop);else{var q=i.t1-l.currentTime;v.load_sample(m,function(k){n=k;g.duration=n.duration;e.perform(j,i.jumpTo(l.currentTime+q),e.stop)},k)}};g.trigger=function(e,g){g=g||0;return q.fire(function(j){var l=Math.pow(2,g.valueOf()/12);i(j,l,e.valueOf())})};g.play=q.track([g.load,q.dynamic(function(e){var j=i(e,e.rate.valueOf(),1);return q.delay(g.duration,function(e){j.playbackRate.value=e.rate.valueOf()})})]);
g.note=function(e,j,l,k){4>arguments.length&&(k=l);return q.dynamic(function(m){var a=i(m,e.valueOf(),1,j,l);a.gain.value=0;a.gain.setTargetAtTime(1,m.t1,g.attackTime.value/3);a.playbackRate.setTargetAtTime(e.valueOf(),m.t1,m.dt/3);return q.track([q.spawn(q.track([q.delay(k),q.fire(function(b){a.gain.setTargetAtTime(0,b.t1,g.releaseTime.value/3);a.stop(b.t1+12*g.releaseTime.value)})])),q.delay(l,function(b){a.playbackRate.exponentialRampToValueAtTime(e.valueOf(),b.t1)})])})};return g};v.sample.clearCache=
v.load_sample.clearCache})();v.jsnode=function(m){var r=m.numberOfInputs||0,k=r+(m.audioParams?m.audioParams.length:0),i=m.numberOfOutputs||1,e=0<k?l.createChannelMerger(k):void 0,g=0<i?l.createChannelSplitter(i):void 0,n=[],o,q,s;o=0;for(q=k;o<q;++o)s=l.createGainNode(),n.push(s),s.connect(e,0,o);var t=[];o=0;for(q=i;o<q;++o)s=l.createGainNode(),t.push(s),g&&g.connect(s,o);var u;u=m.audioParams?Object.keys(m.audioParams):[];var a={},b=[],c=[];a.inputs=b;a.outputs=c;o=0;for(q=u.length;o<q;++o)a[u[o]]=
null;a.playbackTime=l.currentTime;var d=!1,f=!1,h=0,R=Infinity,S,x=j({},n,t),M=0<u.length?v.dc(1):void 0;u.forEach(function(a,b){var c=n[r+b];x[a]=c.gain;c.gain.value=m.audioParams[a];M.connect(c)});var C=x.keep(l.createScriptProcessor(m.bufferLength||512,k,Math.min(1,i)));e&&e.connect(C);C.onaudioprocess=function(d){var e,g,j,k,n;e=0;if(!f){var o=d.outputBuffer.length;j=Math.floor(l.currentTime*l.sampleRate);k=Math.max(j,h);n=j+o;var p=k-j;j=n-j;if(n>k){e=0;for(g=r;e<g;++e)b[e]=d.inputBuffer.getChannelData(e).subarray(p,
j);e=0;for(g=i;e<g;++e)c[e]=d.outputBuffer.getChannelData(e).subarray(p,j);e=0;for(g=u.length;e<g;++e)a[u[e]]=d.inputBuffer.getChannelData(r+e).subarray(p,j);a.playbackTime=(d.playbackTime||l.currentTime)+p/l.sampleRate;a.samplesToStop=R-k;e=m.onaudioprocess.call(x,a);void 0===e&&(e=n-k)}k+e<n&&(1<=LOG_LEVEL&&console.log("models/jsnode.js[172]:\t","Finished",n,R),f=!0,setTimeout(S,Math.round(1E3*o/l.sampleRate)))}};var p=g||l.destination;S=function(){f=!0;C.disconnect();g&&g.disconnect();M&&(M.stop(0),
M.disconnect());e&&e.disconnect();x.drop(C);x.emit&&x.emit("ended")};var J;x.prepareAheadTime=0.1;x.start=function(a){if(!d&&!f)if(a){var b=Math.max(a,l.currentTime)-l.currentTime;J&&(cancelTimeout(J),J=null);var c=function(a){h=Math.floor(a*l.sampleRate);d=true;J=null;C.connect(p)};b<=x.prepareAheadTime?c(a):J=setTimeout(c,Math.round(1E3*(b-x.prepareAheadTime)),a)}else d=!0,C.connect(p)};x.stop=function(a){f||(R=Math.max(h,Math.ceil(a*l.sampleRate)))};0<r&&x.start(0);return x};return v});
